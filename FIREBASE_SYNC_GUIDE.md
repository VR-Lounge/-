# üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Firebase Firestore

## üìã –ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å Firebase

### ‚úÖ –Ø –º–æ–≥—É —Ä–∞–±–æ—Ç–∞—Ç—å —Å Firebase —á–µ—Ä–µ–∑:

1. **Firebase Admin SDK** (–∫–∞–∫ –≤ `telegram-bot.js`)
   - –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firestore
   - –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ Firestore
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

2. **Firebase CLI** (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)
   - –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
   - –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
   - –ë—ç–∫–∞–ø—ã
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

3. **–°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON/CSV
   - –ò–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–æ–≤

---

## ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Å GitHub

**Firebase –ù–ï —è–≤–ª—è–µ—Ç—Å—è Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º:**
- ‚ùå –ù–µ—Ç –∫–æ–º–∞–Ω–¥—ã `git push/pull`
- ‚ùå –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–º–∏—Ç–æ–≤
- ‚ùå –ù–µ—Ç –≤–µ—Ç–æ–∫ (branches)
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"

**Firebase - —ç—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ú–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å —á–µ—Ä–µ–∑ API
- ‚úÖ –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã

---

## ‚úÖ –ß—Ç–æ –ú–û–ñ–ù–û –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã Firestore

**–ß–µ—Ä–µ–∑ Firebase CLI:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Firebase CLI
npm install -g firebase-tools

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
firebase login

# –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
firebase firestore:export gs://–≤–∞—à-bucket/backup-$(date +%Y%m%d)
```

**–ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç Node.js:**
```javascript
const admin = require('firebase-admin');
const fs = require('fs');

async function backupFirestore() {
  const collections = ['bookings', 'clients', 'admins'];
  const backup = {};
  
  for (const collection of collections) {
    const snapshot = await admin.firestore().collection(collection).get();
    backup[collection] = snapshot.docs.map(doc => ({
      id: doc.id,
      data: doc.data()
    }));
  }
  
  fs.writeFileSync(`backup-${Date.now()}.json`, JSON.stringify(backup, null, 2));
  console.log('‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω!');
}
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏

**–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
```javascript
// sync-firestore.js
const admin = require('firebase-admin');

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–≤—É—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
const sourceDb = admin.initializeApp({
  credential: admin.credential.cert(require('./source-service-account.json'))
}, 'source').firestore();

const targetDb = admin.initializeApp({
  credential: admin.credential.cert(require('./target-service-account.json'))
}, 'target').firestore();

async function syncCollection(collectionName) {
  const sourceSnapshot = await sourceDb.collection(collectionName).get();
  
  for (const doc of sourceSnapshot.docs) {
    await targetDb.collection(collectionName).doc(doc.id).set(doc.data());
  }
  
  console.log(`‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${collectionName}`);
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
syncCollection('bookings');
syncCollection('clients');
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç –≤ JSON/CSV

**–°–∫—Ä–∏–ø—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞:**
```javascript
// export-firestore.js
const admin = require('firebase-admin');
const fs = require('fs');
const csv = require('csv-writer');

async function exportToJSON(collectionName) {
  const snapshot = await admin.firestore().collection(collectionName).get();
  const data = snapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  }));
  
  fs.writeFileSync(`${collectionName}.json`, JSON.stringify(data, null, 2));
  console.log(`‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ ${collectionName}.json`);
}

async function exportToCSV(collectionName) {
  const snapshot = await admin.firestore().collection(collectionName).get();
  const data = snapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  }));
  
  if (data.length === 0) return;
  
  const csvWriter = csv.createObjectCsvWriter({
    path: `${collectionName}.csv`,
    header: Object.keys(data[0]).map(key => ({ id: key, title: key }))
  });
  
  await csvWriter.writeRecords(data);
  console.log(`‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ ${collectionName}.csv`);
}
```

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Cloud Functions

**Cloud Function –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:**
```javascript
// functions/index.js
const functions = require('firebase-functions');
const admin = require('firebase-admin');

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
exports.updateClientStats = functions.firestore
  .document('bookings/{bookingId}')
  .onCreate(async (snap, context) => {
    const booking = snap.data();
    const clientRef = admin.firestore()
      .collection('clients')
      .where('phoneDigits', '==', booking.phoneDigits)
      .limit(1);
    
    const clientSnapshot = await clientRef.get();
    if (!clientSnapshot.empty) {
      const clientDoc = clientSnapshot.docs[0];
      await clientDoc.ref.update({
        totalBookings: admin.firestore.FieldValue.increment(1),
        totalSpent: admin.firestore.FieldValue.increment(booking.totalAmount),
        lastBookingDate: booking.bookingDate
      });
    }
  });
```

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Firebase CLI** (–ø—Ä–æ—â–µ –≤—Å–µ–≥–æ)
   ```bash
   # –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron job –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
   0 2 * * * firebase firestore:export gs://–≤–∞—à-bucket/backup-$(date +\%Y\%m\%d)
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cloud Functions** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø—ã
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

### –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:

1. **–°–∫—Ä–∏–ø—Ç—ã Node.js** (–∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ)
2. **Cloud Functions** (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
3. **Firebase CLI** (–¥–ª—è —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)

---

## üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Firebase CLI
```bash
npm install -g firebase-tools
firebase login
```

### –®–∞–≥ 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```bash
firebase init firestore
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –±—ç–∫–∞–ø–∞
```bash
# backup.sh
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
firebase firestore:export ./backups/backup_$DATE
echo "‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: backup_$DATE"
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (cron)
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab (crontab -e)
0 2 * * * /path/to/backup.sh
```

---

## ‚úÖ –ò—Ç–æ–≥–æ

**–ß—Ç–æ —è –º–æ–≥—É –¥–µ–ª–∞—Ç—å:**
- ‚úÖ –ß–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Firebase Admin SDK
- ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –±—ç–∫–∞–ø—ã –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
- ‚úÖ –ü–æ–º–æ–≥–∞—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:**
- üìù –ù–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã (—è –º–æ–≥—É –ø–æ–º–æ—á—å!)
- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (cron –∏–ª–∏ Cloud Functions)
- üîÑ –†–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

**–û—Ç–ª–∏—á–∏–µ –æ—Ç GitHub:**
- GitHub - —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π (git push/pull)
- Firebase - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (API –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏)
- –ù–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã!

---

## üéØ –•–æ—Ç–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é?

–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å–æ–∑–¥–∞—Ç—å:
1. –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
2. –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
3. –°–∫—Ä–∏–ø—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ JSON/CSV
4. –ù–∞—Å—Ç—Ä–æ–π–∫—É Cloud Functions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

–ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å! üöÄ

