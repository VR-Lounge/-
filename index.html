<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VR Lounge - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ó–∞–ø–∏—Å—è–º–∏ –∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏</title>
  <style>
    .top-header-block {
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    @media (max-width: 768px) {
      .header-scrolled .top-header-block {
        transform: translateY(-100%);
        opacity: 0;
      }
    }
  </style>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet" />
  <!-- VK Widget Script -->
  <script type="text/javascript" src="https://vk.com/js/api/openapi.js?168"></script>
  <!-- Yandex Maps -->
  <script src="https://api-maps.yandex.ru/2.1/?apikey=–≤–∞—à_API_–∫–ª—é—á&lang=ru_RU"></script>
  
  <!-- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" - –æ–±—ä—è–≤–ª—è–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ -->
  <script>
    // === –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" ===
    // –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
    var currentShareUrl = '';
    var currentShareType = '';

    // –û–±—ä—è–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
    function openShareModal(type, url) {
      console.log('openShareModal called with:', type, url); // –û—Ç–ª–∞–¥–∫–∞
      
      currentShareUrl = url;
      currentShareType = type;
      
      const modal = document.getElementById('shareModal');
      const title = document.getElementById('shareModalTitle');
      
      console.log('Modal element:', modal); // –û—Ç–ª–∞–¥–∫–∞
      console.log('Title element:', title); // –û—Ç–ª–∞–¥–∫–∞
      
      if (!modal) {
        console.error('Modal shareModal not found!');
        return;
      }
      
      if (!title) {
        console.error('Title shareModalTitle not found!');
        return;
      }
      
      // –û—Ç–ª–∞–¥–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      const whatsapp = document.getElementById('shareWhatsApp');
      const telegram = document.getElementById('shareTelegram');
      const vk = document.getElementById('shareVK');
      const email = document.getElementById('shareEmail');
      const copy = document.getElementById('copyLink');
      
      console.log('WhatsApp element:', whatsapp);
      console.log('Telegram element:', telegram);
      console.log('VK element:', vk);
      console.log('Email element:', email);
      console.log('Copy element:', copy);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      if (whatsapp) console.log('WhatsApp visible:', window.getComputedStyle(whatsapp).display !== 'none');
      if (telegram) console.log('Telegram visible:', window.getComputedStyle(telegram).display !== 'none');
      if (vk) console.log('VK visible:', window.getComputedStyle(vk).display !== 'none');
      if (email) console.log('Email visible:', window.getComputedStyle(email).display !== 'none');
      if (copy) console.log('Copy visible:', window.getComputedStyle(copy).display !== 'none');
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
      switch(type) {
        case 'vk':
          title.textContent = '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≥—Ä—É–ø–ø–æ–π –í–ö–æ–Ω—Ç–∞–∫—Ç–µ';
          break;
        case 'maps':
          title.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞—à—É –ª–æ–∫–∞—Ü–∏—é';
          break;
        case 'reviews':
          title.textContent = '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –æ—Ç–∑—ã–≤–∞–º–∏';
          break;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–æ–≤ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
      updateShareLinks(url, type);
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
      if (whatsapp) {
        whatsapp.style.display = 'flex';
        whatsapp.style.visibility = 'visible';
        whatsapp.style.opacity = '1';
        whatsapp.style.height = 'auto';
        whatsapp.style.minHeight = '48px';
        whatsapp.style.width = '100%';
        whatsapp.style.background = '#f8f9fa';
        whatsapp.style.border = '1px solid #e9ecef';
        whatsapp.style.padding = '12px 16px';
        whatsapp.style.margin = '5px 0';
      }
      if (telegram) {
        telegram.style.display = 'flex';
        telegram.style.visibility = 'visible';
        telegram.style.opacity = '1';
        telegram.style.height = 'auto';
        telegram.style.minHeight = '48px';
        telegram.style.width = '100%';
        telegram.style.background = '#f8f9fa';
        telegram.style.border = '1px solid #e9ecef';
        telegram.style.padding = '12px 16px';
        telegram.style.margin = '5px 0';
      }
      if (vk) {
        vk.style.display = 'flex';
        vk.style.visibility = 'visible';
        vk.style.opacity = '1';
        vk.style.height = 'auto';
        vk.style.minHeight = '48px';
        vk.style.width = '100%';
        vk.style.background = '#f8f9fa';
        vk.style.border = '1px solid #e9ecef';
        vk.style.padding = '12px 16px';
        vk.style.margin = '5px 0';
      }
      if (email) {
        email.style.display = 'flex';
        email.style.visibility = 'visible';
        email.style.opacity = '1';
        email.style.height = 'auto';
        email.style.minHeight = '48px';
        email.style.width = '100%';
        email.style.background = '#f8f9fa';
        email.style.border = '1px solid #e9ecef';
        email.style.padding = '12px 16px';
        email.style.margin = '5px 0';
      }
      if (copy) {
        copy.style.display = 'flex';
        copy.style.visibility = 'visible';
        copy.style.opacity = '1';
        copy.style.height = 'auto';
        copy.style.minHeight = '48px';
        copy.style.width = '100%';
        copy.style.background = '#f8f9fa';
        copy.style.border = '1px solid #e9ecef';
        copy.style.padding = '12px 16px';
        copy.style.margin = '5px 0';
      }
      
      modal.classList.remove('hidden');
      console.log('Modal should be visible now'); // –û—Ç–ª–∞–¥–∫–∞
    }

    function closeShareModal() {
      const modal = document.getElementById('shareModal');
      if (modal) {
        modal.classList.add('hidden');
      }
    }

    function updateShareLinks(url, type) {
      const encodedUrl = encodeURIComponent(url);
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –º–æ–±–∏–ª—å–Ω–æ–µ –ª–∏ —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      let shareText = '';
      let encodedShareText = '';
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
      switch(type) {
        case 'vk':
          shareText = '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É VR Lounge! üéÆ';
          break;
        case 'maps':
          shareText = '–ù–∞—à–∞ –ª–æ–∫–∞—Ü–∏—è VR Lounge - –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –∫ –Ω–∞–º! üìç';
          break;
        case 'reviews':
          shareText = '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç–∑—ã–≤—ã –æ VR Lounge! ‚≠ê';
          break;
      }
      
      // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–µ –∫–æ–¥–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç, –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –∫–æ–¥–∏—Ä—É–µ–º
      encodedShareText = isMobile ? shareText : encodeURIComponent(shareText);
      
      console.log('Device type:', isMobile ? 'Mobile' : 'Desktop');
      console.log('Original text:', shareText);
      console.log('Encoded text:', encodedShareText);
      
      // –î–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ URL - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –¥–æ–±–∞–≤–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
      if (isMobile && type === 'reviews') {
        console.log('–ú–æ–±–∏–ª—å–Ω—ã–π Telegram: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ URL, —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–∏—Ç —Å–∞–º');
      }
      
      // WhatsApp
      const whatsappEl = document.getElementById('shareWhatsApp');
      if (whatsappEl) {
        if (isMobile) {
          whatsappEl.href = `https://wa.me/?text=${shareText} ${url}`;
        } else {
          whatsappEl.href = `https://wa.me/?text=${encodedShareText}%20${encodedUrl}`;
        }
      }
      
      // Telegram
      const telegramEl = document.getElementById('shareTelegram');
      if (telegramEl) {
        if (isMobile) {
          // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö Telegram - —Ç–æ–ª—å–∫–æ URL –±–µ–∑ —Ç–µ–∫—Å—Ç–∞ (–∏–∑–±–µ–≥–∞–µ–º –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
          telegramEl.href = `https://t.me/share/url?url=${url}`;
        } else {
          telegramEl.href = `https://t.me/share/url?url=${encodedUrl}&text=${encodedShareText}`;
        }
      }
      
      // –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
      const vkEl = document.getElementById('shareVK');
      if (vkEl) {
        if (isMobile) {
          vkEl.href = `https://vk.com/share.php?url=${url}&title=${shareText}`;
        } else {
          vkEl.href = `https://vk.com/share.php?url=${encodedUrl}&title=${encodedShareText}`;
        }
      }
      
      // Email
      const emailEl = document.getElementById('shareEmail');
      if (emailEl) {
        if (isMobile) {
          emailEl.href = `mailto:?subject=${shareText}&body=${shareText} ${url}`;
        } else {
          emailEl.href = `mailto:?subject=${encodedShareText}&body=${encodedShareText}%20${encodedUrl}`;
        }
      }
      
      // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
      const copyEl = document.getElementById('copyLink');
      if (copyEl) {
        copyEl.onclick = function() {
          copyToClipboard(url);
        };
      }
    }

    function copyToClipboard(text) {
      if (navigator.clipboard && window.isSecureContext) {
        // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±
        navigator.clipboard.writeText(text).then(function() {
          showCopySuccess();
        }).catch(function(err) {
          fallbackCopyTextToClipboard(text);
        });
      } else {
        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        fallbackCopyTextToClipboard(text);
      }
    }

    function fallbackCopyTextToClipboard(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.top = "0";
      textArea.style.left = "0";
      textArea.style.position = "fixed";
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        const successful = document.execCommand('copy');
        if (successful) {
          showCopySuccess();
        } else {
          showCopyError();
        }
      } catch (err) {
        showCopyError();
      }
      
      document.body.removeChild(textArea);
    }

    function showCopySuccess() {
      const copyButton = document.getElementById('copyLink');
      if (copyButton) {
        const originalText = copyButton.innerHTML;
        copyButton.innerHTML = '<i class="fas fa-check text-green-500"></i><span>–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</span>';
        copyButton.style.background = '#d4edda';
        
        setTimeout(() => {
          copyButton.innerHTML = originalText;
          copyButton.style.background = '#f8f9fa';
        }, 2000);
      }
    }

    function showCopyError() {
      const copyButton = document.getElementById('copyLink');
      if (copyButton) {
        const originalText = copyButton.innerHTML;
        copyButton.innerHTML = '<i class="fas fa-times text-red-500"></i><span>–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</span>';
        copyButton.style.background = '#f8d7da';
        
        setTimeout(() => {
          copyButton.innerHTML = originalText;
          copyButton.style.background = '#f8f9fa';
        }, 2000);
      }
    }

    // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    function testShareFunctions() {
      console.log('Share functions loaded successfully!');
      console.log('openShareModal function:', typeof openShareModal);
      console.log('closeShareModal function:', typeof closeShareModal);
      console.log('updateShareLinks function:', typeof updateShareLinks);
      console.log('copyToClipboard function:', typeof copyToClipboard);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
      console.log('window.openShareModal:', typeof window.openShareModal);
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ window –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
      window.openShareModal = openShareModal;
      window.closeShareModal = closeShareModal;
      window.updateShareLinks = updateShareLinks;
      window.copyToClipboard = copyToClipboard;
      
      console.log('Functions added to window object');
    }

    // –í—ã–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é
    testShareFunctions();
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, checking functions again...');
      console.log('openShareModal available:', typeof openShareModal);
      console.log('window.openShareModal available:', typeof window.openShareModal);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
      const shareButtons = document.querySelectorAll('.share-button');
      console.log('Found share buttons:', shareButtons.length);
      
      shareButtons.forEach((button, index) => {
        console.log(`Button ${index + 1}:`, button.onclick);
        console.log(`Button ${index + 1} onclick attribute:`, button.getAttribute('onclick'));
      });
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      const modal = document.getElementById('shareModal');
      console.log('Share modal found:', !!modal);
      
             if (modal) {
         console.log('Modal classes:', modal.className);
         console.log('Modal hidden:', modal.classList.contains('hidden'));
       }
       
       // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–∏–≤—è–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π
       shareButtons.forEach((button, index) => {
         button.addEventListener('click', function(e) {
           console.log(`Alternative click handler for button ${index + 1}`);
           const onclickAttr = this.getAttribute('onclick');
           console.log('Onclick attribute:', onclickAttr);
           
           // –ï—Å–ª–∏ onclick –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ–º –≤—Ä—É—á–Ω—É—é
           if (onclickAttr && typeof window.openShareModal === 'function') {
             try {
               // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ onclick
               const match = onclickAttr.match(/openShareModal\('([^']+)',\s*'([^']+)'\)/);
               if (match) {
                 const [, type, url] = match;
                 console.log('Extracted params:', type, url);
                 window.openShareModal(type, url);
               }
             } catch (error) {
               console.error('Error in alternative click handler:', error);
             }
           }
         });
       });
     });
  </script>
  
  <style>
    body {
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background-color: #f5f5f7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      color: #1d1d1f;
    }
    ul::-webkit-scrollbar, .bookings-list::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ul::-webkit-scrollbar-thumb, .bookings-list::-webkit-scrollbar-thumb {
      background-color: rgba(0,0,0,0.1);
      border-radius: 3px;
    }
    ul::-webkit-scrollbar-track, .bookings-list::-webkit-scrollbar-track {
      background: transparent;
    }
    #bookingModal, #assignAdminModal, #authContainer {
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    button:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.4);
      border-radius: 12px;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.4);
      border-radius: 12px;
      border-color: #007aff;
    }
    .calendar-day-cell { /* –î–æ–±–∞–≤–ª–µ–Ω –∫–ª–∞—Å—Å –¥–ª—è —è—á–µ–µ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∞–¥–º–∏–Ω–æ–≤ */
       min-height: 100px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —è—á–µ–π–∫–∏ */
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–≥–æ–≤-–∫–Ω–æ–ø–æ–∫ —É—Å–ª—É–≥ */
    .service-tag {
      /* display: inline-flex; */ /* –£–±—Ä–∞–Ω–æ */
      display: inline-block; /* –ß—Ç–æ–±—ã —Ç–µ–≥–∏ —à–ª–∏ –≤ —Å—Ç—Ä–æ–∫—É, –Ω–æ –∫–æ–Ω—Ç–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –º–æ–≥ –±—ã—Ç—å –±–ª–æ—á–Ω—ã–º */
      flex-direction: column;
      /* align-items: center; */ /* –£–±—Ä–∞–Ω–æ, —Ç–µ–∫—Å—Ç –≤—ã—Ä–æ–≤–Ω—è–µ–º –ø–æ —Ü–µ–Ω—Ç—Ä—É */
      /* padding: 8px 16px; */
      padding: 12px 10px; /* –ù–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–∏–ª –æ—Ç—Å—Ç—É–ø—ã */
      border-radius: 14px; /* –ß—É—Ç—å –º–µ–Ω–µ–µ –∫—Ä—É–≥–ª—ã–µ */
      background-color: #f5f5f7;
      color: #1d1d1f;
      font-weight: 500;
      border: 1px solid #e5e5e5;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
      text-align: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
      min-width: 110px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è */
      vertical-align: top; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–≥–æ–≤ –ø–æ –≤–µ—Ä—Ö—É, –µ—Å–ª–∏ –æ–Ω–∏ —Ä–∞–∑–Ω–æ–π –≤—ã—Å–æ—Ç—ã */
    }

    /* –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞ */
    .service-tag i {
       /* font-size: 14px; */ /* –£–¥–∞–ª–µ–Ω–æ */
       margin-bottom: 0; /* –£–¥–∞–ª–µ–Ω–æ */
       margin-right: 0; /* –£–¥–∞–ª–µ–Ω–æ */
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ (–∏–∫–æ–Ω–∫–∞ + –Ω–∞–∑–≤–∞–Ω–∏–µ) */
    .service-tag-line1 {
        display: flex;        /* –ò–∫–æ–Ω–∫–∞ –∏ —Ç–µ–∫—Å—Ç –≤ —Å—Ç—Ä–æ–∫—É */
        align-items: center;  /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
        justify-content: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
        margin-bottom: 4px;   /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–æ —Ü–µ–Ω—ã */
        font-size: 14px;      /* –£–≤–µ–ª–∏—á–µ–Ω–æ */
    }
    .service-tag-line1 i {
        font-size: 16px;    /* –†–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ */
        margin-right: 6px;  /* –û—Ç—Å—Ç—É–ø –∏–∫–æ–Ω–∫–∏ —Å–ø—Ä–∞–≤–∞ */
    }
    .service-tag-line1 span { /* –ß—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –º–æ–≥ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
        display: inline-block;
        font-weight: 600; /* –î–µ–ª–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∏—Ä–Ω—ã–º */
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ —Å —Ü–µ–Ω–æ–π */
    .service-tag-price {
      font-size: 13px; /* –£–≤–µ–ª–∏—á–µ–Ω–æ */
      color: #6e6e73; /* –í—Ç–æ—Ä–∏—á–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ Apple */
    }

    .service-tag:hover {
      background-color: #e5e5e5;
    }

    .service-tag.selected {
      background-color: #007aff;
      color: white;
      border-color: #007aff;
    }

    .service-tag.selected:hover {
      background-color: #0062cc;
    }

    .service-tag.selected .service-tag-price {
      /* color: rgba(255, 255, 255, 0.8); */ /* –î–µ–ª–∞–µ–º —Ü–µ–Ω—É —Ç–∞–∫–æ–π –∂–µ, –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç */
      color: white;
    }

    .service-tag.selected i {
        color: white !important; /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –∏–∫–æ–Ω–∫–∏ –Ω–∞ –±–µ–ª—ã–π –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ç–µ–≥–æ–≤ */
    #servicesContainer {
      /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–¥–µ—Å–∫—Ç–æ–ø + –º–æ–±–∏–ª—å–Ω—ã–µ) */
      display: flex;       /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é flex –¥–ª—è —Ä—è–¥–æ–≤ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      max-height: 220px;  /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã (–ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ–¥ 2 —Ä—è–¥–∞) */
      overflow-y: auto;   /* –í–∫–ª—é—á–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
      padding: 10px 5px; /* –û—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —Å–∫—Ä–æ–ª–ª–∞ (–≤–µ—Ä—Ö/–Ω–∏–∑ –±–æ–ª—å—à–µ) */
      border: 1px solid #e5e5e5;
      border-radius: 14px;
      /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ (–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º) */
    }
    #servicesContainer::-webkit-scrollbar {
      width: 5px;
    }
    #servicesContainer::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.15);
        border-radius: 3px;
    }
    #servicesContainer::-webkit-scrollbar-track {
      background: transparent;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ç–µ–≥–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ) */
    @media (max-width: 768px) {
      #servicesContainer {
        display: block; /* –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –±–ª–æ—á–Ω—ã–π –º–∞–∫–µ—Ç (1 –∫–æ–ª–æ–Ω–∫–∞) */
        max-height: 350px; /* –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã—à–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ (border, padding, scrollbar) –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è */
      }

      /* –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—É–∂–µ –µ—Å—Ç—å –æ–±—â–∏–µ) */
      /* #servicesContainer::-webkit-scrollbar { ... } */

      .service-tag {
        display: block; /* –ö–∞–∂–¥—ã–π —Ç–µ–≥ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ */
        width: 100%;    /* –ù–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        min-width: 0;   /* –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
        margin-bottom: 8px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Ç–µ–≥–∞–º–∏ */
        text-align: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */
      }
      .service-tag:last-child {
        margin-bottom: 0; /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–µ–≥–∞ */
      }

      /* –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ü–µ–Ω–∞ —Ç–æ–∂–µ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç—Å—è */
      .service-tag-price {
          text-align: center;
      }

      /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      #client-month-nav {
          justify-content: center;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–∂–µ—Ç–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .grid.lg\\:grid-cols-3 {
        grid-template-columns: 1fr; /* –û–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      }

      /* –£–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É –≤–∏–¥–∂–µ—Ç–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .widget-iframe {
        height: 500px !important;
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .share-button {
        font-size: 12px;
        padding: 8px 12px;
        gap: 6px;
      }

      /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤–∏–¥–∂–µ—Ç–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      .widget-container .flex.items-center.justify-between {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .widget-container .flex.items-center.justify-between .flex.items-center {
        width: 100%;
      }

      .widget-container .share-button {
        width: 100%;
        justify-content: center;
      }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
    @media (min-width: 769px) {
      .share-button {
        font-size: 14px !important;
        padding: 10px 20px !important;
        gap: 8px !important;
      }

      .widget-container .flex.items-center.justify-between {
        flex-direction: row !important;
        align-items: center !important;
        gap: 0 !important;
      }

      .widget-container .flex.items-center.justify-between .flex.items-center {
        width: auto !important;
      }

      .widget-container .share-button {
        width: auto !important;
        justify-content: flex-start !important;
      }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–∂–µ—Ç–æ–≤ */
    .widget-container {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .widget-container:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è iframe –≤–∏–¥–∂–µ—Ç–æ–≤ */
    .widget-iframe {
      border-radius: 16px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" */
    .share-button {
      background: linear-gradient(135deg, #007aff 0%, #0056cc 100%);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex !important;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
      visibility: visible !important;
      opacity: 1 !important;
    }

    .share-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
      background: linear-gradient(135deg, #0056cc 0%, #003d99 100%);
    }

    .share-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0, 122, 255, 0.3);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è */
    .share-modal {
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    .share-option {
      display: flex !important;
      align-items: center !important;
      gap: 12px !important;
      padding: 12px 16px !important;
      border-radius: 12px !important;
      background: #f8f9fa !important;
      border: 1px solid #e9ecef !important;
      cursor: pointer !important;
      transition: all 0.2s ease !important;
      text-decoration: none !important;
      color: #1d1d1f !important;
      visibility: visible !important;
      opacity: 1 !important;
      height: auto !important;
      width: 100% !important;
      min-height: 48px !important;
      box-sizing: border-box !important;
    }

    .share-option:hover {
      background: #e9ecef;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .share-option i {
      font-size: 20px !important;
      width: 24px !important;
      text-align: center !important;
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }

    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è */
    #shareWhatsApp, #shareTelegram, #shareVK, #shareEmail, #copyLink {
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
      height: auto !important;
      min-height: 48px !important;
      width: 100% !important;
      background: #f8f9fa !important;
      border: 1px solid #e9ecef !important;
      padding: 12px 16px !important;
      margin: 5px 0 !important;
      align-items: center !important;
      gap: 12px !important;
      border-radius: 12px !important;
      cursor: pointer !important;
      text-decoration: none !important;
      color: #1d1d1f !important;
      box-sizing: border-box !important;
    }

    #shareWhatsApp i, #shareTelegram i, #shareVK i, #shareEmail i, #copyLink i {
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
      font-size: 20px !important;
      width: 24px !important;
      text-align: center !important;
    }

    #shareWhatsApp span, #shareTelegram span, #shareVK span, #shareEmail span, #copyLink span {
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
      color: #1d1d1f !important;
    }
  </style>
</head>
<body>
  <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
  <div id="authContainer" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50 hidden" onclick="event.target === this && this.classList.add('hidden')">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative" onclick="event.stopPropagation()">
    <button id="closeAuthBtn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-3xl font-thin leading-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full w-10 h-10 flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ">&times;</button>
    <h3 class="text-2xl font-semibold mb-6 text-center">–î–æ—Å—Ç—É–ø –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
    <form id="loginForm" class="space-y-4">
      <div>
        <label for="loginEmail" class="block mb-2 font-medium">Email</label>
        <input type="email" id="loginEmail" required class="w-full rounded-3xl border border-gray-300 px-4 py-3">
      </div>
      <div>
        <label for="loginPassword" class="block mb-2 font-medium">–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="loginPassword" required class="w-full rounded-3xl border border-gray-300 px-4 py-3">
      </div>
      <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-3xl">
        –í–æ–π—Ç–∏
      </button>
    </form>
  </div>
</div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
  <header class="bg-white/50 shadow-md sticky top-0 z-30 backdrop-blur-md" id="mainHeader">
    <!-- –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫ —à–∞–ø–∫–∏ (—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ) -->
    <div class="top-header-block transition-all duration-300" id="headerTop">
      <div class="max-w-7xl mx-auto px-4 md:px-6 py-3">
        <div class="flex flex-row items-center justify-between">
          <h1 class="text-xl md:text-2xl font-semibold tracking-tight text-gray-900 select-none">VR Lounge - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h1>
          <div class="flex items-center space-x-4">
            <button id="logoutBtn" class="hidden text-sm text-blue-600 hover:text-blue-800 px-3 py-1 rounded-full hover:bg-blue-50">–í—ã–π—Ç–∏</button>
            <button id="loginBtn" class="text-sm text-blue-600 hover:text-blue-800 px-3 py-1 rounded-full hover:bg-blue-50">–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
          </div>
        </div>
      </div>
    </div>
    
          <!-- –ù–∏–∂–Ω–∏–π –±–ª–æ–∫ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–Ω) -->
      <div class="bottom-header-block bg-white/80 border-t border-gray-100">
        <div class="max-w-7xl mx-auto px-4 md:px-6">
          <nav class="nav-links flex items-center space-x-2 md:space-x-6 py-2 overflow-x-auto whitespace-nowrap" style="scrollbar-width: none; -ms-overflow-style: none;">
            <a href="#" id="bookingsLink" class="nav-link active whitespace-nowrap">
              <i class="fas fa-calendar-alt mr-2"></i>–ó–∞–ø–∏—Å–∏
            </a>
            <a href="#" id="adminScheduleLink" class="nav-link whitespace-nowrap">
              <i class="fas fa-user-clock mr-2"></i>–ì—Ä–∞—Ñ–∏–∫
            </a>
            <a href="#" id="salaryLink" class="nav-link whitespace-nowrap">
              <i class="fas fa-money-bill-wave mr-2"></i>–§–∏–Ω–∞–Ω—Å—ã
            </a>
            <a href="#" id="servicesLink" class="nav-link whitespace-nowrap">
              <i class="fas fa-list-alt mr-2"></i>–£—Å–ª—É–≥–∏
            </a>
            <a href="#" id="widgetsLink" class="nav-link whitespace-nowrap">
              <i class="fas fa-share-alt mr-2"></i>–í–∏–¥–∂–µ—Ç—ã
            </a>
            <a href="#" class="nav-link whitespace-nowrap" id="expensesNavLink">
              <i class="fas fa-receipt mr-2"></i>–†–∞—Å—Ö–æ–¥—ã
            </a>
          </nav>
      </div>
    </div>
  </header>

  <script>
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤
    window.showBookingsSection = function() {
      document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
      document.getElementById('bookingsSection').classList.remove('hidden');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelector('.nav-link[onclick*="showBookingsSection"]').classList.add('active');
      return false;
    }

    window.showAdminScheduleSection = function() {
      document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
      document.getElementById('adminScheduleSection').classList.remove('hidden');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelector('.nav-link[onclick*="showAdminScheduleSection"]').classList.add('active');
      return false;
    }

    window.showSalarySection = function() {
      document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
      document.getElementById('salarySection').classList.remove('hidden');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelector('.nav-link[onclick*="showSalarySection"]').classList.add('active');
      return false;
    }

    window.showServicesSection = function() {
      document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
      document.getElementById('servicesSection').classList.remove('hidden');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelector('.nav-link[onclick*="showServicesSection"]').classList.add('active');
      return false;
    }

    window.showWidgetsSection = function() {
      document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
      document.getElementById('widgetsSection').classList.remove('hidden');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelector('.nav-link[onclick*="showWidgetsSection"]').classList.add('active');
      initWidgets();
      return false;
    }

    window.showExpensesSection = function() {
      document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
      document.getElementById('expensesSection').classList.remove('hidden');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      const expensesLink = document.getElementById('expensesNavLink');
      if (expensesLink) {
        expensesLink.classList.add('active');
      }
      window.setupExpensesListener();
      return false;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
      showBookingsSection();
    });
  </script>

  <style>
    /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ */
    .nav-link {
      color: #4a5568;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      min-width: max-content;
    }
    
    .nav-link:hover {
      color: #2d3748;
      background-color: #f7fafc;
    }
    
    .nav-link.active {
      color: #3182ce;
      background-color: #ebf8ff;
    }

    /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
    .nav-links::-webkit-scrollbar {
      display: none;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ */
    @media (max-width: 768px) {
      .nav-links {
        padding-bottom: 0.5rem;
        margin-bottom: -0.5rem;
      }
      
      /* –ö–ª–∞—Å—Å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —à–∞–ø–∫–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ */
      .header-scrolled #headerTop {
        height: 0;
        overflow: hidden;
        margin: 0;
        padding: 0;
      }
      
      .header-scrolled {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }
      
      /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è/–ø–æ—è–≤–ª–µ–Ω–∏—è */
      #headerTop {
        transition: all 0.3s ease-in-out;
      }
    }
  </style>

  <main class="flex-grow max-w-7xl mx-auto px-6 py-8 flex flex-col space-y-10">
    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
    <section id="bookingsSection">
      <h2 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight">–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
      <div class="bg-white rounded-3xl shadow-lg max-w-4xl mx-auto p-8 border border-gray-200">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8 space-y-5 md:space-y-0">
          <div id="client-month-nav" class="flex items-center space-x-3">
            <button id="prevMonth" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
              <i class="fas fa-chevron-left text-lg"></i>
            </button>
            <h3 id="monthYear" class="text-xl font-semibold text-gray-900 tracking-tight select-none"></h3>
            <button id="nextMonth" aria-label="–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
              <i class="fas fa-chevron-right text-lg"></i>
            </button>
          </div>
          <button id="addBookingBtn" class="hidden inline-flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-semibold rounded-3xl px-5 py-3 shadow-md transition focus:ring-4 focus:ring-blue-300 focus:outline-none">
            <i class="fas fa-plus text-base"></i>
            <span>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞</span>
          </button>
        </div>

        <div id="calendar" class="grid grid-cols-7 gap-1 text-center text-sm select-none user-select-none">
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–ü–Ω</div>
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–í—Ç</div>
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–°—Ä</div>
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–ß—Ç</div>
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–ü—Ç</div>
          <div class="font-semibold text-indigo-600 py-3 border-b border-gray-200">–°–±</div>
          <div class="font-semibold text-indigo-600 py-3 border-b border-gray-200">–í—Å</div>
          <!-- –î–Ω–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
        </div>
      </div>
    </section>

    <!-- –ì—Ä–∞—Ñ–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
    <section id="adminScheduleSection" class="hidden">
      <h2 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight">–ì—Ä–∞—Ñ–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</h2>
      <div class="bg-white rounded-3xl shadow-lg max-w-4xl mx-auto p-8 border border-gray-200">
        <div class="flex justify-between mb-6">
          <button id="prevMonthAdmins" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            <i class="fas fa-chevron-left text-lg"></i>
          </button>
          <h3 id="currentMonthAdmins" class="text-xl font-semibold text-gray-900 tracking-tight select-none"></h3>
          <button id="nextMonthAdmins" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            <i class="fas fa-chevron-right text-lg"></i>
          </button>
        </div>
        <div id="adminsCalendar" class="grid grid-cols-7 gap-1 text-center text-sm select-none">
          <!-- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ -->
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–ü–Ω</div>
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–í—Ç</div>
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–°—Ä</div>
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–ß—Ç</div>
          <div class="font-semibold text-gray-500 py-3 border-b border-gray-200">–ü—Ç</div>
          <div class="font-semibold text-indigo-600 py-3 border-b border-gray-200">–°–±</div>
          <div class="font-semibold text-indigo-600 py-3 border-b border-gray-200">–í—Å</div>
          <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∞–¥–º–∏–Ω–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —Å—é–¥–∞ -->
        </div>
      </div>
    </section>

    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
    <section>
      <div class="flex items-center justify-center space-x-4 mb-6">
        <button id="prevMonthBookings" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü –∑–∞–ø–∏—Å–µ–π" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
          <i class="fas fa-chevron-left text-lg"></i>
        </button>
        <h2 id="bookingsListTitle" class="text-2xl font-semibold text-center text-gray-900 tracking-tight">–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
        <button id="nextMonthBookings" aria-label="–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü –∑–∞–ø–∏—Å–µ–π" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
          <i class="fas fa-chevron-right text-lg"></i>
        </button>
      </div>
      <div class="bg-white rounded-3xl shadow-lg max-w-4xl mx-auto p-8 border border-gray-200 min-h-[200px]">
        <ul id="bookingsList" class="space-y-4 max-h-[400px] overflow-y-auto text-gray-900 text-base leading-relaxed bookings-list">
          <!-- –ó–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
        </ul>
        <p id="noBookingsText" class="text-center text-gray-500 italic select-none">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü</p>
      </div>
    </section>

    <!-- –†–∞—Å—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã -->
    <section id="salarySection" class="hidden">
      <h2 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight">–§–∏–Ω–∞–Ω—Å—ã –∏ –†–∞—Å—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã</h2>
      <div class="bg-white rounded-3xl shadow-lg max-w-4xl mx-auto p-8 border border-gray-200">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º (–æ—Å—Ç–∞–µ—Ç—Å—è –¥–ª—è –º–µ—Å—è—á–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞) -->
        <div class="flex justify-between mb-6">
          <button id="prevMonthSalary" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            <i class="fas fa-chevron-left text-lg"></i>
          </button>
          <h3 id="currentMonthSalary" class="text-xl font-semibold text-gray-900 tracking-tight select-none"></h3>
          <button id="nextMonthSalary" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100 transition text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none">
            <i class="fas fa-chevron-right text-lg"></i>
          </button>
        </div>

        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –í–´–†–£–ß–ö–ò -->
        <div class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-green-50 border border-green-200 rounded-2xl p-4 text-center">
            <p class="text-sm font-medium text-green-700">–í—ã—Ä—É—á–∫–∞ —Å–µ–≥–æ–¥–Ω—è</p>
            <p id="revenueToday" class="text-xl font-bold text-green-600 mt-1">0 ‚ÇΩ</p>
          </div>
          <div class="bg-green-50 border border-green-200 rounded-2xl p-4 text-center">
            <p class="text-sm font-medium text-green-700">–í—ã—Ä—É—á–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é</p>
            <p id="revenueCurrentWeek" class="text-xl font-bold text-green-600 mt-1">0 ‚ÇΩ</p>
          </div>
          <div class="bg-green-50 border border-green-200 rounded-2xl p-4 text-center">
            <p class="text-sm font-medium text-green-700">–í—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü</p>
            <p id="revenueSelectedMonth" class="text-xl font-bold text-green-600 mt-1">0 ‚ÇΩ</p>
          </div>
        </div>
        <!-- –ö–û–ù–ï–¶ –°–¢–ê–¢–ò–°–¢–ò–ö–ò –í–´–†–£–ß–ö–ò -->


        <!-- –ë–õ–û–ö –°–ï–ì–û–î–ù–Ø–®–ù–ò–• –í–´–ü–õ–ê–¢ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫) -->
        <div id="todayPayrollBlock" class="mb-8 p-6 bg-green-50 border border-green-200 rounded-2xl hidden">
            <h4 class="font-semibold text-base mb-3 text-green-900">–°–µ–≥–æ–¥–Ω—è –∫ –≤—ã–ø–ª–∞—Ç–µ:</h4>
            <p id="todayPayrollPeriod" class="text-xs text-green-700 mb-3"></p>
            <div id="todayPayrollResults" class="space-y-2 text-sm">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏—Ö –≤—ã–ø–ª–∞—Ç -->
            </div>
        </div>

        <!-- –ï–ñ–ï–ù–ï–î–ï–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢ –ö –í–´–ü–õ–ê–¢–ï -->
        <div class="mb-8 p-6 bg-yellow-50 border border-yellow-200 rounded-2xl">
            <h4 class="font-semibold text-base mb-3 text-yellow-900" id="weeklyPayrollTitle">–ö –≤—ã–ø–ª–∞—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ (–∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é):</h4>
            <p id="weeklyPayrollPeriod" class="text-xs text-yellow-700 mb-3"></p>
            <div id="weeklyPayrollResults" class="space-y-2 text-sm">
                <p class="italic text-yellow-600">–†–∞—Å—á–µ—Ç...</p>
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π –ó–ü -->
            </div>
        </div>
        <!-- –ö–û–ù–ï–¶ –ï–ñ–ï–ù–ï–î–ï–õ–¨–ù–û–ì–û –†–ê–°–ß–ï–¢–ê -->


        <!-- –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ô –ë–õ–û–ö -->
        <div class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-2xl text-sm text-blue-800">
          <h4 class="font-semibold text-base mb-3 text-blue-900">–£—Å–ª–æ–≤–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–∞—Ä–ø–ª–∞—Ç—ã (–¥–ª—è –º–µ—Å—è—á–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞):</h4>
          <ul class="list-disc list-inside space-y-1.5">
            <li>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞ <strong>500‚ÇΩ</strong> –∑–∞ —Å–º–µ–Ω—É –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.</li>
            <li>–ë–æ–Ω—É—Å <strong>15%</strong> –æ—Ç –≤—ã—Ä—É—á–∫–∏ –∑–∞ —Å–º–µ–Ω—É (–∏–ª–∏ <strong>8%</strong>, –µ—Å–ª–∏ –Ω–∞ —Å–º–µ–Ω–µ –±—ã–ª –ø–æ–º–æ—â–Ω–∏–∫).</li>
            <li>–ü–æ–º–æ—â–Ω–∏–∫—É –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è <strong>150‚ÇΩ/—á–∞—Å</strong> + –±–æ–Ω—É—Å <strong>7%</strong> <span class="bg-yellow-100 px-1.5 py-0.5 rounded">—Ç–æ–ª—å–∫–æ –æ—Ç –≤—ã—Ä—É—á–∫–∏ –∑–∞ —É—Å–ª—É–≥–∏ "–ê—Ä–µ–Ω–¥–∞ (–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è)"</span>.</li>
            <li>–ü–æ–º–æ—â–Ω–∏–∫ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è "–ê—Ä–µ–Ω–¥–∞ (–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è)".</li>
            <li>–†–∞—Å—á–µ—Ç –∏ –≤—ã–¥–∞—á–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –ø–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞–º.</li>
            <li class="bg-blue-100 p-2 rounded mt-2">–í —Ä–∞—Å—á–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è <strong>—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã</strong> –ø–æ–º–æ—â–Ω–∏–∫–∞ –∏–∑ –∑–∞–ø–∏—Å–µ–π —Å —É—Å–ª—É–≥–æ–π "–ê—Ä–µ–Ω–¥–∞ (–î–†)", –∞ –Ω–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç, –µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —á–∞—Å—ã –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º.</li>
          </ul>
        </div>
        <!-- –ö–û–ù–ï–¶ –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–û–ì–û –ë–õ–û–ö–ê -->

        <!-- –ú–ï–°–Ø–ß–ù–´–ô –û–¢–ß–ï–¢ –ü–û –ó–ê–†–ü–õ–ê–¢–ï -->
        <h4 class="text-lg font-semibold mb-4 text-gray-700 text-center">–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ</h4>
        <div id="salaryResults" class="space-y-6">
          <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
        </div>
         <!-- –ö–û–ù–ï–¶ –ú–ï–°–Ø–ß–ù–û–ì–û –û–¢–ß–ï–¢–ê -->
      </div>
    </section>

    <!-- –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight">–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-7xl mx-auto">
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-200">
          <h3 class="text-xl font-semibold mb-5 border-b border-gray-200 pb-3 text-gray-900 tracking-tight">–ë—É–¥–Ω–∏–µ –¥–Ω–∏</h3>
          <ul class="space-y-4 text-gray-700 text-base leading-relaxed">
            <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-indigo-600 text-lg flex-shrink-0"></i>
              <span>PS5 (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 150 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-indigo-600 text-lg flex-shrink-0"></i>
              <span>PS5 (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 300 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-vr-cardboard text-blue-600 text-lg flex-shrink-0"></i>
              <span>VR –æ—á–∫–∏ (1 —à—Ç.) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-vr-cardboard text-blue-600 text-lg flex-shrink-0"></i>
              <span>VR –æ—á–∫–∏ (2 —à—Ç.) ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-vr-cardboard text-blue-600 text-lg flex-shrink-0"></i>
              <span>VR –æ—á–∫–∏ (3 —à—Ç.) ‚Äî 1500 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-vr-cardboard text-blue-600 text-lg flex-shrink-0"></i>
              <span>VR –æ—á–∫–∏ (4 —à—Ç.) ‚Äî 2000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-child text-orange-600 text-lg flex-shrink-0"></i>
              <span>X-Box Kinnect (–¥–æ 8 —á–µ–ª.) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-green-600 text-lg flex-shrink-0"></i>
              <span>X-Box (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 250 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-green-600 text-lg flex-shrink-0"></i>
              <span>X-Box (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-green-600 text-lg flex-shrink-0"></i>
              <span>X-Box (3 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 750 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-green-600 text-lg flex-shrink-0"></i>
              <span>X-Box (4 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-microphone text-pink-600 text-lg flex-shrink-0"></i>
              <span>–ö–∞—Ä–∞–æ–∫–µ ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-dice-d6 text-purple-600 text-lg flex-shrink-0"></i>
              <span>–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
          </ul>
        </div>
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-200">
          <h3 class="text-xl font-semibold mb-5 border-b border-gray-200 pb-3 text-gray-900 tracking-tight">–í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏</h3>
          <ul class="space-y-4 text-gray-700 text-base leading-relaxed">
            <li class="flex items-center space-x-3">
              <i class="fas fa-vr-cardboard text-blue-600 text-lg flex-shrink-0"></i>
              <span>VR –æ—á–∫–∏ (1 —à—Ç.) ‚Äî 750 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-vr-cardboard text-blue-600 text-lg flex-shrink-0"></i>
              <span>VR –æ—á–∫–∏ (2 —à—Ç.) ‚Äî 1500 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-vr-cardboard text-blue-600 text-lg flex-shrink-0"></i>
              <span>VR –æ—á–∫–∏ (3 —à—Ç.) ‚Äî 2250 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-vr-cardboard text-blue-600 text-lg flex-shrink-0"></i>
              <span>VR –æ—á–∫–∏ (4 —à—Ç.) ‚Äî 3000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-indigo-600 text-lg flex-shrink-0"></i>
               <span>PS5 (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 150 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-indigo-600 text-lg flex-shrink-0"></i>
              <span>PS5 (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 300 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-child text-orange-600 text-lg flex-shrink-0"></i>
              <span>X-Box Kinnect (–¥–æ 8 —á–µ–ª.) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-green-600 text-lg flex-shrink-0"></i>
              <span>X-Box (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 250 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-green-600 text-lg flex-shrink-0"></i>
              <span>X-Box (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-green-600 text-lg flex-shrink-0"></i>
              <span>X-Box (3 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 750 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-gamepad text-green-600 text-lg flex-shrink-0"></i>
              <span>X-Box (4 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fas fa-microphone text-pink-600 text-lg flex-shrink-0"></i>
              <span>–ö–∞—Ä–∞–æ–∫–µ ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
             <li class="flex items-center space-x-3">
              <i class="fas fa-dice-d6 text-purple-600 text-lg flex-shrink-0"></i>
              <span>–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
          </ul>
        </div>
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-200">
          <h3 class="text-xl font-semibold mb-5 border-b border-gray-200 pb-3 text-gray-900 tracking-tight flex items-center">
             <i class="fas fa-birthday-cake text-red-600 text-lg mr-2 flex-shrink-0"></i>
             <span>–ê—Ä–µ–Ω–¥–∞ –≤—Å–µ–≥–æ (–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è)</span>
           </h3>
          <ul class="space-y-3 text-gray-700 text-base leading-relaxed">
            <li>–ü–µ—Ä–≤—ã–π —á–∞—Å ‚Äî 4000 —Ä—É–±.</li>
            <li>–í—Ç–æ—Ä–æ–π —á–∞—Å ‚Äî 3500 —Ä—É–±.</li>
            <li>–¢—Ä–µ—Ç–∏–π —á–∞—Å ‚Äî 3000 —Ä—É–±.</li>
            <li>–ß–µ—Ç–≤–µ—Ä—Ç—ã–π –∏ –¥–∞–ª–µ–µ ‚Äî 3000 —Ä—É–±./—á–∞—Å</li>
          </ul>
          <p class="mt-5 font-semibold text-gray-900 tracking-tight">–í —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Ö–æ–¥–∏—Ç –∞—Ä–µ–Ω–¥–∞ –≤—Å–µ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è:</p>
          <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2 text-base leading-relaxed">
            <li>VR –æ—á–∫–∏</li>
            <li>PS –∫–æ–º–Ω–∞—Ç–∞</li>
            <li>–ö–∞—Ä–∞–æ–∫–µ</li>
            <li>–ö–∏–Ω–æ</li>
            <li>XBOX 360</li>
            <li>–¢–∞–Ω—Ü—ã –≤ XBOX</li>
            <li>–ò–≥—Ä—ã –Ω–∞ –ü–ö</li>
          </ul>
          <p class="mt-4 font-semibold text-gray-900 tracking-tight">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏:</p>
          <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2 text-base leading-relaxed">
            <li><span class="font-medium">–í–µ–¥—É—â–∞—è:</span> 1000 ‚ÇΩ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è)</li>
          </ul>
          <p class="mt-4 text-gray-500 italic text-sm">–ú–æ–∂–Ω–æ –∑–∞–∫–∞–∑–∞—Ç—å —Å–≤–æ—é –µ–¥—É –∏ –Ω–∞–ø–∏—Ç–∫–∏</p>
        </div>
      </div>
    </section>

    <!-- –í–∏–¥–∂–µ—Ç—ã: –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã, –û—Ç–∑—ã–≤—ã -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold mb-8 text-center text-gray-900 tracking-tight">–ú—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö –∏ –Ω–∞ –∫–∞—Ä—Ç–∞—Ö</h2>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
        
        <!-- –í–∏–¥–∂–µ—Ç –í–ö–æ–Ω—Ç–∞–∫—Ç–µ -->
        <div class="widget-container bg-white rounded-3xl shadow-lg p-6 border border-gray-200 flex flex-col">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
              <i class="fab fa-vk text-blue-600 text-2xl mr-3"></i>
              <h3 class="text-xl font-semibold text-gray-900 tracking-tight">–ù–∞—à–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</h3>
            </div>
            <button class="share-button" onclick="openShareModal('vk', 'https://vk.com/vr_lounge')">
              <i class="fas fa-share-alt"></i>
              –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≥—Ä—É–ø–ø–æ–π
            </button>
          </div>
          <div class="flex-grow flex items-center justify-center">
            <div id="vk_groups" class="w-full"></div>
          </div>
        </div>

        <!-- –í–∏–¥–∂–µ—Ç –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã -->
        <div class="widget-container bg-white rounded-3xl shadow-lg p-6 border border-gray-200 flex flex-col">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
              <i class="fas fa-map-marker-alt text-red-600 text-2xl mr-3"></i>
              <h3 class="text-xl font-semibold text-gray-900 tracking-tight">–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ</h3>
            </div>
            <button class="share-button" onclick="openShareModal('maps', 'https://yandex.ru/maps/-/CHCriIOU')">
              <i class="fas fa-map-pin"></i>
              –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
            </button>
          </div>
          <div class="flex-grow flex items-center justify-center">
            <iframe 
              src="https://yandex.ru/map-widget/v1/?z=12&ol=biz&oid=180466118783" 
              width="100%" 
              height="600" 
              frameborder="0"
              class="widget-iframe">
            </iframe>
          </div>
        </div>

        <!-- –í–∏–¥–∂–µ—Ç –û—Ç–∑—ã–≤—ã -->
        <div class="widget-container bg-white rounded-3xl shadow-lg p-6 border border-gray-200 flex flex-col">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
              <i class="fas fa-star text-yellow-500 text-2xl mr-3"></i>
              <h3 class="text-xl font-semibold text-gray-900 tracking-tight">–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
            </div>
            <button class="share-button" onclick="openShareModal('reviews', 'https://yandex.ru/maps/org/vr_lounge_igrovoy_ray/180466118783/reviews')">
              <i class="fas fa-star"></i>
              –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –æ—Ç–∑—ã–≤–∞–º–∏
            </button>
          </div>
          <div class="flex-grow flex items-center justify-center">
            <div style="width:100%;height:600px;overflow:hidden;position:relative;">
              <iframe 
                class="widget-iframe"
                style="width:100%;height:100%;border:1px solid #e6e6e6;box-sizing:border-box" 
                src="https://yandex.ru/maps-reviews-widget/180466118783?comments">
              </iframe>
              <a 
                href="https://yandex.ru/maps/org/vr_lounge_igrovoy_ray/180466118783/" 
                target="_blank" 
                style="box-sizing:border-box;text-decoration:none;color:#b3b3b3;font-size:10px;font-family:YS Text,sans-serif;padding:0 20px;position:absolute;bottom:8px;width:100%;text-align:center;left:0;overflow:hidden;text-overflow:ellipsis;display:block;max-height:14px;white-space:nowrap;padding:0 16px;box-sizing:border-box">
                VR Lounge - –ò–≥—Ä–æ–≤–æ–π –†–∞–π –Ω–∞ –∫–∞—Ä—Ç–µ –ö–æ–ª—å—á—É–≥–∏–Ω–æ ‚Äî –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã
              </a>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" -->
  <div id="shareModal" class="share-modal fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center p-6 hidden z-50">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative ring-1 ring-gray-200">
      <button id="closeShareModal" onclick="closeShareModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-3xl font-thin leading-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full w-10 h-10 flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ">&times;</button>
      <h3 id="shareModalTitle" class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</h3>
      
      <div class="space-y-3">
        <!-- WhatsApp -->
        <a id="shareWhatsApp" class="share-option flex items-center space-x-3 bg-gray-50 hover:bg-gray-100 rounded-xl p-4 transition-colors" target="_blank">
          <i class="fa-brands fa-whatsapp text-2xl" style="color: #25D366;"></i>
          <span class="text-gray-900">WhatsApp</span>
        </a>
        
        <!-- Telegram -->
        <a id="shareTelegram" class="share-option flex items-center space-x-3 bg-gray-50 hover:bg-gray-100 rounded-xl p-4 transition-colors" target="_blank">
          <i class="fa-brands fa-telegram text-2xl" style="color: #0088cc;"></i>
          <span class="text-gray-900">Telegram</span>
        </a>
        
        <!-- –í–ö–æ–Ω—Ç–∞–∫—Ç–µ -->
        <a id="shareVK" class="share-option flex items-center space-x-3 bg-gray-50 hover:bg-gray-100 rounded-xl p-4 transition-colors" target="_blank">
          <i class="fa-brands fa-vk text-2xl" style="color: #4c75a3;"></i>
          <span class="text-gray-900">–í–ö–æ–Ω—Ç–∞–∫—Ç–µ</span>
        </a>
        
        <!-- –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É -->
        <button id="copyLink" class="share-option flex items-center space-x-3 bg-gray-50 hover:bg-gray-100 rounded-xl p-4 transition-colors w-full">
          <i class="fa-solid fa-copy text-2xl text-gray-600"></i>
          <span class="text-gray-900">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</span>
        </button>
        
        <!-- Email -->
        <a id="shareEmail" class="share-option flex items-center space-x-3 bg-gray-50 hover:bg-gray-100 rounded-xl p-4 transition-colors" target="_blank">
          <i class="fa-solid fa-envelope text-2xl" style="color: #dc3545;"></i>
          <span class="text-gray-900">Email</span>
        </a>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
  <div id="bookingModal" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center p-6 hidden z-50">
    <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto p-8 relative ring-1 ring-gray-200">
      <button id="closeModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-3xl font-thin leading-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full w-10 h-10 flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ">&times;</button>
      <h3 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight" id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞</h3>
      <form id="bookingForm" class="space-y-6">
        <input type="hidden" id="bookingId" name="bookingId" />
        <div>
          <label for="clientName" class="block text-gray-900 font-semibold mb-2">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
          <input type="text" id="clientName" name="clientName" required autocomplete="off" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞" />
        </div>
        <div>
          <label for="clientPhone" class="block text-gray-900 font-semibold mb-2">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
          <input type="tel" id="clientPhone" name="clientPhone" required autocomplete="off" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="+7 (XXX) XXX-XX-XX" />
        </div>
        <div>
          <label for="bookingDate" class="block text-gray-900 font-semibold mb-2">–î–∞—Ç–∞</label>
          <input type="date" id="bookingDate" name="bookingDate" required class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition" />
        </div>
        <div>
          <label for="startTime" class="block text-gray-900 font-semibold mb-2">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
          <input type="time" id="startTime" name="startTime" required class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition" />
        </div>
        <div>
          <label for="duration" class="block text-gray-900 font-semibold mb-2">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)</label>
          <select id="duration" name="duration" required class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
            <option value="0.5">0.5</option>
            <option value="1" selected>1</option>
            <option value="1.5">1.5</option>
            <option value="2">2</option>
            <option value="2.5">2.5</option>
            <option value="3">3</option>
            <option value="3.5">3.5</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
          </select>
        </div>

        <!-- –£—Å–ª—É–≥–∏ -->
        <div>
          <label class="block text-gray-900 font-semibold mb-2">–£—Å–ª—É–≥–∏</label>
          <div id="servicesContainer" class="flex flex-wrap gap-3">
            <button type="button" class="service-tag" data-service="weekday_ps1" data-price="150">
              <div class="service-tag-line1"><i class="fas fa-gamepad text-indigo-600"></i> <span>PS5 (1 –¥–∂–æ–π—Å—Ç–∏–∫)</span></div>
              <div class="service-tag-price">150 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekday_ps2" data-price="300">
              <div class="service-tag-line1"><i class="fas fa-gamepad text-indigo-600"></i> <span>PS5 (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞)</span></div>
              <div class="service-tag-price">300 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekday_vr1" data-price="500">
               <div class="service-tag-line1"><i class="fas fa-vr-cardboard text-blue-600"></i> <span>VR –æ—á–∫–∏ (1 —à—Ç.) | –ë—É–¥–Ω–∏</span></div>
               <div class="service-tag-price">500 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekday_vr2" data-price="1000">
               <div class="service-tag-line1"><i class="fas fa-vr-cardboard text-blue-600"></i> <span>VR –æ—á–∫–∏ (2 —à—Ç.) | –ë—É–¥–Ω–∏</span></div>
               <div class="service-tag-price">1000 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekday_vr3" data-price="1500">
               <div class="service-tag-line1"><i class="fas fa-vr-cardboard text-blue-600"></i> <span>VR –æ—á–∫–∏ (3 —à—Ç.) | –ë—É–¥–Ω–∏</span></div>
               <div class="service-tag-price">1500 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekday_vr4" data-price="2000">
               <div class="service-tag-line1"><i class="fas fa-vr-cardboard text-blue-600"></i> <span>VR –æ—á–∫–∏ (4 —à—Ç.) | –ë—É–¥–Ω–∏</span></div>
               <div class="service-tag-price">2000 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekend_vr1" data-price="750">
               <div class="service-tag-line1"><i class="fas fa-vr-cardboard text-blue-600"></i> <span>VR –æ—á–∫–∏ (1 —à—Ç.) | –í—ã—Ö–æ–¥–Ω—ã–µ</span></div>
               <div class="service-tag-price">750 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekend_vr2" data-price="1500">
               <div class="service-tag-line1"><i class="fas fa-vr-cardboard text-blue-600"></i> <span>VR –æ—á–∫–∏ (2 —à—Ç.) | –í—ã—Ö–æ–¥–Ω—ã–µ</span></div>
               <div class="service-tag-price">1500 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekend_vr3" data-price="2250">
               <div class="service-tag-line1"><i class="fas fa-vr-cardboard text-blue-600"></i> <span>VR –æ—á–∫–∏ (3 —à—Ç.) | –í—ã—Ö–æ–¥–Ω—ã–µ</span></div>
               <div class="service-tag-price">2250 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="weekend_vr4" data-price="3000">
               <div class="service-tag-line1"><i class="fas fa-vr-cardboard text-blue-600"></i> <span>VR –æ—á–∫–∏ (4 —à—Ç.) | –í—ã—Ö–æ–¥–Ω—ã–µ</span></div>
               <div class="service-tag-price">3000 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="xbox_kinnect" data-price="500">
               <div class="service-tag-line1"><i class="fas fa-child text-orange-600"></i> <span>X-Box Kinnect (–¥–æ 8 —á–µ–ª.)</span></div>
               <div class="service-tag-price">500 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="xbox1" data-price="250">
               <div class="service-tag-line1"><i class="fas fa-gamepad text-green-600"></i> <span>X-Box (1 –¥–∂–æ–π—Å—Ç–∏–∫)</span></div>
               <div class="service-tag-price">250 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="xbox2" data-price="500">
               <div class="service-tag-line1"><i class="fas fa-gamepad text-green-600"></i> <span>X-Box (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞)</span></div>
               <div class="service-tag-price">500 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="xbox3" data-price="750">
               <div class="service-tag-line1"><i class="fas fa-gamepad text-green-600"></i> <span>X-Box (3 –¥–∂–æ–π—Å—Ç–∏–∫–∞)</span></div>
               <div class="service-tag-price">750 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="xbox4" data-price="1000">
               <div class="service-tag-line1"><i class="fas fa-gamepad text-green-600"></i> <span>X-Box (4 –¥–∂–æ–π—Å—Ç–∏–∫–∞)</span></div>
               <div class="service-tag-price">1000 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="karaoke" data-price="1000">
               <div class="service-tag-line1"><i class="fas fa-microphone text-pink-600"></i> <span>–ö–∞—Ä–∞–æ–∫–µ</span></div>
               <div class="service-tag-price">1000 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="board_games" data-price="500">
               <div class="service-tag-line1"><i class="fas fa-dice-d6 text-purple-600"></i> <span>–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã</span></div>
               <div class="service-tag-price">500 ‚ÇΩ/—á–∞—Å</div>
            </button>
            <button type="button" class="service-tag" data-service="birthday" data-price="4000">
               <div class="service-tag-line1"><i class="fas fa-birthday-cake text-red-600"></i> <span>–ê—Ä–µ–Ω–¥–∞ –≤—Å–µ–≥–æ (–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è)</span></div>
               <div class="service-tag-price">–æ—Ç 3000 ‚ÇΩ/—á–∞—Å</div> <!-- –¶–µ–Ω–∞ –¥–ª—è –î–† –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è -->
            </button>
            <button type="button" class="service-tag" data-service="hostess" data-price="1000">
               <div class="service-tag-line1"><i class="fas fa-user-tie text-pink-600"></i> <span>–í–µ–¥—É—â–∞—è</span></div>
               <div class="service-tag-price">1000 ‚ÇΩ</div>
            </button>
        </div>
          <input type="hidden" id="selectedServices" name="selectedServices">
        </div>

        <!-- –°—É–º–º–∞ (–±—ã–ª–æ –≤ grid) -->
        <div>
            <label class="block text-gray-900 font-semibold mb-2">–°—É–º–º–∞</label>
            <div class="flex items-center">
              <input type="text" id="totalAmount" readonly class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 bg-gray-50" value="0 ‚ÇΩ">
            </div>
        </div>
        
        <!-- –°–∫–∏–¥–∫–∞ (–±—ã–ª–æ –≤ grid) -->
        <div>
            <label class="block text-gray-900 font-semibold mb-2">–°–∫–∏–¥–∫–∞</label>
            <div class="flex items-center space-x-2">
              <input type="number" id="discountPercent" min="0" max="100" class="w-1/2 rounded-3xl border border-gray-300 px-5 py-3 text-gray-900" placeholder="%">
              <span class="text-gray-500">–∏–ª–∏</span>
              <input type="number" id="discountAmount" min="0" class="w-1/2 rounded-3xl border border-gray-300 px-5 py-3 text-gray-900" placeholder="‚ÇΩ">
            </div>
        </div>

        <!-- –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ -->
        <div class="grid grid-cols-3 gap-3">
          <div>
            <label class="block text-gray-900 font-semibold mb-2">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (‚ÇΩ)</label>
            <input type="number" id="prepayAmount" min="0" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900" placeholder="0">
          </div>
          <div>
            <label class="block text-gray-900 font-semibold mb-2">–ú–µ—Ç–æ–¥</label>
            <select id="prepayMethod" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900">
              <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ</option>
              <option value="transfer">–ü–µ—Ä–µ–≤–æ–¥</option>
            </select>
          </div>
          <div>
            <label class="block text-gray-900 font-semibold mb-2">–î–∞—Ç–∞</label>
            <input type="date" id="prepayDate" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900">
          </div>
        </div>

        <!-- –î–æ–ø–ª–∞—Ç–∞ (–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ù–∞–ª–∏—á–Ω—ã–µ –∏ –ü–µ—Ä–µ–≤–æ–¥) -->
        <div class="space-y-4 mt-4">
          <div>
            <label class="block text-gray-900 font-semibold mb-2">–î–æ–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ (‚ÇΩ)</label>
            <div class="grid grid-cols-2 gap-3">
              <input type="number" id="finalPayAmountCash" min="0" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900" placeholder="0">
              <input type="date" id="finalPayDateCash" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900">
            </div>
          </div>
          <div>
            <label class="block text-gray-900 font-semibold mb-2">–î–æ–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º (‚ÇΩ)</label>
            <div class="grid grid-cols-2 gap-3">
              <input type="number" id="finalPayAmountTransfer" min="0" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900" placeholder="0">
              <input type="date" id="finalPayDateTransfer" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900">
            </div>
          </div>
        </div>

        <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∏–∂–µ) -->
        <div>
          <label class="block text-gray-900 font-semibold mb-2">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
          <div class="flex items-center">
            <input type="text" id="finalAmount" readonly class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 bg-gray-50 font-semibold" value="0 ‚ÇΩ">
          </div>
        </div>

        <div>
          <label for="notes" class="block text-gray-900 font-semibold mb-2">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
          <textarea id="notes" name="notes" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition resize-none"></textarea>
        </div>
        <div class="flex space-x-4">
          <button type="submit" class="flex-grow bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white py-3 rounded-3xl font-semibold transition focus:ring-4 focus:ring-blue-300 focus:outline-none">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
          <button type="button" id="deleteBookingBtn" class="hidden flex-grow bg-red-600 hover:bg-red-700 active:bg-red-800 text-white py-3 rounded-3xl font-semibold transition focus:ring-4 focus:ring-red-300 focus:outline-none">–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
  <div id="assignAdminModal" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center p-6 hidden z-50" onclick="event.target === this && this.classList.add('hidden')">
    <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto p-8 relative ring-1 ring-gray-200" onclick="event.stopPropagation()">
      <button id="closeAssignModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-3xl font-thin leading-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full w-10 h-10 flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ">&times;</button>
      <h3 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight" id="assignModalTitle">–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
      <form id="assignAdminForm" class="space-y-6">
        <input type="hidden" id="assignDate" name="assignDate">
        <div>
          <label class="block text-gray-900 font-semibold mb-2">–û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</label>
          <select id="mainAdmin" name="mainAdmin" required class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</option>
            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </select>
        </div>
        <div id="helperAdminSection" class="space-y-4"> <!-- –£–±—Ä–∞–Ω 'hidden' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç.–∫. —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞ –≤ JS -->
          <label class="block text-gray-900 font-semibold mb-2">–ü–æ–º–æ—â–Ω–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
          <select id="helperAdmin" name="helperAdmin" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
            <option value="">–ù–µ—Ç –ø–æ–º–æ—â–Ω–∏–∫–∞</option>
            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </select>
          
          <!-- –ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –î–Ω—è –†–æ–∂–¥–µ–Ω–∏—è -->
          <div id="birthdayBookingSection" class="hidden"> 
            <label class="block text-gray-900 font-semibold mb-2">–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è (–ê—Ä–µ–Ω–¥–∞ –î–†)</label>
            <select id="birthdayBookingSelect" name="birthdayBooking" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none transition">
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è</option>
              <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </select>
            <p class="text-sm text-gray-500 mt-1">–ü–æ–º–æ—â–Ω–∏–∫ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è "–ê—Ä–µ–Ω–¥–∞ (–î–†)"</p>
          </div>
          
          <div id="helperHoursSection" class="hidden"> <!-- –°–µ–∫—Ü–∏—è —á–∞—Å–æ–≤ —Å–∫—Ä—ã—Ç–∞, –ø–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω –ø–æ–º–æ—â–Ω–∏–∫ -->
            <label class="block text-gray-900 font-semibold mb-2">–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã –ø–æ–º–æ—â–Ω–∏–∫–∞</label>
            <input type="number" id="helperHours" name="helperHours" min="1" max="24" class="w-full rounded-3xl border border-gray-300 px-5 py-3 text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none transition" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤">
            <p id="maxHelperHoursNote" class="text-sm text-gray-500 mt-1 hidden">–ú–∞–∫—Å–∏–º—É–º —á–∞—Å–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: <span id="maxHelperHours">0</span></p>
          </div>
        </div>
        <div class="flex space-x-4">
          <button type="submit" class="flex-grow bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white py-3 rounded-3xl font-semibold transition focus:ring-4 focus:ring-blue-300 focus:outline-none">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</button>
          <button type="button" id="deleteAssignmentBtn" class="hidden flex-grow bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white py-3 rounded-3xl font-semibold transition focus:ring-4 focus:ring-gray-300 focus:outline-none">–£–¥–∞–ª–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</button>
        </div>
      </form>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–∞–ø–∏—Å–µ–π –∑–∞ –¥–µ–Ω—å -->
  <div id="dayDetailsModal" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center p-6 hidden z-50" onclick="event.target === this && this.classList.add('hidden')">
    <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 relative ring-1 ring-gray-200" onclick="event.stopPropagation()">
      <button id="closeDayDetailsModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-3xl font-thin leading-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full w-10 h-10 flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ">&times;</button>
      <h3 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight" id="dayDetailsTitle">–ó–∞–ø–∏—Å–∏ –Ω–∞ –¥–µ–Ω—å</h3>
      <div id="dayDetailsContent" class="space-y-4">
        <!-- –î–µ—Ç–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∑–∞ –¥–µ–Ω—å -->
  <div id="adminDayDetailsModal" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center p-6 hidden z-50" onclick="event.target === this && this.classList.add('hidden')">
    <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 relative ring-1 ring-gray-200" onclick="event.stopPropagation()">
      <button id="closeAdminDayDetailsModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-3xl font-thin leading-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full w-10 h-10 flex items-center justify-center" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ">&times;</button>
      <h3 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight" id="adminDayDetailsTitle">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–º–µ–Ω–µ</h3>
      <div id="adminDayDetailsContent" class="space-y-4">
        <!-- –î–µ—Ç–∞–ª–∏ –æ —Å–º–µ–Ω–µ –∏ –∑–∞—Ä–ø–ª–∞—Ç–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
      </div>
    </div>
  </div>

  <!-- === –°–ï–ö–¶–ò–Ø –£–°–õ–£–ì === -->
  <section id="servicesSection" class="hidden max-w-7xl mx-auto my-8">
    <h2 class="text-2xl font-semibold mb-6 text-center text-gray-900 tracking-tight">–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-200">
          <h3 class="text-xl font-semibold mb-5 border-b border-gray-200 pb-3 text-gray-900 tracking-tight">–ë—É–¥–Ω–∏–µ –¥–Ω–∏</h3>
          <ul class="space-y-4 text-gray-700 text-base leading-relaxed">
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #6366f1;"></i>
              <span>PS5 (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 150 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #6366f1;"></i>
              <span>PS5 (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 300 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏ (1 —à—Ç.) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏ (2 —à—Ç.) ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏ (3 —à—Ç.) ‚Äî 1500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏ (4 —à—Ç.) ‚Äî 2000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-person text-2xl" style="color: #f97316;"></i>
              <span>X-Box Kinnect (–¥–æ 8 —á–µ–ª.) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>X-Box (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 250 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>X-Box (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>X-Box (3 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 750 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>X-Box (4 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-microphone text-2xl" style="color: #ec4899;"></i>
              <span>–ö–∞—Ä–∞–æ–∫–µ ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-dice text-2xl" style="color: #9333ea;"></i>
              <span>–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
          </ul>
        </div>
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-200">
          <h3 class="text-xl font-semibold mb-5 border-b border-gray-200 pb-3 text-gray-900 tracking-tight">–í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏</h3>
          <ul class="space-y-4 text-gray-700 text-base leading-relaxed">
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏ (1 —à—Ç.) ‚Äî 750 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏ (2 —à—Ç.) ‚Äî 1500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏ (3 —à—Ç.) ‚Äî 2250 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏ (4 —à—Ç.) ‚Äî 3000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #6366f1;"></i>
              <span>PS5 (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 150 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #6366f1;"></i>
              <span>PS5 (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 300 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-person text-2xl" style="color: #f97316;"></i>
              <span>X-Box Kinnect (–¥–æ 8 —á–µ–ª.) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>X-Box (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 250 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>X-Box (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>X-Box (3 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 750 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>X-Box (4 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-microphone text-2xl" style="color: #ec4899;"></i>
              <span>–ö–∞—Ä–∞–æ–∫–µ ‚Äî 1000 ‚ÇΩ/—á–∞—Å</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-dice text-2xl" style="color: #9333ea;"></i>
              <span>–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã ‚Äî 500 ‚ÇΩ/—á–∞—Å</span>
            </li>
          </ul>
        </div>
        <div class="bg-white rounded-3xl shadow-lg p-8 border border-gray-200">
          <h3 class="text-xl font-semibold mb-5 border-b border-gray-200 pb-3 text-gray-900 tracking-tight flex items-center">
            <i class="fa-solid fa-cake-candles text-2xl mr-2" style="color: #ef4444;"></i>
            <span>–ê—Ä–µ–Ω–¥–∞ –≤—Å–µ–≥–æ (–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è)</span>
          </h3>
          <ul class="space-y-3 text-gray-700 text-base leading-relaxed">
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-clock text-2xl" style="color: #3b82f6;"></i>
              <span>–ü–µ—Ä–≤—ã–π —á–∞—Å ‚Äî 4000 —Ä—É–±.</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-clock text-2xl" style="color: #3b82f6;"></i>
              <span>–í—Ç–æ—Ä–æ–π —á–∞—Å ‚Äî 3500 —Ä—É–±.</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-clock text-2xl" style="color: #3b82f6;"></i>
              <span>–¢—Ä–µ—Ç–∏–π —á–∞—Å ‚Äî 3000 —Ä—É–±.</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-clock text-2xl" style="color: #3b82f6;"></i>
              <span>–ß–µ—Ç–≤–µ—Ä—Ç—ã–π –∏ –¥–∞–ª–µ–µ ‚Äî 3000 —Ä—É–±./—á–∞—Å</span>
            </li>
          </ul>
          <p class="mt-5 font-semibold text-gray-900 tracking-tight">–í —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Ö–æ–¥–∏—Ç –∞—Ä–µ–Ω–¥–∞ –≤—Å–µ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è:</p>
          <ul class="space-y-2 mt-2 text-gray-700 text-base leading-relaxed">
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-vr-cardboard text-2xl" style="color: #3b82f6;"></i>
              <span>VR –æ—á–∫–∏</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #6366f1;"></i>
              <span>PS –∫–æ–º–Ω–∞—Ç–∞</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-microphone text-2xl" style="color: #ec4899;"></i>
              <span>–ö–∞—Ä–∞–æ–∫–µ</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-film text-2xl" style="color: #64748b;"></i>
              <span>–ö–∏–Ω–æ</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-gamepad text-2xl" style="color: #22c55e;"></i>
              <span>XBOX 360</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-person text-2xl" style="color: #f97316;"></i>
              <span>–¢–∞–Ω—Ü—ã –≤ XBOX</span>
            </li>
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-desktop text-2xl" style="color: #0ea5e9;"></i>
              <span>–ò–≥—Ä—ã –Ω–∞ –ü–ö</span>
            </li>
          </ul>
          <p class="mt-4 font-semibold text-gray-900 tracking-tight">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏:</p>
          <ul class="space-y-2 mt-2 text-gray-700 text-base leading-relaxed">
            <li class="flex items-center space-x-3">
              <i class="fa-solid fa-user-group text-2xl" style="color: #8b5cf6;"></i>
              <span><span class="font-medium">–í–µ–¥—É—â–∞—è:</span> 1000 ‚ÇΩ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è)</span>
            </li>
          </ul>
          <p class="mt-4 text-gray-500 italic text-sm flex items-center space-x-2">
            <i class="fa-solid fa-utensils text-gray-400"></i>
            <span>–ú–æ–∂–Ω–æ –∑–∞–∫–∞–∑–∞—Ç—å —Å–≤–æ—é –µ–¥—É –∏ –Ω–∞–ø–∏—Ç–∫–∏</span>
          </p>
        </div>
      </div>
  </section>

  <!-- === –°–ï–ö–¶–ò–Ø –í–ò–î–ñ–ï–¢–û–í === -->
  <section id="widgetsSection" class="hidden max-w-7xl mx-auto my-8">
    <h2 class="text-2xl font-semibold mb-8 text-center text-gray-900 tracking-tight">–ú—ã –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö –∏ –Ω–∞ –∫–∞—Ä—Ç–∞—Ö</h2>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- –í–∏–¥–∂–µ—Ç –í–ö–æ–Ω—Ç–∞–∫—Ç–µ -->
      <div class="widget-container bg-white rounded-3xl shadow-lg p-6 border border-gray-200 flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center">
            <i class="fab fa-vk text-blue-600 text-2xl mr-3"></i>
            <h3 class="text-xl font-semibold text-gray-900 tracking-tight">–ù–∞—à–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</h3>
          </div>
          <button class="share-button" onclick="openShareModal('vk', 'https://vk.com/vr_lounge')">
            <i class="fas fa-share-alt"></i>
            –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≥—Ä—É–ø–ø–æ–π
          </button>
        </div>
        <div class="flex-grow flex items-center justify-center">
          <div id="vk_groups" class="w-full"></div>
        </div>
      </div>

      <!-- –í–∏–¥–∂–µ—Ç –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã -->
      <div class="widget-container bg-white rounded-3xl shadow-lg p-6 border border-gray-200 flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center">
            <i class="fas fa-map-marker-alt text-red-600 text-2xl mr-3"></i>
            <h3 class="text-xl font-semibold text-gray-900 tracking-tight">–ú—ã –Ω–∞ –∫–∞—Ä—Ç–µ</h3>
          </div>
          <button class="share-button" onclick="openShareModal('maps', 'https://yandex.ru/maps/-/CHCriIOU')">
            <i class="fas fa-map-pin"></i>
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
          </button>
        </div>
        <div class="flex-grow flex items-center justify-center">
          <iframe 
            src="https://yandex.ru/map-widget/v1/?z=12&ol=biz&oid=180466118783" 
            width="100%" 
            height="600" 
            frameborder="0"
            class="widget-iframe">
          </iframe>
        </div>
      </div>

      <!-- –í–∏–¥–∂–µ—Ç –û—Ç–∑—ã–≤—ã -->
      <div class="widget-container bg-white rounded-3xl shadow-lg p-6 border border-gray-200 flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center">
            <i class="fas fa-star text-yellow-500 text-2xl mr-3"></i>
            <h3 class="text-xl font-semibold text-gray-900 tracking-tight">–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
          </div>
          <button class="share-button" onclick="openShareModal('reviews', 'https://yandex.ru/maps/org/vr_lounge_igrovoy_ray/180466118783/reviews')">
            <i class="fas fa-star"></i>
            –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –æ—Ç–∑—ã–≤–∞–º–∏
          </button>
        </div>
        <div class="flex-grow flex items-center justify-center">
          <div style="width:100%;height:600px;overflow:hidden;position:relative;">
            <iframe 
              class="widget-iframe"
              style="width:100%;height:100%;border:1px solid #e6e6e6;box-sizing:border-box" 
              src="https://yandex.ru/maps-reviews-widget/180466118783?comments">
            </iframe>
            <a 
              href="https://yandex.ru/maps/org/vr_lounge_igrovoy_ray/180466118783/" 
              target="_blank" 
              style="box-sizing:border-box;text-decoration:none;color:#b3b3b3;font-size:10px;font-family:YS Text,sans-serif;padding:0 20px;position:absolute;bottom:8px;width:100%;text-align:center;left:0;overflow:hidden;text-overflow:ellipsis;display:block;max-height:14px;white-space:nowrap;padding:0 16px;box-sizing:border-box">
              VR Lounge - –ò–≥—Ä–æ–≤–æ–π –†–∞–π –Ω–∞ –∫–∞—Ä—Ç–µ –ö–æ–ª—å—á—É–≥–∏–Ω–æ ‚Äî –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- === –°–ï–ö–¶–ò–Ø –£–ß–Å–¢–ê –†–ê–°–•–û–î–û–í (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) === -->
  <section id="expensesSection" class="hidden max-w-3xl mx-auto my-8 bg-white rounded-2xl shadow-lg p-6">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-bold text-gray-900 flex items-center">
      <i class="fas fa-receipt mr-2 text-blue-500"></i>–£—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤
    </h2>
    <button id="addExpenseBtn" onclick="document.getElementById('addExpenseModal').classList.remove('hidden')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold flex items-center">
      <i class="fa-solid fa-plus mr-2"></i>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥
    </button>
  </div>
  <div class="flex flex-wrap gap-4 mb-4">
    <div>
      <label for="categoryFilter" class="block text-sm text-gray-600 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
      <select id="categoryFilter" class="border rounded-lg px-3 py-2 w-48">
        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        <option value="utilities">–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</option>
        <option value="consumables">–†–∞—Å—Ö–æ–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</option>
        <option value="equipment">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</option>
        <option value="food">–ü—Ä–æ–¥—É–∫—Ç—ã</option>
        <option value="other">–ü—Ä–æ—á–µ–µ</option>
      </select>
    </div>
    <div class="flex flex-col justify-end">
      <span class="text-gray-600 text-sm">–ó–∞ –º–µ—Å—è—Ü:</span>
      <span id="monthlyExpenses" class="text-xl font-bold text-blue-700">0 ‚ÇΩ</span>
    </div>
    <div class="flex flex-col justify-end">
      <span class="text-gray-600 text-sm">–í—Å–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤:</span>
      <span id="totalExpenses" class="text-xl font-bold text-blue-700">0</span>
    </div>
  </div>
  <div id="expensesList" class="space-y-3"></div>
</section>

<!-- === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–û–ë–ê–í–õ–ï–ù–ò–Ø –†–ê–°–•–û–î–ê === -->
<div id="addExpenseModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md relative">
    <button onclick="document.getElementById('addExpenseModal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
    <h3 class="text-xl font-bold mb-4 text-gray-900 flex items-center"><i class="fas fa-plus mr-2 text-blue-500"></i>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</h3>
    <form id="addExpenseForm" class="space-y-4" onsubmit="return false;">
      <div>
        <label class="block text-sm mb-1 text-gray-700">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select name="category" required class="border rounded-lg px-3 py-2 w-full">
          <option value="utilities">–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</option>
          <option value="consumables">–†–∞—Å—Ö–æ–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</option>
          <option value="equipment">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</option>
          <option value="food">–ü—Ä–æ–¥—É–∫—Ç—ã</option>
          <option value="other">–ü—Ä–æ—á–µ–µ</option>
        </select>
      </div>
      <div>
        <label class="block text-sm mb-1 text-gray-700">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <input name="description" required maxlength="100" class="border rounded-lg px-3 py-2 w-full" placeholder="–ß—Ç–æ –∫—É–ø–∏–ª–∏?" />
      </div>
      <div>
        <label class="block text-sm mb-1 text-gray-700">–°—É–º–º–∞ (‚ÇΩ)</label>
        <input name="amount" type="number" min="1" required class="border rounded-lg px-3 py-2 w-full" placeholder="0" />
      </div>
      <div>
        <label class="block text-sm mb-1 text-gray-700">–î–∞—Ç–∞</label>
        <input name="date" type="date" required class="border rounded-lg px-3 py-2 w-full" />
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button type="button" onclick="document.getElementById('addExpenseModal').classList.add('hidden')" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" onclick="handleAddExpense(event)" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </div>
</div>

  <!-- Firebase –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
  <script type="module">
    // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞
    async function handleAddExpense(event) {
  event.preventDefault();
  const form = document.getElementById('addExpenseForm');
  const modal = document.getElementById('addExpenseModal');
  
  try {
    if (!auth.currentUser) {
      throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
    }
    
    const expenseData = {
      category: form.category.value,
      description: form.description.value,
      amount: Number(form.amount.value),
      date: new Date(form.date.value),
      createdAt: new Date(),
      createdBy: auth.currentUser.uid
    };
    
    await addDoc(collection(db, 'expenses'), expenseData);
    modal.classList.add('hidden');
    form.reset();
    // –ù–µ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å loadExpenses, —Ç–∞–∫ –∫–∞–∫ —Å–ª—É—à–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞:', error);
    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
  }
}

    window.handleAddExpense = handleAddExpense;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
      getFirestore, collection, addDoc, getDocs, onSnapshot, 
      deleteDoc, doc, updateDoc, query, where, getDoc, setDoc, orderBy
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { 
      getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // –í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBaq_faWwfE_TXn4Xh_2U3GYSAsUzGJ1bk",
      authDomain: "vr-lounge33.firebaseapp.com",
      projectId: "vr-lounge33",
      storageBucket: "vr-lounge33.appspot.com",
      messagingSenderId: "825655988090",
      appId: "1:825655988090:web:76d8e0554b8601f8bd10c3"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // === –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ===
    // --- –û–±—â–∏–µ ---
    const authContainer = document.getElementById('authContainer');
    const loginForm = document.getElementById('loginForm');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginBtn = document.getElementById('loginBtn');
    const closeAuthBtn = document.getElementById('closeAuthBtn');

    // --- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∫–ª–∏–µ–Ω—Ç–æ–≤ ---
    const calendarEl = document.getElementById('calendar');
    const monthYearEl = document.getElementById('monthYear');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');
    const addBookingBtn = document.getElementById('addBookingBtn');

    // --- –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤ ---
    const bookingsListEl = document.getElementById('bookingsList');
    const noBookingsText = document.getElementById('noBookingsText');
    const bookingsListTitle = document.getElementById('bookingsListTitle');
    const prevMonthBookingsBtn = document.getElementById('prevMonthBookings');
    const nextMonthBookingsBtn = document.getElementById('nextMonthBookings');

    // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ ---
    const bookingModal = document.getElementById('bookingModal');
    const closeModalBtn = document.getElementById('closeModal');
    const bookingForm = document.getElementById('bookingForm');
    const modalTitle = document.getElementById('modalTitle');
    const bookingIdInput = document.getElementById('bookingId');
    const deleteBookingBtn = document.getElementById('deleteBookingBtn');
    const clientPhoneInput = document.getElementById('clientPhone');

    // --- –ì—Ä–∞—Ñ–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ ---
    const adminScheduleSection = document.getElementById('adminScheduleSection'); // –°–µ–∫—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
    const adminsCalendar = document.getElementById('adminsCalendar');
    const currentMonthAdmins = document.getElementById('currentMonthAdmins');
    const prevMonthAdminsBtn = document.getElementById('prevMonthAdmins');
    const nextMonthAdminsBtn = document.getElementById('nextMonthAdmins');

    // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ---
    const assignAdminModal = document.getElementById('assignAdminModal');
    const assignAdminForm = document.getElementById('assignAdminForm');
    const assignModalTitle = document.getElementById('assignModalTitle');
    const assignDateInput = document.getElementById('assignDate');
    const mainAdminSelect = document.getElementById('mainAdmin');
    const helperAdminSelect = document.getElementById('helperAdmin');
    const helperAdminSection = document.getElementById('helperAdminSection'); // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ–º–æ—â–Ω–∏–∫–∞
    const helperHoursSection = document.getElementById('helperHoursSection'); // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —á–∞—Å–æ–≤ –ø–æ–º–æ—â–Ω–∏–∫–∞
    const helperHoursInput = document.getElementById('helperHours');
    const closeAssignModal = document.getElementById('closeAssignModal');
    const deleteAssignmentBtn = document.getElementById('deleteAssignmentBtn'); // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
    // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ –î–Ω—è –†–æ–∂–¥–µ–Ω–∏—è
    const birthdayBookingSection = document.getElementById('birthdayBookingSection');
    const birthdayBookingSelect = document.getElementById('birthdayBookingSelect');
    const maxHelperHoursNote = document.getElementById('maxHelperHoursNote');
    const maxHelperHoursSpan = document.getElementById('maxHelperHours');

    // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –¥–Ω—è ---
    const dayDetailsModal = document.getElementById('dayDetailsModal');
    const dayDetailsTitle = document.getElementById('dayDetailsTitle');
    const dayDetailsContent = document.getElementById('dayDetailsContent');
    const closeDayDetailsModalBtn = document.getElementById('closeDayDetailsModal');

    // --- –†–∞—Å—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã ---
    const salarySection = document.getElementById('salarySection'); // –°–µ–∫—Ü–∏—è –ó–ü
    const salaryResults = document.getElementById('salaryResults');
    const currentMonthSalary = document.getElementById('currentMonthSalary');
    const prevMonthSalaryBtn = document.getElementById('prevMonthSalary');
    const nextMonthSalaryBtn = document.getElementById('nextMonthSalary');

    // --- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –í—ã—Ä—É—á–∫–∏ ---
    const revenueTodayEl = document.getElementById('revenueToday');
    const revenueCurrentWeekEl = document.getElementById('revenueCurrentWeek');
    const revenueSelectedMonthEl = document.getElementById('revenueSelectedMonth');
    // --- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –ó–ü ---
    const weeklyPayrollPeriodEl = document.getElementById('weeklyPayrollPeriod');
    const weeklyPayrollResultsEl = document.getElementById('weeklyPayrollResults');

    // === –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ===
    let currentDate = new Date(); // –î–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∫–ª–∏–µ–Ω—Ç–æ–≤
    currentDate.setDate(1);
    let selectedDate = null; // –í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
    let bookings = [];
    let isAdmin = false;
    let bookingsViewMonth = new Date(); // –î–ª—è —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤
    bookingsViewMonth.setDate(1);
    let adminsViewMonth = new Date(); // –î–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    adminsViewMonth.setDate(1);
    let salaryViewMonth = new Date(); // –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç
    salaryViewMonth.setDate(1);
    let admins = []; // –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    let adminAssignments = []; // –°–ø–∏—Å–æ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
    let selectedServices = new Set(); // –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥
    let salaryData = {}; // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∑–∞—Ä–ø–ª–∞—Ç–µ

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç–ø–∏—Å–∫–∏ –æ—Ç —Å–ª—É—à–∞—Ç–µ–ª–µ–π Firestore
    let unsubscribeBookings = null;
    let unsubscribeAdmins = null;
    let unsubscribeAdminAssignments = null;
    let unsubscribeExpenses = null; // –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤

    // === –¶–µ–Ω—ã —É—Å–ª—É–≥ ===
    const servicePrices = {
        // PS5
        weekday_ps1: 150, // –ë—É–¥–Ω–∏ PS 1 –¥–∂–æ–π—Å—Ç–∏–∫
        weekday_ps2: 300, // –ë—É–¥–Ω–∏ PS 2 –¥–∂–æ–π—Å—Ç–∏–∫–∞
        // VR –æ—á–∫–∏ –±—É–¥–Ω–∏
        weekday_vr1: 500, // –ë—É–¥–Ω–∏ VR 1 –æ—á–∫–∏
        weekday_vr2: 1000, // –ë—É–¥–Ω–∏ VR 2 –æ—á–∫–∏
        weekday_vr3: 1500, // –ë—É–¥–Ω–∏ VR 3 –æ—á–∫–∏
        weekday_vr4: 2000, // –ë—É–¥–Ω–∏ VR 4 –æ—á–∫–∏
        // VR –æ—á–∫–∏ –≤—ã—Ö–æ–¥–Ω—ã–µ
        weekend_vr1: 750, // –í—ã—Ö–æ–¥–Ω—ã–µ VR 1 –æ—á–∫–∏
        weekend_vr2: 1500, // –í—ã—Ö–æ–¥–Ω—ã–µ VR 2 –æ—á–∫–∏
        weekend_vr3: 2250, // –í—ã—Ö–æ–¥–Ω—ã–µ VR 3 –æ—á–∫–∏
        weekend_vr4: 3000, // –í—ã—Ö–æ–¥–Ω—ã–µ VR 4 –æ—á–∫–∏
        // X-Box
        xbox_kinnect: 500, // X-Box Kinnect
        xbox1: 250, // X-Box 1 –¥–∂–æ–π—Å—Ç–∏–∫
        xbox2: 500, // X-Box 2 –¥–∂–æ–π—Å—Ç–∏–∫–∞
        xbox3: 750, // X-Box 3 –¥–∂–æ–π—Å—Ç–∏–∫–∞
        xbox4: 1000, // X-Box 4 –¥–∂–æ–π—Å—Ç–∏–∫–∞
        // –î—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏
        karaoke: 1000, // –ö–∞—Ä–∞–æ–∫–µ
        board_games: 500, // –ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã
        hostess: 1000, // –í–µ–¥—É—â–∞—è (—Ñ–∏–∫—Å. —Å—Ç–æ–∏–º–æ—Å—Ç—å)
        // –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è
        birthday: {
            1: 4000, 2: 3500, 3: 3000, 4: 3000, 5: 3000,
            6: 3000, 7: 3000, 8: 3000, 9: 3000, 10: 3000,
            11: 3000, 12: 3000
        }
    };
    const servicePriceHalfHour = { // –¶–µ–Ω—ã –∑–∞ –ø–æ–ª—á–∞—Å–∞
        weekday_vr: 250,
        weekend_vr: 350,
    }

    // === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
    function isWeekend(date) {
      const day = date.getDay();
      return day === 0 || day === 6; // 0 = –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6 = –°—É–±–±–æ—Ç–∞
    }

    // –ë–ï–ó–û–ü–ê–°–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ 'YYYY-MM-DD' –±–µ–∑ —É—á–µ—Ç–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
    function formatDateSafe(date) {
      const year = date.getFullYear();
      // getMonth() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0-11, –¥–æ–±–∞–≤–ª—è–µ–º 1 –∏ –¥–æ–ø–æ–ª–Ω—è–µ–º –Ω—É–ª–µ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      // getDate() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 1-31, –¥–æ–ø–æ–ª–Ω—è–µ–º –Ω—É–ª–µ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      const day = date.getDate().toString().padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è –º–∞—Å–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    const phonePlaceholder = '+7 (';

    clientPhoneInput.addEventListener('input', function(e) {
        const input = e.target;
        const value = input.value;
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞ –î–û –∏–∑–º–µ–Ω–µ–Ω–∏—è
        const initialCursorPos = input.selectionStart;
        const initialValueLength = value.length;

        // 1. –£–¥–∞–ª—è–µ–º –≤—Å–µ –ù–ï—Ü–∏—Ñ—Ä—ã
        let digits = value.replace(/\D/g, '');

        // 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ 10 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ 7)
        if (digits.startsWith('7') || digits.startsWith('8')) {
            digits = digits.substring(1);
        }
        digits = digits.substring(0, 10); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 10 —Ü–∏—Ñ—Ä–∞–º–∏

        // 3. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å–∫—É
        let formattedValue = '+7 (';
        if (digits.length > 0) {
            formattedValue += digits.substring(0, 3);
        }
        if (digits.length >= 4) {
            formattedValue += ') ' + digits.substring(3, 6);
        }
        if (digits.length >= 7) {
            formattedValue += '-' + digits.substring(6, 8);
        }
        if (digits.length >= 9) {
            formattedValue += '-' + digits.substring(8, 10);
        }
        
        // 4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        input.value = formattedValue;
        
        // 5. –ü—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä –≤ –∫–æ–Ω–µ—Ü –ø–æ—Å–ª–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        // –≠—Ç–æ –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –º–∞—Å–∫–∏
        requestAnimationFrame(() => {
           const finalPos = input.value.length;
           input.setSelectionRange(finalPos, finalPos);
        });
    });

    clientPhoneInput.addEventListener('focus', function(e) {
        if (e.target.value === phonePlaceholder) {
            e.target.value = '';
        }
    });

    clientPhoneInput.addEventListener('blur', function(e) {
        if (e.target.value === '') {
            e.target.value = phonePlaceholder;
        }
    });

    // –ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è –¥–ª—è –Ω–µ–¥–µ–ª–∏, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π date
    function getWeekRange(date) {
        const d = new Date(date);
        const dayOfWeek = d.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
        const diffToMonday = d.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Adjust Sunday
        const monday = new Date(d.setDate(diffToMonday));
        const sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        return {
            start: monday, // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
            end: sunday    // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
        };
    }

    // –ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è –¥–ª—è –ü–†–ï–î–´–î–£–©–ï–ô –Ω–µ–¥–µ–ª–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ date
    function getPreviousWeekRange(date) {
        const d = new Date(date);
        d.setDate(d.getDate() - 7); // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –Ω–µ–¥–µ–ª—é
        return getWeekRange(d);
    }

    // === –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase ===
    function loadData() {
      console.log('loadData called. isAdmin:', isAdmin); // DEBUG

      // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è bookings, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
      if (unsubscribeBookings) {
        unsubscribeBookings();
        unsubscribeBookings = null;
        console.log('Unsubscribed from bookings'); // DEBUG
      }

      // –ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Å–ª—É—à–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω –≤—Å–µ–≥–¥–∞)
      unsubscribeBookings = onSnapshot(collection(db, "bookings"), (snapshot) => {
        console.log('Bookings snapshot received:', snapshot.docs.length); // DEBUG
      bookings = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
        renderCalendar(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∫–ª–∏–µ–Ω—Ç–æ–≤
        renderBookingsList(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
        if (isAdmin) {
            calculateRevenueStats(); // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—ã—Ä—É—á–∫—É
            calculateWeeklyPayroll(); // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ó–ü –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é
            calculateSalaries(); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –º–µ—Å—è—á–Ω—É—é –ó–ü
        }
      });

      // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
      if (isAdmin) {
          console.log('Attempting to load admins...'); // DEBUG
          // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è admins, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
          if (unsubscribeAdmins) {
             unsubscribeAdmins();
             unsubscribeAdmins = null;
             console.log('Unsubscribed from admins'); // DEBUG
          }
          unsubscribeAdmins = onSnapshot(collection(db, "admins"), (snapshot) => {
            console.log('Admins snapshot received:', snapshot.docs.length); // DEBUG
            admins = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            })).sort((a, b) => a.name.localeCompare(b.name)); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏
             console.log('Admins loaded:', admins); // DEBUG
            updateAdminSelects(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ –≤ –º–æ–¥–∞–ª–∫–µ
            renderAdminsCalendar(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∞–¥–º–∏–Ω–æ–≤
            renderBookingsList(); // <-- –î–û–ë–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ä–ø–ª–∞—Ç—ã, —Ç.–∫. —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ –º–æ–≥ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
            calculateWeeklyPayroll();
            calculateSalaries();
          }, (error) => {
            console.error("Error loading admins:", error); // DEBUG
          });

          // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
          console.log('Attempting to load adminAssignments...'); // DEBUG
           // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è adminAssignments, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
          if (unsubscribeAdminAssignments) {
             unsubscribeAdminAssignments();
             unsubscribeAdminAssignments = null;
             console.log('Unsubscribed from adminAssignments'); // DEBUG
          }
          unsubscribeAdminAssignments = onSnapshot(collection(db, "adminAssignments"), (snapshot) => {
            console.log('AdminAssignments snapshot received:', snapshot.docs.length); // DEBUG
            adminAssignments = snapshot.docs.map(doc => ({
              id: doc.id, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞—Ç—É –∫–∞–∫ ID
        ...doc.data()
      }));
            renderAdminsCalendar(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∞–¥–º–∏–Ω–æ–≤
            renderBookingsList(); // <-- –î–û–ë–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
             // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ä–ø–ª–∞—Ç—ã, —Ç.–∫. –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è
            calculateWeeklyPayroll();
            calculateSalaries();
          }, (error) => {
             console.error("Error loading adminAssignments:", error); // DEBUG
             // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –æ—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–∞—Å—å
             if (error.code === 'permission-denied' && unsubscribeAdminAssignments) {
                 unsubscribeAdminAssignments();
                 unsubscribeAdminAssignments = null;
             }
          });
      } else {
          // –ï—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω, —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å –æ—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
          if (unsubscribeAdmins) {
              unsubscribeAdmins();
              unsubscribeAdmins = null;
              console.log('Cleaned up admins listener'); // DEBUG
          }
          if (unsubscribeAdminAssignments) {
              unsubscribeAdminAssignments();
              unsubscribeAdminAssignments = null;
              console.log('Cleaned up adminAssignments listener'); // DEBUG
          }
          // –û—á–∏—â–∞–µ–º —Ç–∞–∫–∂–µ –Ω–æ–≤—ã–µ –ø–æ–ª—è
          renderRevenueStats(0, 0, 0); // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–ª–∏
          renderWeeklyPayroll({}, null); // –ü–æ–∫–∞–∑–∞—Ç—å –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      }
    }

    // === –õ–æ–≥–∏–∫–∞ –ö–∞–ª–µ–Ω–¥–∞—Ä—è –ö–ª–∏–µ–Ω—Ç–æ–≤ ===
    function renderCalendar() {
      // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–Ω–µ–π
      while (calendarEl.children.length > 7) {
        calendarEl.removeChild(calendarEl.lastChild);
      }

      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();

      monthYearEl.textContent = currentDate.toLocaleDateString('ru-RU', {
        year: 'numeric',
        month: 'long',
      });

      const firstDayOfMonth = new Date(year, month, 1);
      let startDayOfWeek = firstDayOfMonth.getDay();
      startDayOfWeek = startDayOfWeek === 0 ? 6 : startDayOfWeek - 1;

      const daysInMonth = new Date(year, month + 1, 0).getDate();

      // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–æ –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞
      for (let i = 0; i < startDayOfWeek; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'border border-gray-200 bg-gray-50 h-24 rounded-3xl'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º h-24 –∫–∞–∫ –≤ index.html
        calendarEl.appendChild(emptyCell);
      }

      // –Ø—á–µ–π–∫–∏ –¥–Ω–µ–π –º–µ—Å—è—Ü–∞
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        const dateStr = formatDateSafe(date);

        const dayCell = document.createElement('div');
        dayCell.className = 'border border-gray-300 rounded-3xl h-24 p-3 flex flex-col justify-start cursor-pointer hover:bg-blue-50 transition relative select-text';

        if (isWeekend(date)) {
          dayCell.classList.add('bg-blue-50'); // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è
        const today = new Date();
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        if (formatDateSafe(date) === formatDateSafe(today)) {
          dayCell.classList.add('ring-2', 'ring-blue-600');
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        if (selectedDate && formatDateSafe(date) === formatDateSafe(selectedDate)) {
          dayCell.classList.add('bg-blue-200', 'ring-4', 'ring-blue-500');
        }

        const dayNumber = document.createElement('div');
        dayNumber.textContent = day;
        dayNumber.className = 'font-semibold text-sm text-gray-900 mb-1 select-none';
        dayCell.appendChild(dayNumber);

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å
        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–¥–µ—Ç —Å–æ —Å—Ç—Ä–æ–∫–æ–π dateStr, –∫–æ—Ç–æ—Ä–∞—è —Ç–µ–ø–µ—Ä—å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ
        const dayBookings = bookings.filter(b => b.bookingDate === dateStr)
                                  .sort((a, b) => a.startTime.localeCompare(b.startTime)); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

        if (dayBookings.length > 0) {
          const bookingsList = document.createElement('ul');
          bookingsList.className = 'bookings-list mt-0.5 overflow-y-auto max-h-16 text-xs text-gray-800 space-y-0.5';

          dayBookings.forEach((b) => {
            const li = document.createElement('li');
            li.className = 'truncate rounded-2xl px-2 py-0.5';

            let bgColor = 'bg-gray-100 text-gray-700';
            if (b.serviceType === 'weekday_vr') bgColor = 'bg-blue-100 text-blue-800';
            else if (b.serviceType === 'weekday_ps') bgColor = 'bg-sky-100 text-sky-800'; // –ò–∑–º–µ–Ω–µ–Ω —Ü–≤–µ—Ç –¥–ª—è PS
            else if (b.serviceType === 'weekend_vr') bgColor = 'bg-indigo-100 text-indigo-800';
            else if (b.serviceType === 'weekend_ps') bgColor = 'bg-purple-100 text-purple-800'; // –ò–∑–º–µ–Ω–µ–Ω —Ü–≤–µ—Ç –¥–ª—è PS –≤—ã—Ö–æ–¥–Ω—ã–µ
            else if (b.serviceType === 'birthday') bgColor = 'bg-pink-100 text-pink-800 font-semibold'; // –ò–∑–º–µ–Ω–µ–Ω —Ü–≤–µ—Ç –î–†

            li.classList.add(...bgColor.split(' '));
            li.textContent = `${b.startTime} (${b.duration}—á) - ${b.clientName}`;
            li.title = `${b.startTime} (${b.duration}—á) - ${b.clientName}\n–£—Å–ª—É–≥–∞: ${getServiceLabel(b.serviceType)}\n–¢–µ–ª: ${b.clientPhone || '-'}\n–ü—Ä–∏–º–µ—á–∞–Ω–∏—è: ${b.notes || '-'}`; // –í—Å–ø–ª—ã–≤–∞—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∑–∞–ø–∏—Å—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
             if (isAdmin) {
                li.classList.add('cursor-pointer', 'hover:ring-1', 'hover:ring-black');
                li.addEventListener('click', (e) => {
                   e.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –Ω–∞ —è—á–µ–π–∫–µ –¥–Ω—è
                   openEditModal(b.id);
                });
             }

            bookingsList.appendChild(li);
          });

          dayCell.appendChild(bookingsList);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —è—á–µ–π–∫—É –¥–Ω—è
        dayCell.addEventListener('click', () => {
          // –ù–∞—Ö–æ–¥–∏–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è
          const dayBookings = bookings.filter(b => b.bookingDate === dateStr)
                                    .sort((a, b) => a.startTime.localeCompare(b.startTime));

          if (dayBookings.length > 0) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏
            showDayDetailsModal(dayBookings, date);
          } else {
            // –ò–Ω–∞—á–µ, –ø—Ä–æ—Å—Ç–æ –≤—ã–¥–µ–ª—è–µ–º –¥–µ–Ω—å (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
          selectedDate = date;
          renderCalendar();
          }
        });

        calendarEl.appendChild(dayCell);
      }
    }


    // === –õ–æ–≥–∏–∫–∞ –°–ø–∏—Å–∫–∞ –ó–∞–ø–∏—Å–µ–π –ö–ª–∏–µ–Ω—Ç–æ–≤ ===
    function renderBookingsList() {
        console.log('renderBookingsList called for month:', bookingsViewMonth.toLocaleDateString()); // DEBUG
      bookingsListEl.innerHTML = '';
      const year = bookingsViewMonth.getFullYear();
      const month = bookingsViewMonth.getMonth(); // 0-indexed (0 = January, 11 = December)
      const yearMonthStr = `${year}-${(month + 1).toString().padStart(2, '0')}`;
      console.log('Filtering bookings for year-month:', yearMonthStr); // DEBUG


      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
      bookingsListTitle.textContent = `–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –Ω–∞ ${bookingsViewMonth.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' })}`;

      // –§–∏–ª—å—Ç—Ä—É–µ–º, —Å—Ä–∞–≤–Ω–∏–≤–∞—è –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏ 'YYYY-MM-DD' —Å 'YYYY-MM'
      let filteredBookings = bookings.filter((b) => {
            return typeof b.bookingDate === 'string' && b.bookingDate.startsWith(yearMonthStr);
      });

      console.log('Filtered bookings for list:', filteredBookings.length, filteredBookings); // DEBUG

      if (filteredBookings.length === 0) {
            console.log('No bookings for list, showing placeholder.'); // DEBUG
        noBookingsText.classList.remove('hidden');
            bookingsListEl.classList.add('hidden');
        return;
      } else {
             console.log('Found bookings, hiding placeholder.'); // DEBUG
        noBookingsText.classList.add('hidden');
            bookingsListEl.classList.remove('hidden');
      }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ –∏ –≤—Ä–µ–º–µ–Ω–∏
      filteredBookings.sort((a, b) => {
        const dateA = new Date(a.bookingDate + 'T' + a.startTime);
        const dateB = new Date(b.bookingDate + 'T' + b.startTime);
        return dateA - dateB;
      });

      filteredBookings.forEach((b) => {
        const li = document.createElement('li');
            // –£–±–∏—Ä–∞–µ–º flex –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ li, –¥–µ–ª–∞–µ–º –µ–≥–æ –±–ª–æ—á–Ω—ã–º
            li.className = 'border border-gray-200 rounded-xl p-4 shadow-sm hover:bg-gray-50 transition';

            // –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å: –î–∞—Ç–∞, –ö–ª–∏–µ–Ω—Ç, –£—Å–ª—É–≥–∞, –ö–Ω–æ–ø–∫–∏
            const topDiv = document.createElement('div');
            topDiv.className = 'flex flex-col md:flex-row md:items-start md:justify-between space-y-3 md:space-y-0 md:space-x-4 mb-3'; // –î–æ–±–∞–≤–ª–µ–Ω mb-3

        const dateObj = new Date(b.bookingDate);
            const dateStr = dateObj.toLocaleDateString('ru-RU', { day: '2-digit', month: 'short', year: 'numeric', weekday: 'short' }); // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —É–±—Ä–∞–Ω \ –ø–µ—Ä–µ–¥ ' –≤ month: 'short'
            const timeStr = `${b.startTime} (${b.duration}—á)`;

            const dateTimeDiv = document.createElement('div');
            dateTimeDiv.className = 'flex-shrink-0 w-full md:w-40 text-gray-700';
            dateTimeDiv.innerHTML = `<div class="font-semibold">${dateStr}</div><div class="text-sm">${timeStr}</div>`;

            const clientInfoDiv = document.createElement('div');
            clientInfoDiv.className = 'flex-grow text-gray-900';
            clientInfoDiv.innerHTML = `<div class="font-semibold text-base truncate" title="${b.clientName}">${b.clientName}</div>`;
            if (b.clientPhone) {
                 let cleanPhone = b.clientPhone.replace(/\D/g, '');
                 if (cleanPhone.startsWith('7') || cleanPhone.startsWith('8')) {
                    cleanPhone = cleanPhone.substring(1);
                 }
                 const formattedPhone = formatPhoneNumber(b.clientPhone);
                clientInfoDiv.innerHTML += `<div class="text-sm mt-1"><a href="tel:+7${cleanPhone}" class="text-blue-600 hover:text-blue-800 hover:underline">${formattedPhone}</a></div>`;
            }

            const serviceNotesDiv = document.createElement('div');
            serviceNotesDiv.className = 'flex-shrink-0 w-full md:w-56 text-sm text-gray-600 text-left md:text-right';

            let serviceLabels = '–ù–µ —É–∫–∞–∑–∞–Ω—ã';
            if (b.selectedServices && Array.isArray(b.selectedServices) && b.selectedServices.length > 0) {
                serviceLabels = b.selectedServices.map(serviceKey => getServiceLabel(serviceKey)).join(', ');
            } else if (b.serviceType) {
                 serviceLabels = getServiceLabel(b.serviceType);
            }

            serviceNotesDiv.innerHTML = `<div class="font-medium mb-1">${serviceLabels}</div>`;
        if (b.notes) {
                serviceNotesDiv.innerHTML += `<div class="italic text-gray-500 whitespace-pre-wrap break-words">${b.notes}</div>`;
        }

            topDiv.appendChild(dateTimeDiv);
            topDiv.appendChild(clientInfoDiv);
            topDiv.appendChild(serviceNotesDiv);

        if (isAdmin) {
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'flex-shrink-0 flex items-center space-x-2 ml-0 md:ml-4 mt-2 md:mt-0';

          const editBtn = document.createElement('button');
          editBtn.type = 'button';
          editBtn.className = 'text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-400 rounded p-1';
          editBtn.title = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å';
                editBtn.innerHTML = '<i class="fas fa-edit fa-fw"></i>';
                editBtn.addEventListener('click', (e) => { e.stopPropagation(); openEditModal(b.id); });

          const deleteBtn = document.createElement('button');
          deleteBtn.type = 'button';
          deleteBtn.className = 'text-red-600 hover:text-red-800 focus:outline-none focus:ring-2 focus:ring-red-400 rounded p-1';
          deleteBtn.title = '–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å';
                deleteBtn.innerHTML = '<i class="fas fa-trash-alt fa-fw"></i>';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –¥–ª—è "${b.clientName}"?`)) { deleteBooking(b.id); }
          });

          actionsDiv.appendChild(editBtn);
          actionsDiv.appendChild(deleteBtn);
                topDiv.appendChild(actionsDiv);
            }
            li.appendChild(topDiv); // –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ä—Ö–Ω—é—é —á–∞—Å—Ç—å –≤ li

            // --- –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å: –§–∏–Ω–∞–Ω—Å—ã –∏ –°–º–µ–Ω–∞ (–î–û–ë–ê–í–õ–ï–ù–û) ---
            const bottomDiv = document.createElement('div');
            bottomDiv.className = 'border-t border-gray-100 pt-3 mt-3 text-sm text-gray-700 space-y-1.5'; // –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∏–∂–Ω–µ–≥–æ –±–ª–æ–∫–∞

            // –†–∞—Å—á–µ—Ç —Ñ–∏–Ω. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            let bookingTotalAmount = 0;
            const duration = parseFloat(b.duration) || 0;
            if (b.selectedServices && Array.isArray(b.selectedServices)) {
                 b.selectedServices.forEach(service => {
                   if (service === 'birthday') {
                     const fullHours = Math.floor(duration);
                     const hasHalfHour = duration % 1 !== 0;
                     let birthdayTotal = 0;
                     for (let hour = 1; hour <= fullHours; hour++) {
                       const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                       birthdayTotal += hourPrice;
                     }
                     if (hasHalfHour) {
                        if (fullHours === 0) { birthdayTotal += 2000; }
                        else if (fullHours === 1) { birthdayTotal += 2000; }
                        else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                     }
                     bookingTotalAmount += birthdayTotal;
                   } else if (service === 'hostess') {
                     // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                     bookingTotalAmount += servicePrices.hostess;
                   } else {
                     const price = servicePrices[service] || 0;
                     bookingTotalAmount += price * duration;
                   }
                 });
            }
            const discountPercent = b.discountPercent || 0;
            const discountAmount = b.discountAmount || 0;
            let finalBookingAmount = bookingTotalAmount;
            let discountText = '-';
            if (discountPercent > 0) {
              finalBookingAmount = bookingTotalAmount * (1 - discountPercent / 100);
              discountText = `${discountPercent}%`;
            } else if (discountAmount > 0) {
              finalBookingAmount = Math.max(0, bookingTotalAmount - discountAmount);
              discountText = `${discountAmount.toLocaleString('ru-RU')} ‚ÇΩ`;
            }

            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–º–µ–Ω–µ
            const assignment = adminAssignments.find(a => a.date === b.bookingDate);
            let shiftText = '<span class="italic text-gray-400">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–º–µ–Ω–µ</span>';
            if (assignment) {
                const mainAdmin = assignment.mainAdminId ? admins.find(a => a.id === assignment.mainAdminId) : null;
                const helperAdmin = assignment.helperAdminId ? admins.find(a => a.id === assignment.helperAdminId) : null;
                shiftText = '';
                if (mainAdmin) shiftText += `üëë ${mainAdmin.name}`;
                else shiftText += '<span class="italic text-red-500">! –û—Å–Ω. –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</span>';

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å–ª—É–≥–∞ "–ê—Ä–µ–Ω–¥–æ–π –î–†" - —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∏—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–º–æ—â–Ω–∏–∫–∞
                const isBirthdayService = 
                    (b.selectedServices && Array.isArray(b.selectedServices) && 
                     b.selectedServices.includes('birthday')) || 
                    b.serviceType === 'birthday';
                
                if (helperAdmin && isBirthdayService) {
                    shiftText += ` / üõ†Ô∏è ${helperAdmin.name}`;
                    if (assignment.helperHours) shiftText += ` (${assignment.helperHours}—á)`;
                }
            }

            // –î–æ–±–∞–≤–ª—è–µ–º HTML –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –∏ —Å–º–µ–Ω—ã
            bottomDiv.innerHTML = `
                <div class="grid grid-cols-3 gap-x-4">
                  <div><span class="font-medium">–°—É–º–º–∞:</span> ${bookingTotalAmount.toLocaleString('ru-RU')} ‚ÇΩ</div>
                  <div><span class="font-medium">–°–∫–∏–¥–∫–∞:</span> ${discountText}</div>
                  <div><span class="font-medium">–ò—Ç–æ–≥–æ:</span> ${finalBookingAmount.toLocaleString('ru-RU', { maximumFractionDigits: 0 })} ‚ÇΩ</div>
                </div>
                <div class="text-xs text-gray-600 space-y-1 mt-1">
                  <div><span class="font-medium">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞:</span> ${b.prepayment && b.prepayment.amount ? `${b.prepayment.amount.toLocaleString('ru-RU')} ‚ÇΩ (${b.prepayment.method === 'cash' ? '–Ω–∞–ª' : '–ø–µ—Ä–µ–≤–æ–¥'})${b.prepayment.date ? ' –æ—Ç ' + new Date(b.prepayment.date).toLocaleDateString('ru-RU', {day: '2-digit', month: 'short'}) : ''}` : '-'}</div>
                  <div><span class="font-medium">–î–æ–ø–ª–∞—Ç–∞ –Ω–∞–ª:</span> ${b.finalPaymentCash && b.finalPaymentCash.amount ? `${b.finalPaymentCash.amount.toLocaleString('ru-RU')} ‚ÇΩ${b.finalPaymentCash.date ? ' –æ—Ç ' + new Date(b.finalPaymentCash.date).toLocaleDateString('ru-RU', {day: '2-digit', month: 'short'}) : ''}` : '-'}</div>
                  <div><span class="font-medium">–î–æ–ø–ª–∞—Ç–∞ –ø–µ—Ä:</span> ${b.finalPaymentTransfer && b.finalPaymentTransfer.amount ? `${b.finalPaymentTransfer.amount.toLocaleString('ru-RU')} ‚ÇΩ${b.finalPaymentTransfer.date ? ' –æ—Ç ' + new Date(b.finalPaymentTransfer.date).toLocaleDateString('ru-RU', {day: '2-digit', month: 'short'}) : ''}` : '-'}</div>
                </div>
                <div><span class="font-medium">–°–º–µ–Ω–∞:</span> ${shiftText}</div>
            `;

            li.appendChild(bottomDiv); // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∏–∂–Ω—é—é —á–∞—Å—Ç—å –≤ li
            // --- –ö–æ–Ω–µ—Ü –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ ---

        bookingsListEl.appendChild(li);
      });
    }


    // === –õ–æ–≥–∏–∫–∞ –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –û–∫–Ω–∞ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ö–ª–∏–µ–Ω—Ç–∞ ===
    function openBookingModal(date = null) {
      if (!isAdmin) {
        showLoginModal();
        return;
      }

      bookingIdInput.value = ''; // –°–±—Ä–æ—Å ID –¥–ª—è –Ω–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      modalTitle.textContent = '–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞'; // –ò–∑–º–µ–Ω–µ–Ω–æ
      deleteBookingBtn.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
      bookingForm.reset(); // –°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É
      clientPhoneInput.value = '+7 ('; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞—Å–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

      // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–µ–≥–æ–¥–Ω—è –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞)
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
      const defaultDate = date ? formatDateSafe(date) : formatDateSafe(new Date());
      bookingForm.bookingDate.value = defaultDate;

      // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Date –∏–∑ —Å—Ç—Ä–æ–∫–∏ 'YYYY-MM-DD', –¥–æ–±–∞–≤–ª—è—è –≤—Ä–µ–º—è —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å UTC —Å–¥–≤–∏–≥–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ
      const bookingDateObj = new Date(defaultDate + 'T00:00:00');
      // bookingForm.serviceType.value = isWeekend(bookingDateObj) ? 'weekend_vr' : 'weekday_vr'; // –£–¥–∞–ª–µ–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç


      bookingModal.classList.remove('hidden');
      bookingForm.clientName.focus(); // –§–æ–∫—É—Å –Ω–∞ –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç Date –¥–ª—è selectedDate, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ date
      selectedDate = date ? new Date(date.getFullYear(), date.getMonth(), date.getDate()) : null;
      renderCalendar(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
    }

    function openEditModal(id) {
      if (!isAdmin) {
        showLoginModal();
        return;
      }

      const booking = bookings.find(b => b.id === id);
      if (!booking) {
          console.error("–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ:", id);
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.");
          return;
      }

      bookingIdInput.value = booking.id;
      modalTitle.textContent = '–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞'; // –ò–∑–º–µ–Ω–µ–Ω–æ
      deleteBookingBtn.classList.remove('hidden'); // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
      bookingModal.classList.remove('hidden');

      // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      bookingForm.clientName.value = booking.clientName;
      bookingForm.clientPhone.value = booking.clientPhone || '+7 (';
      bookingForm.bookingDate.value = booking.bookingDate;
      bookingForm.startTime.value = booking.startTime;
      bookingForm.duration.value = booking.duration.toString();
      bookingForm.notes.value = booking.notes || '';

      bookingForm.clientName.focus(); // –§–æ–∫—É—Å –Ω–∞ –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞

      // –í—ã–¥–µ–ª–∏—Ç—å –¥–µ–Ω—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
      selectedDate = new Date(booking.bookingDate + 'T00:00:00'); // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –Ω–∞—á–∞–ª–æ –¥–Ω—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –¥–∞—Ç—ã
      renderCalendar();

      // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã / –¥–æ–ø–ª–∞—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å
      if (booking.prepayment) {
        document.getElementById('prepayAmount').value = booking.prepayment.amount || '';
        document.getElementById('prepayMethod').value = booking.prepayment.method || 'cash';
        document.getElementById('prepayDate').value = booking.prepayment.date || '';
      } else {
        document.getElementById('prepayAmount').value = '';
        document.getElementById('prepayDate').value = '';
      }

      // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–æ–ø–ª–∞—Ç—ã –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–º
      if (booking.finalPaymentCash) {
        document.getElementById('finalPayAmountCash').value = booking.finalPaymentCash.amount || '';
        document.getElementById('finalPayDateCash').value = booking.finalPaymentCash.date || '';
      } else {
        document.getElementById('finalPayAmountCash').value = '';
        document.getElementById('finalPayDateCash').value = '';
      }

      if (booking.finalPaymentTransfer) {
        document.getElementById('finalPayAmountTransfer').value = booking.finalPaymentTransfer.amount || '';
        document.getElementById('finalPayDateTransfer').value = booking.finalPaymentTransfer.date || '';
      } else {
        document.getElementById('finalPayAmountTransfer').value = '';
        document.getElementById('finalPayDateTransfer').value = '';
      }
    }

    async function handleBookingFormSubmit(e) {
      e.preventDefault();

      if (!isAdmin) {
            alert("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!");
            showLoginModal();
        return;
      }

      const id = bookingIdInput.value;
        const bookingData = {
        clientName: bookingForm.clientName.value.trim(),
        clientPhone: bookingForm.clientPhone.value.trim(),
        bookingDate: bookingForm.bookingDate.value,
        startTime: bookingForm.startTime.value,
        duration: parseFloat(bookingForm.duration.value),
        selectedServices: Array.from(selectedServices), // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
        notes: bookingForm.notes.value.trim(),
        discountPercent: parseFloat(bookingForm.discountPercent.value) || 0, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫–∏–¥–∫—É %
        discountAmount: parseFloat(bookingForm.discountAmount.value) || 0, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫–∏–¥–∫—É ‚ÇΩ
        prepayment: {
          amount: parseFloat(document.getElementById('prepayAmount').value) || 0,
          method: document.getElementById('prepayMethod').value || '',
          date: document.getElementById('prepayDate').value || ''
        },
        finalPaymentCash: { // –î–æ–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏
          amount: parseFloat(document.getElementById('finalPayAmountCash').value) || 0,
          date: document.getElementById('finalPayDateCash').value || ''
        },
        finalPaymentTransfer: { // –î–æ–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º
          amount: parseFloat(document.getElementById('finalPayAmountTransfer').value) || 0,
          date: document.getElementById('finalPayDateTransfer').value || ''
        }
      };

        // --- –í–∞–ª–∏–¥–∞—Ü–∏—è ---
        if (!bookingData.clientName) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞.');
      bookingForm.clientName.focus();
        return;
      }
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 11 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ +7)
        const phoneDigits = bookingData.clientPhone.replace(/\D/g, '');
        if (!bookingData.clientPhone || !(phoneDigits.length === 11 && phoneDigits.startsWith('7'))) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7 (XXX) XXX-XX-XX.');
            bookingForm.clientPhone.focus();
        return;
      }
         if (!bookingData.bookingDate) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É.');
            bookingForm.bookingDate.focus();
        return;
      }
        if (!bookingData.startTime) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞.');
            bookingForm.startTime.focus();
        return;
      }
        if (isNaN(bookingData.duration) || bookingData.duration <= 0) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.');
            bookingForm.duration.focus();
            return;
        }
        // ----------------

      try {
        if (id) {
          // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏
                await updateDoc(doc(db, "bookings", id), bookingData);
        } else {
          // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
                await addDoc(collection(db, "bookings"), bookingData);
        }
        bookingModal.classList.add('hidden');
      } catch (error) {
            console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:", error);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
        }
    }

    async function deleteBooking(id) {
      if (!isAdmin) {
        alert("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!");
        showLoginModal();
        return;
      }
      try {
        await deleteDoc(doc(db, "bookings", id));
        console.log("–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞:", id);
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —á–µ—Ä–µ–∑ onSnapshot
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:", error);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å.");
      }
    }

    // === –õ–æ–≥–∏–∫–∞ –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –û–∫–Ω–∞ –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –ê–¥–º–∏–Ω–∞ ===
    function updateAdminSelects() {
        console.log('updateAdminSelects called. Admins available:', admins.length, admins); // DEBUG
        const mainAdminValue = mainAdminSelect.value;
        const helperAdminValue = helperAdminSelect.value;

        mainAdminSelect.innerHTML = '<option value="">-- –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω --</option>';
        helperAdminSelect.innerHTML = '<option value="">-- –ù–µ—Ç –ø–æ–º–æ—â–Ω–∏–∫–∞ --</option>';

        admins.forEach(admin => {
            const optionMain = document.createElement('option');
            optionMain.value = admin.id;
            optionMain.textContent = admin.name;
             console.log('Adding main option:', admin.name, admin.id); // DEBUG
            mainAdminSelect.appendChild(optionMain);

            const optionHelper = document.createElement('option');
            optionHelper.value = admin.id;
            optionHelper.textContent = admin.name;
            console.log('Adding helper option:', admin.name, admin.id); // DEBUG
            helperAdminSelect.appendChild(optionHelper);
        });

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        mainAdminSelect.value = mainAdminValue;
        helperAdminSelect.value = helperAdminValue;

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –≤ —Å–ø–∏—Å–∫–µ –ø–æ–º–æ—â–Ω–∏–∫–æ–≤
        updateHelperAdminOptions();
    }

    function updateHelperAdminOptions() {
        const selectedMainAdminId = mainAdminSelect.value;
        const currentHelperValue = helperAdminSelect.value; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä

        // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏–∏ –ø–æ–º–æ—â–Ω–∏–∫–∞
        Array.from(helperAdminSelect.options).forEach(option => {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –æ–ø—Ü–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –æ—Å–Ω–æ–≤–Ω—ã–º –∞–¥–º–∏–Ω–æ–º
            // –∏ —ç—Ç–æ –Ω–µ –ø—É—Å—Ç–∞—è –æ–ø—Ü–∏—è "-- –ù–µ—Ç –ø–æ–º–æ—â–Ω–∏–∫–∞ --"
            if (option.value && option.value === selectedMainAdminId) {
                option.disabled = true;
                // –ï—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–ø—Ü–∏—è –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–º–æ—â–Ω–∏–∫–∞
                if (helperAdminSelect.value === option.value) {
                    helperAdminSelect.value = ""; // –°–±—Ä–æ—Å –Ω–∞ "-- –ù–µ—Ç –ø–æ–º–æ—â–Ω–∏–∫–∞ --"
                     toggleHelperHours(false); // –°–∫—Ä—ã—Ç—å –ø–æ–ª–µ —á–∞—Å–æ–≤
                }
            } else {
                option.disabled = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ
            }
        });

         // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–º–æ—â–Ω–∏–∫–∞, –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª —Å–±—Ä–æ—à–µ–Ω
         if (helperAdminSelect.value === "" && currentHelperValue !== "" && currentHelperValue !== selectedMainAdminId) {
            helperAdminSelect.value = currentHelperValue;
         }

         // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ —á–∞—Å–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞
         toggleHelperHours(helperAdminSelect.value !== "");
    }


    function toggleHelperHours(show) {
        if (show) {
            helperHoursSection.classList.remove('hidden');
            helperHoursInput.required = true; // –î–µ–ª–∞–µ–º –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º
        } else {
            helperHoursSection.classList.add('hidden');
            helperHoursInput.required = false; // –°–Ω–∏–º–∞–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            helperHoursInput.value = ''; // –û—á–∏—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        }
    }


    function openAssignModal(date, dateStr) {
      if (!isAdmin) {
        showLoginModal();
        return;
      }

      assignModalTitle.textContent = `–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ ${date.toLocaleDateString('ru-RU', {day: '2-digit', month: 'long', year: 'numeric'})}`;
      assignDateInput.value = dateStr; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã –∫–∞–∫ ID –¥–æ–∫—É–º–µ–Ω—Ç–∞

      // –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
      const assignment = adminAssignments.find(a => a.id === dateStr); // –ò—â–µ–º –ø–æ ID (–¥–∞—Ç–µ)
      
      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
      const dayBookings = bookings.filter(b => b.bookingDate === dateStr);
      
      // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ "–ê—Ä–µ–Ω–¥–∞ –î–†" –Ω–∞ —ç—Ç—É –¥–∞—Ç—É
      const birthdayBookings = dayBookings.filter(b => {
        return (b.selectedServices && Array.isArray(b.selectedServices) && b.selectedServices.includes('birthday')) || 
               b.serviceType === 'birthday';
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –î–Ω–µ–π –†–æ–∂–¥–µ–Ω–∏–π
      birthdayBookingSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è</option>';
      
      if (birthdayBookings.length > 0) {
        birthdayBookings.forEach(booking => {
          const time = booking.bookingTime || '00:00';
          const duration = parseFloat(booking.duration) || 0;
          const clientName = booking.clientName || '–ö–ª–∏–µ–Ω—Ç';
          const option = document.createElement('option');
          option.value = booking.id;
          option.dataset.duration = duration;
          option.textContent = `${time} - ${clientName} (${duration} —á)`;
          birthdayBookingSelect.appendChild(option);
        });
      } else {
        const option = document.createElement('option');
        option.value = "";
        option.disabled = true;
        option.textContent = '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π "–ê—Ä–µ–Ω–¥–∞ –î–†" –Ω–∞ —ç—Ç—É –¥–∞—Ç—É';
        birthdayBookingSelect.appendChild(option);
      }
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –¥–ª—è –ø–æ–º–æ—â–Ω–∏–∫–∞ –Ω–∞ –∑–∞–ø–∏—Å—è—Ö "–ê—Ä–µ–Ω–¥–∞ –î–†"
      const birthdayRentalHours = calculateBirthdayRentalHours(dayBookings);

      if (assignment) {
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
        mainAdminSelect.value = assignment.mainAdminId || '';
        helperAdminSelect.value = assignment.helperAdminId || '';
        
        // –ï—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω –ø–æ–º–æ—â–Ω–∏–∫ –∏ —É –Ω–∞—Å –µ—Å—Ç—å ID —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ –î–†
        if (assignment.helperAdminId && assignment.birthdayBookingId) {
          // –í—ã–±–∏—Ä–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å –î–†
          birthdayBookingSelect.value = assignment.birthdayBookingId;
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –≤—ã–±–æ—Ä–∞ –î–†
          birthdayBookingSection.classList.remove('hidden');
          
          // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∑–∞–ø–∏—Å—å –î–†
          const selectedBooking = birthdayBookings.find(b => b.id === assignment.birthdayBookingId);
          if (selectedBooking) {
            const duration = parseFloat(selectedBooking.duration) || 0;
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —á–∞—Å–∞—Ö
            maxHelperHoursSpan.textContent = duration;
            maxHelperHoursNote.classList.remove('hidden');
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —á–∞—Å–æ–≤
            helperHoursInput.max = duration;
          }
        }
        
        // –ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —á–∞—Å–∞—Ö –ê—Ä–µ–Ω–¥—ã –î–† –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã —á–∞—Å—ã –ø–æ–º–æ—â–Ω–∏–∫–∞,
        // –∏ –æ–Ω–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        if (birthdayRentalHours > 0 && assignment.helperAdminId && 
            assignment.helperHours && parseInt(assignment.helperHours) !== birthdayRentalHours) {
          const helperAdmin = admins.find(a => a.id === assignment.helperAdminId);
          const helperName = helperAdmin ? helperAdmin.name : '–ü–æ–º–æ—â–Ω–∏–∫–∞';
          if (confirm(`–í–Ω–∏–º–∞–Ω–∏–µ! –î–ª—è ${helperName} —É–∫–∞–∑–∞–Ω–æ ${assignment.helperHours} —á —Ä–∞–±–æ—Ç—ã, –Ω–æ –ø–æ –∑–∞–ø–∏—Å—è–º "–ê—Ä–µ–Ω–¥–∞ –î–†" —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ ${birthdayRentalHours} —á.\n\n–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤?`)) {
            helperHoursInput.value = birthdayRentalHours;
          } else {
            helperHoursInput.value = assignment.helperHours;
          }
        } else {
          helperHoursInput.value = assignment.helperHours || '';
        }
        
        deleteAssignmentBtn.classList.remove('hidden'); // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
      } else {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
        mainAdminSelect.value = '';
        helperAdminSelect.value = '';
        helperHoursInput.value = '';
        birthdayBookingSelect.value = '';
        birthdayBookingSection.classList.add('hidden');
        maxHelperHoursNote.classList.add('hidden');
        deleteAssignmentBtn.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
      }

      updateHelperAdminOptions(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–º–æ—â–Ω–∏–∫–æ–≤ –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª—è —á–∞—Å–æ–≤
      assignAdminModal.classList.remove('hidden');
      mainAdminSelect.focus();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º–∞—Ä–Ω—ã—Ö —á–∞—Å–æ–≤ –∑–∞–ø–∏—Å–µ–π "–ê—Ä–µ–Ω–¥–∞ –î–†" –∑–∞ –¥–µ–Ω—å
    function calculateBirthdayRentalHours(dayBookings) {
      let totalHours = 0;
      dayBookings.forEach(booking => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å–ª—É–≥–∞ "–ê—Ä–µ–Ω–¥–æ–π –î–†"
        const isBirthdayService = 
          (booking.selectedServices && Array.isArray(booking.selectedServices) && 
           booking.selectedServices.includes('birthday')) || 
          booking.serviceType === 'birthday';
        
        if (isBirthdayService) {
          const duration = parseFloat(booking.duration) || 0;
          totalHours += duration;
        }
      });
      return Math.round(totalHours); // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ —Ü–µ–ª–æ–≥–æ —á–∞—Å–∞
    }

    async function handleAssignAdminFormSubmit(e) {
      e.preventDefault();
      if (!isAdmin) {
        alert("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!");
        showLoginModal();
        return;
      }

      const date = assignDateInput.value;
      const mainAdminId = mainAdminSelect.value;
      const helperAdminId = helperAdminSelect.value;
      const helperHours = helperHoursInput.value ? parseInt(helperHoursInput.value) : null;
      const birthdayBookingId = birthdayBookingSelect.value || null;

      // –í–∞–ª–∏–¥–∞—Ü–∏—è: –æ—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω
      if (!mainAdminId) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
        mainAdminSelect.focus();
        return;
      }

      // –í–∞–ª–∏–¥–∞—Ü–∏—è: –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø–æ–º–æ—â–Ω–∏–∫, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–ø–∏—Å—å –î–† –∏ —á–∞—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã
      if (helperAdminId) {
        if (!birthdayBookingId) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –ø–æ–º–æ—â–Ω–∏–∫.');
          birthdayBookingSelect.focus();
          return;
        }
        
        if (!helperHours || helperHours <= 0) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ –¥–ª—è –ø–æ–º–æ—â–Ω–∏–∫–∞.');
          helperHoursInput.focus();
          return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —á–∞—Å—ã –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –î–†
        const selectedOption = birthdayBookingSelect.options[birthdayBookingSelect.selectedIndex];
        if (selectedOption) {
          const maxDuration = parseFloat(selectedOption.dataset.duration) || 0;
          if (helperHours > maxDuration) {
            alert(`–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã –ø–æ–º–æ—â–Ω–∏–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (${maxDuration} —á).`);
            helperHoursInput.value = maxDuration;
            helperHoursInput.focus();
            return;
          }
        }
      }

      // –í–∞–ª–∏–¥–∞—Ü–∏—è: –æ—Å–Ω–æ–≤–Ω–æ–π –∏ –ø–æ–º–æ—â–Ω–∏–∫ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ —á–µ–ª–æ–≤–µ–∫–æ–º
      if (mainAdminId && helperAdminId && mainAdminId === helperAdminId) {
        alert('–û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏ –ø–æ–º–æ—â–Ω–∏–∫ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ —á–µ–ª–æ–≤–µ–∫–æ–º.');
        helperAdminSelect.focus();
        return;
      }

      const assignmentData = {
        date: date, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞—Ç—É –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (—Ö–æ—Ç—è ID —É–∂–µ –¥–∞—Ç–∞)
        mainAdminId: mainAdminId,
        helperAdminId: helperAdminId || null, // –°–æ—Ö—Ä–∞–Ω—è–µ–º null, –µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω
        helperHours: helperHours, // –°–æ—Ö—Ä–∞–Ω—è–µ–º null, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã
        birthdayBookingId: birthdayBookingId // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ –î–†
      };

      try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞—Ç—É (dateStr) –∫–∞–∫ ID –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ adminAssignments
        const assignmentRef = doc(db, "adminAssignments", date);
        await setDoc(assignmentRef, assignmentData); // setDoc –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç

        console.log("–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:", date);
        assignAdminModal.classList.add('hidden');
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:", error);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
      }
    }

    async function deleteAssignment() {
        const date = assignDateInput.value;
        if (!date) return;

        if (!isAdmin) {
            alert("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!");
            showLoginModal();
            return;
        }

        if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ ${date}?`)) {
            try {
                await deleteDoc(doc(db, "adminAssignments", date));
                console.log("–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ:", date);
                assignAdminModal.classList.add('hidden');
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —á–µ—Ä–µ–∑ onSnapshot
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:", error);
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ.");
            }
        }
    }


    // === –õ–æ–≥–∏–∫–∞ –†–∞—Å—á–µ—Ç–∞ –ó–∞—Ä–ø–ª–∞—Ç—ã ===
    function calculateSalaries() {
      console.log('calculateSalaries called. isAdmin:', isAdmin);
      
      if (!isAdmin) {
          salarySection.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é –µ—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω
          console.log('Not admin, hiding salary section');
          return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
      if (!admins || admins.length === 0) {
          console.warn('No admins loaded, skipping salary calculation');
          return;
      }
      if (!bookings || bookings.length === 0) {
          console.warn('No bookings loaded, skipping salary calculation');
          return;
      }
      if (!adminAssignments || adminAssignments.length === 0) {
          console.warn('No admin assignments loaded, skipping salary calculation');
          return;
      }
      
       salarySection.classList.remove('hidden'); // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –µ—Å–ª–∏ –∞–¥–º–∏–Ω

      const year = salaryViewMonth.getFullYear();
      const month = salaryViewMonth.getMonth();
      console.log('Calculating salaries for:', year, month);
      console.log('Current admins:', admins);
      console.log('Current bookings:', bookings);
      console.log('Current assignments:', adminAssignments);

      // 1. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ –¥–∞—Ç–∞–º –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
      const bookingsByDate = {};
      bookings.forEach(booking => {
        // –£–±–µ–¥–∏–º—Å—è —á—Ç–æ bookingDate —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
        if (typeof booking.bookingDate === 'string') {
           try {
                const bookingDateObj = new Date(booking.bookingDate + 'T00:00:00'); // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
                if (bookingDateObj.getFullYear() === year && bookingDateObj.getMonth() === month) {
                    const dateStr = booking.bookingDate; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ö–æ–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã
                    if (!bookingsByDate[dateStr]) {
                        bookingsByDate[dateStr] = [];
                    }
                    bookingsByDate[dateStr].push(booking);
                }
            } catch (e) {
                 console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:", booking.bookingDate, e);
            }
        } else {
             console.warn("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏:", booking);
        }

      });

      // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
      salaryData = {}; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
      admins.forEach(admin => {
        salaryData[admin.id] = {
          name: admin.name,
          baseSalary: 0, // –°—É–º–º–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ –∏ –ø–æ—á–∞—Å–æ–≤–æ–π –æ–ø–ª–∞—Ç—ã
          bonusSalary: 0, // –°—É–º–º–∞ –±–æ–Ω—É—Å–æ–≤ –æ—Ç –≤—ã—Ä—É—á–∫–∏
          totalSalary: 0, // –ò—Ç–æ–≥–æ–≤–∞—è –ó–ü
          daysWorked: 0, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–≥–æ
          hoursWorked: 0, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ –ø–æ–º–æ—â–Ω–∏–∫–∞
          details: [] // –ú–∞—Å—Å–∏–≤ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –¥–Ω—è–º
        };
      });
      console.log('Initialized salaryData:', salaryData);

      // 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –µ—Å—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
      let totalMonthRevenue = 0; // –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü (–ø–æ—Å–ª–µ —Å–∫–∏–¥–æ–∫)

      adminAssignments.forEach(assignment => {
          // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ assignment.date —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–µ–º—É –º–µ—Å—è—Ü—É/–≥–æ–¥—É
          if (typeof assignment.date === 'string') {
              try {
                  const assignmentDateObj = new Date(assignment.date + 'T00:00:00');
                  if (assignmentDateObj.getFullYear() === year && assignmentDateObj.getMonth() === month) {
                      const dateStr = assignment.date; // –°—Ç—Ä–æ–∫–∞ –¥–∞—Ç—ã 'YYYY-MM-DD'
                      const dayBookings = bookingsByDate[dateStr] || [];
                      let dayRevenue = 0; // –í—ã—Ä—É—á–∫–∞ –¥–Ω—è –ü–û–°–õ–ï —Å–∫–∏–¥–æ–∫
                      let birthdayRevenue = 0; // –í—ã—Ä—É—á–∫–∞ —Ç–æ–ª—å–∫–æ –æ—Ç –î–†
                      let hostessRevenue = 0; // –í—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥–∏ –≤–µ–¥—É—â–µ–π
                      let otherServicesRevenue = 0; // –í—ã—Ä—É—á–∫–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö —É—Å–ª—É–≥

                      // –†–∞—Å—á–µ—Ç –≤—ã—Ä—É—á–∫–∏ –¥–Ω—è
                      dayBookings.forEach(booking => {
                          let bookingTotalAmount = 0; // –°—É–º–º–∞ –¥–æ —Å–∫–∏–¥–∫–∏
                          const duration = parseFloat(booking.duration) || 0;

                           // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å–ª—É–≥–∞ "–ê—Ä–µ–Ω–¥–æ–π –î–†"
                           const isBirthdayService = 
                               (booking.selectedServices && Array.isArray(booking.selectedServices) && 
                                booking.selectedServices.includes('birthday')) || 
                               booking.serviceType === 'birthday';

                          // –ò—Å–ø–æ–ª—å–∑—É–µ–º selectedServices –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã –î–û —Å–∫–∏–¥–∫–∏
                          if (booking.selectedServices && Array.isArray(booking.selectedServices)) {
                              booking.selectedServices.forEach(service => {
                   if (service === 'birthday') { 
                                      // –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –î–†
                     const fullHours = Math.floor(duration);
                     const hasHalfHour = duration % 1 !== 0;
                     let birthdayTotal = 0;
                     for (let hour = 1; hour <= fullHours; hour++) {
                       const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                       birthdayTotal += hourPrice;
                     }
                     if (hasHalfHour) {
                        if (fullHours === 0) { birthdayTotal += 2000; }
                        else if (fullHours === 1) { birthdayTotal += 2000; }
                        else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                     }
                     bookingTotalAmount += birthdayTotal;
                   } else if (service === 'hostess') {
                     // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                     bookingTotalAmount += servicePrices.hostess;
                                     hostessRevenue += servicePrices.hostess;
                   } else {
                     const price = servicePrices[service] || 0;
                     bookingTotalAmount += price * duration;
                   }
                 });
                          } else if (booking.serviceType) { // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –ø–æ–ª–µ–º
                               // –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã –î–û —Å–∫–∏–¥–∫–∏ –ø–æ —Å—Ç–∞—Ä–æ–º—É –ø–æ–ª—é serviceType
                               // ... (–ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ bookingRevenue –ø–æ serviceType –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–π –∂–µ, –Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –≤ bookingTotalAmount) ...
                               console.warn('Using legacy serviceType for monthly salary calculation (calculating pre-discount amount)', booking);
                               if (booking.serviceType === 'birthday') {
                                   const hours = Math.min(Math.max(Math.ceil(duration), 1), 12);
                                   bookingTotalAmount = servicePrices.birthday[hours] || servicePrices.birthday[4];
                               } else if (duration === 0.5 && servicePriceHalfHour[booking.serviceType]) {
                                   bookingTotalAmount = servicePriceHalfHour[booking.serviceType] || 0;
                               } else {
                                   const pricePerHour = servicePrices[booking.serviceType] || 0;
                                   bookingTotalAmount = pricePerHour * duration;
                               }
                          }

                          // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–∫–∏
                          const discountPercent = booking.discountPercent || 0;
                          const discountAmount = booking.discountAmount || 0;
                          let finalBookingAmount = bookingTotalAmount; // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —ç—Ç–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            if (discountPercent > 0) {
              finalBookingAmount = bookingTotalAmount * (1 - discountPercent / 100);
            } else if (discountAmount > 0) {
              finalBookingAmount = Math.max(0, bookingTotalAmount - discountAmount);
                          }

                          dayRevenue += finalBookingAmount; // –î–æ–±–∞–≤–ª—è–µ–º –∫ –≤—ã—Ä—É—á–∫–µ –¥–Ω—è –ò–¢–û–ì–û–í–£–Æ —Å—É–º–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                           
                           // –ï—Å–ª–∏ —ç—Ç–æ –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª—è–µ–º –≤ birthdayRevenue
                           if (isBirthdayService) {
                               birthdayRevenue += finalBookingAmount;
                           }
                      });

                      totalMonthRevenue += dayRevenue; // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–µ –º–µ—Å—è—Ü–∞ (—É–∂–µ —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–æ–∫)

                      // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç—ã –æ—Å–Ω–æ–≤–Ω–æ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É (–∏—Å–ø–æ–ª—å–∑—É–µ–º birthdayRevenue –º–∏–Ω—É—Å hostessRevenue)
                      if (assignment.mainAdminId && salaryData[assignment.mainAdminId]) {
                          const adminData = salaryData[assignment.mainAdminId];
                          adminData.daysWorked++;
                          const basePay = 500; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –∑–∞ —Å–º–µ–Ω—É
                          adminData.baseSalary += basePay;
                          const bonusPercent = assignment.helperAdminId ? 0.08 : 0.15;
                          
                          // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º –æ—Ç (–≤—ã—Ä—É—á–∫–∞ –î–† - –≤–µ–¥—É—â–∞—è + –¥—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏)
                          // –ï—Å–ª–∏ –Ω–µ—Ç –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º –æ—Ç –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏
                          const bonusRevenue = birthdayRevenue > 0 ? 
                            (birthdayRevenue - hostessRevenue + (dayRevenue - birthdayRevenue)) : 
                            dayRevenue;
                            
                          const bonus = bonusRevenue * bonusPercent;
                          adminData.bonusSalary += bonus;
                          adminData.totalSalary += basePay + bonus;

                          adminData.details.push({
                              date: dateStr,
                              type: '–û—Å–Ω–æ–≤–Ω–∞—è —Å–º–µ–Ω–∞',
                              base: basePay,
                              bonus: bonus,
                              revenue: dayRevenue,
                              hours: 0
                          });
                      }

                      // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç—ã –ø–æ–º–æ—â–Ω–∏–∫—É (–∏—Å–ø–æ–ª—å–∑—É–µ–º birthdayRevenue –º–∏–Ω—É—Å hostessRevenue)
                      if (assignment.helperAdminId && salaryData[assignment.helperAdminId] && assignment.helperHours) {
                          const helperData = salaryData[assignment.helperAdminId];
                          
                          // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –ø–æ–º–æ—â–Ω–∏–∫–∞
                          let actualHelperHours = 0;
                          
                          dayBookings.forEach(booking => {
                              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å–ª—É–≥–∞ "–ê—Ä–µ–Ω–¥–æ–π –î–†"
                              const isBirthdayService = 
                                  (booking.selectedServices && Array.isArray(booking.selectedServices) && 
                                   booking.selectedServices.includes('birthday')) || 
                                  booking.serviceType === 'birthday';
                              
                              if (isBirthdayService) {
                                  // –°—á–∏—Ç–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –ø–æ–º–æ—â–Ω–∏–∫–∞
                                  const duration = parseFloat(booking.duration) || 0;
                                  actualHelperHours += duration;
                              }
                          });
                          
                          actualHelperHours = Math.round(actualHelperHours);
                          const hours = actualHelperHours > 0 ? actualHelperHours : parseInt(assignment.helperHours);
                          helperData.hoursWorked += hours;
                          const basePay = hours * 150; // 150‚ÇΩ –≤ —á–∞—Å
                              helperData.baseSalary += basePay;
                              
                              const bonusPercent = 0.07;
                          const bonusRevenue = birthdayRevenue - hostessRevenue;
                          const bonus = bonusRevenue * bonusPercent; // –°—á–∏—Ç–∞–µ–º –±–æ–Ω—É—Å —Ç–æ–ª—å–∫–æ –æ—Ç –≤—ã—Ä—É—á–∫–∏ –∑–∞ –î–†
                              helperData.bonusSalary += bonus;
                              helperData.totalSalary += basePay + bonus;

                              helperData.details.push({
                                  date: dateStr,
                                  type: '–ü–æ–º–æ—â—å –Ω–∞ —Å–º–µ–Ω–µ',
                                  base: basePay,
                                  bonus: bonus, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–æ–Ω—É—Å, –ø–æ—Å—á–∏—Ç–∞–Ω–Ω—ã–π –æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤—ã—Ä—É—á–∫–∏
                                  revenue: birthdayRevenue, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã—Ä—É—á–∫—É —Ç–æ–ª—å–∫–æ –æ—Ç –î–†
                              hours: hours // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã
                              });
                              
                              // –ï—Å–ª–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö, –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                              const assignedHours = parseInt(assignment.helperHours) || 0;
                              if (assignedHours !== actualHelperHours) {
                                  helperData.details[helperData.details.length - 1].note = 
                                      `–ù–∞–∑–Ω–∞—á–µ–Ω–æ ${assignedHours} —á, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ ${actualHelperHours} —á –ø–æ –∑–∞–ø–∏—Å—è–º –î–†`;
                          }
                      }
                  }
              } catch(e) {
                  console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:", assignment.date, e);
              }
          } else {
               console.warn("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏:", assignment);
          }
      });


      // 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      console.log('Final salaryData:', salaryData);
      renderSalaryResults(salaryData, totalMonthRevenue);
    }


    function renderSalaryResults(salaryData, totalRevenue) {
      console.log('renderSalaryResults called with data:', salaryData, 'totalRevenue:', totalRevenue);
      salaryResults.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      
      // –ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏
      const revenueCard = document.createElement('div');
      revenueCard.className = 'bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl shadow-md p-6 border border-green-200'; // –ì—Ä–∞–¥–∏–µ–Ω—Ç
      
      // –†–∞–∑–¥–µ–ª—è–µ–º –≤—ã—Ä—É—á–∫—É –Ω–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º—É—é
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      let actualRevenue = 0;
      let plannedRevenue = 0;
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≤—ã—Ä—É—á–∫—É –ø–æ –¥–Ω—è–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const revenueByDay = {};
      
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞ –º–µ—Å—è—Ü
      bookings.forEach(booking => {
        if (typeof booking.bookingDate === 'string') {
          try {
            const bookingDate = new Date(booking.bookingDate + 'T00:00:00');
            const bookingYear = bookingDate.getFullYear();
            const bookingMonth = bookingDate.getMonth();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É –º–µ—Å—è—Ü—É
            if (bookingYear === salaryViewMonth.getFullYear() && bookingMonth === salaryViewMonth.getMonth()) {
              // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Ä—É—á–∫—É –æ—Ç —ç—Ç–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
              let bookingRevenue = 0;
              
              if (booking.selectedServices && Array.isArray(booking.selectedServices)) {
                const duration = parseFloat(booking.duration) || 0;
                booking.selectedServices.forEach(service => {
                  if (service === 'birthday') {
                    const fullHours = Math.floor(duration);
                    const hasHalfHour = duration % 1 !== 0;
                    let birthdayTotal = 0;
                    for (let hour = 1; hour <= fullHours; hour++) {
                      const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                      birthdayTotal += hourPrice;
                    }
                    if (hasHalfHour) {
                      if (fullHours === 0) { birthdayTotal += 2000; }
                      else if (fullHours === 1) { birthdayTotal += 2000; }
                      else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                    }
                    bookingRevenue += birthdayTotal;
                  } else if (service === 'hostess') {
                    bookingRevenue += servicePrices.hostess;
                  } else {
                    const price = servicePrices[service] || 0;
                    bookingRevenue += price * duration;
                  }
                });
              } else if (booking.serviceType) {
                const duration = parseFloat(booking.duration) || 0;
                if (booking.serviceType === 'birthday') {
                  const hours = Math.min(Math.max(Math.ceil(duration), 1), 12);
                  bookingRevenue = servicePrices.birthday[hours] || servicePrices.birthday[4];
                } else if (duration === 0.5 && servicePriceHalfHour[booking.serviceType]) {
                  bookingRevenue = servicePriceHalfHour[booking.serviceType] || 0;
                } else {
                  const pricePerHour = servicePrices[booking.serviceType] || 0;
                  bookingRevenue = pricePerHour * duration;
                }
              }
              
              // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫–∏
              if (booking.discountPercent > 0) {
                bookingRevenue *= (1 - booking.discountPercent / 100);
              } else if (booking.discountAmount > 0) {
                bookingRevenue = Math.max(0, bookingRevenue - booking.discountAmount);
              }
              
              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —ç—Ç–æ –≤—ã—Ä—É—á–∫–∞ –∏–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º–∞—è
              if (bookingDate <= today) {
                actualRevenue += bookingRevenue;
              } else {
                plannedRevenue += bookingRevenue;
              }
              
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–Ω–µ –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
              if (!revenueByDay[booking.bookingDate]) {
                revenueByDay[booking.bookingDate] = {
                  revenue: bookingRevenue,
                  isPlanned: bookingDate > today
                };
              } else {
                revenueByDay[booking.bookingDate].revenue += bookingRevenue;
              }
            }
          } catch (e) {
            console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:", e, booking);
          }
        }
      });

      revenueCard.innerHTML = `
        <h3 class="text-lg font-semibold mb-4 text-green-800">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü</h3>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <span class="text-3xl font-bold text-green-600">${totalRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
            <span class="text-sm text-gray-500">–í—Å–µ–≥–æ</span>
          </div>
          <div class="grid grid-cols-2 gap-4 pt-3 border-t border-green-100">
            <div>
              <p class="text-sm text-gray-600">–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –≤—ã—Ä—É—á–∫–∞</p>
              <p class="text-xl font-semibold text-green-700">${actualRevenue.toLocaleString('ru-RU')} ‚ÇΩ</p>
              <p class="text-xs text-gray-500 mt-1">–û–∫–∞–∑–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –≤—ã—Ä—É—á–∫–∞</p>
              <p class="text-xl font-semibold text-blue-600">${plannedRevenue.toLocaleString('ru-RU')} ‚ÇΩ</p>
              <p class="text-xs text-gray-500 mt-1">–ë—É–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏</p>
            </div>
          </div>
        </div>
        <button class="mt-4 text-sm text-green-700 hover:text-green-900 view-revenue-details flex items-center">
            <i class="fa-solid fa-list mr-1.5"></i> –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é
        </button>
        <div id="revenue-details" class="hidden mt-4 space-y-2 border-t border-green-100 pt-3">
          ${Object.entries(revenueByDay).sort().map(([date, data]) => `
            <div class="flex justify-between items-center py-2">
              <div class="flex items-center">
                <span class="font-medium">${new Date(date + 'T00:00:00').toLocaleDateString('ru-RU', {
                  weekday: 'short',
                  day: '2-digit',
                  month: 'long'
                })}</span>
                ${data.isPlanned ? 
                  '<span class="ml-2 px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded-full">–ü–ª–∞–Ω</span>' : 
                  '<span class="ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded-full">–§–∞–∫—Ç</span>'
                }
              </div>
              <span class="font-medium ${data.isPlanned ? 'text-blue-600' : 'text-green-600'}">
                ${data.revenue.toLocaleString('ru-RU')} ‚ÇΩ
              </span>
            </div>
          `).join('')}
          <div class="pt-3 mt-3 border-t border-green-100 grid grid-cols-2 gap-4 text-sm">
            <div class="flex items-center">
              <span class="w-3 h-3 rounded-full bg-green-100 mr-2"></span>
              <span class="text-gray-600">–û–∫–∞–∑–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏</span>
            </div>
            <div class="flex items-center">
              <span class="w-3 h-3 rounded-full bg-blue-100 mr-2"></span>
              <span class="text-gray-600">–ë—É–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏</span>
            </div>
          </div>
                </div>
      `;
      salaryResults.appendChild(revenueCard);

      // –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –∫—Ç–æ —Ä–∞–±–æ—Ç–∞–ª –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ
      admins.forEach(admin => {
        const data = salaryData[admin.id];
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –ó–ü > 0
        if (data && data.totalSalary > 0) {
          const adminCard = document.createElement('div');
          adminCard.className = 'bg-white rounded-2xl shadow-md p-6 border border-gray-200 transition hover:shadow-lg'; // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏

          adminCard.innerHTML = `
            <h3 class="text-xl font-semibold mb-4 text-gray-800">${admin.name}</h3>
            <div class="grid grid-cols-2 gap-x-6 gap-y-3 mb-5">
              <div>
                <p class="text-sm text-gray-500">–°–º–µ–Ω (–æ—Å–Ω–æ–≤–Ω–æ–π)</p>
                <p class="font-medium text-lg">${data.daysWorked}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">–ß–∞—Å–æ–≤ (–ø–æ–º–æ—â–Ω–∏–∫)</p>
                <p class="font-medium text-lg">${data.hoursWorked}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">–°—Ç–∞–≤–∫–∞ + –ü–æ—á–∞—Å–æ–≤–∞—è</p>
                <p class="font-medium text-lg">${data.baseSalary.toLocaleString('ru-RU')} ‚ÇΩ</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">–ë–æ–Ω—É—Å –æ—Ç –≤—ã—Ä—É—á–∫–∏</p>
                <p class="font-medium text-lg">${data.bonusSalary.toLocaleString('ru-RU', { maximumFractionDigits: 0 })} ‚ÇΩ</p> <!-- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ -->
              </div>
            </div>
            <div class="border-t border-gray-200 pt-4 mt-4">
              <p class="text-sm font-medium text-gray-600">–ò—Ç–æ–≥–æ –∑–∞—Ä–ø–ª–∞—Ç–∞</p>
              <p class="text-2xl font-bold text-blue-600 mt-1">${data.totalSalary.toLocaleString('ru-RU', { maximumFractionDigits: 0 })} ‚ÇΩ</p> <!-- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–π -->
            </div>
            <button class="mt-5 text-sm text-blue-600 hover:text-blue-800 view-details flex items-center" data-admin="${admin.id}">
              <i class="fa-solid fa-list mr-1.5"></i> –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é
            </button>
            <div id="details-${admin.id}" class="hidden mt-4 space-y-3 border-t border-gray-100 pt-4">
              <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
          `;
          salaryResults.appendChild(adminCard);
        }
      });

        // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ –Ω–∏ —É –æ–¥–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
        if (salaryResults.children.length <= 1) { // –¢–æ–ª—å–∫–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤—ã—Ä—É—á–∫–∏
             const noSalaryText = document.createElement('p');
             noSalaryText.className = 'text-center text-gray-500 italic mt-6';
             noSalaryText.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞—Ä–ø–ª–∞—Ç–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü.';
             salaryResults.appendChild(noSalaryText);
        }


      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"
      document.querySelectorAll('.view-details').forEach(btn => {
        btn.addEventListener('click', () => {
          const adminId = btn.getAttribute('data-admin');
          const detailsDiv = document.getElementById(`details-${adminId}`);
          const data = salaryData[adminId];
          const icon = btn.querySelector('i');

          // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å —Å–∫—Ä—ã—Ç–∏—è –∏ –∏–∫–æ–Ω–∫—É
          if (detailsDiv.classList.contains('hidden')) {
            detailsDiv.classList.remove('hidden');
            icon.className = 'fa-solid fa-chevron-up mr-1.5';
            btn.textContent = ' –°–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é';
            btn.insertBefore(icon, btn.firstChild); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∫–æ–Ω–∫—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –Ω–∞—á–∞–ª–æ

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—ë –µ—â–µ –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∞ —É—Å—Ç–∞—Ä–µ–ª–∞
            if (detailsDiv.children.length === 0) {
              data.details.forEach(detail => {
                const detailCard = document.createElement('div');
                detailCard.className = 'py-3 border-b border-gray-100 last:border-b-0';

                const dateObj = new Date(detail.date + 'T00:00:00');
                const formattedDate = dateObj.toLocaleDateString('ru-RU', { 
                  day: '2-digit', 
                  month: 'short',
                  weekday: 'short'
                });

                // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
                let typeClass = 'bg-blue-50 text-blue-800';
                let hoursText = '';
                if (detail.type === '–ü–æ–º–æ—â—å –Ω–∞ —Å–º–µ–Ω–µ') {
                  typeClass = 'bg-indigo-50 text-indigo-800';
                  hoursText = ` (${detail.hours} —á)`;
                }

                let noteHtml = '';
                if (detail.note) {
                  noteHtml = `<div class="mt-1 p-1 bg-yellow-50 text-yellow-800 text-xs rounded-md">${detail.note}</div>`;
                }

                detailCard.innerHTML = `
                  <div class="flex justify-between items-start">
                    <div>
                      <span class="font-medium">${formattedDate}</span>
                      <span class="inline-block px-2 py-0.5 text-xs rounded-full ml-2 ${typeClass}">${detail.type}${hoursText}</span>
                      ${noteHtml}
                    </div>
                    <div class="text-right">
                      <div class="text-gray-600 text-sm">
                        <span>–°—Ç–∞–≤–∫–∞/—á–∞—Å—ã: ${detail.base.toLocaleString('ru-RU')} ‚ÇΩ</span>
                      </div>
                      <div class="text-gray-600 text-sm">
                        <span>–ë–æ–Ω—É—Å: ${detail.bonus.toLocaleString('ru-RU', {maximumFractionDigits: 0})} ‚ÇΩ</span>
                      </div>
                      <div class="font-medium">
                        <span>–ò—Ç–æ–≥–æ: ${(detail.base + detail.bonus).toLocaleString('ru-RU', {maximumFractionDigits: 0})} ‚ÇΩ</span>
                      </div>
                    </div>
                  </div>
                `;
                detailsDiv.appendChild(detailCard);
              });
            }
          } else {
            detailsDiv.classList.add('hidden');
            icon.className = 'fa-solid fa-list mr-1.5';
            btn.textContent = ' –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é';
            btn.insertBefore(icon, btn.firstChild); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∫–æ–Ω–∫—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –Ω–∞—á–∞–ª–æ
          }
        });
      });

       // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏
       const revenueDetailsBtn = document.querySelector('.view-revenue-details');
       if (revenueDetailsBtn) {
           revenueDetailsBtn.addEventListener('click', () => {
               const detailsDiv = document.getElementById('revenue-details');
               const icon = revenueDetailsBtn.querySelector('i');

               if (detailsDiv.classList.contains('hidden')) {
                   // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã—Ä—É—á–∫–∏
                   detailsDiv.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç—å

                   // 1. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Ä—É—á–∫—É –ø–æ –¥–Ω—è–º –Ω–∞–ø—Ä—è–º—É—é –∏–∑ bookings
                   const revenueByDay = {};
                   const year = salaryViewMonth.getFullYear();
                   const month = salaryViewMonth.getMonth();
                   const yearMonthStr = `${year}-${(month + 1).toString().padStart(2, '0')}`;

                   bookings.forEach(booking => {
                       if (typeof booking.bookingDate === 'string' && booking.bookingDate.startsWith(yearMonthStr)) {
                            const dateStr = booking.bookingDate;
                            if (!revenueByDay[dateStr]) {
                                revenueByDay[dateStr] = 0;
                            }

                            // –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ü–û–°–õ–ï —Å–∫–∏–¥–∫–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ calculateRevenueStats)
                            const duration = parseFloat(booking.duration) || 0;
                            let bookingTotalAmount = 0;
                            if (booking.selectedServices && Array.isArray(booking.selectedServices)) {
                                booking.selectedServices.forEach(service => {
                                   if (service === 'birthday') {
                                     const fullHours = Math.floor(duration);
                                     const hasHalfHour = duration % 1 !== 0;
                                     let birthdayTotal = 0;
                                     for (let hour = 1; hour <= fullHours; hour++) {
                                       const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                                       birthdayTotal += hourPrice;
                                     }
                                     if (hasHalfHour) {
                                        if (fullHours === 0) { birthdayTotal += 2000; }
                                        else if (fullHours === 1) { birthdayTotal += 2000; }
                                        else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                                     }
                                     bookingTotalAmount += birthdayTotal;
                                   } else if (service === 'hostess') {
                                     // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                                     bookingTotalAmount += servicePrices.hostess;
                                   } else {
                                     const price = servicePrices[service] || 0;
                                     bookingTotalAmount += price * duration;
                                   }
                                });
                            } else if (booking.serviceType) { // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                                 console.warn('Using legacy serviceType for revenue details calculation (calculating pre-discount amount)', booking);
                                 if (booking.serviceType === 'birthday') {
                                     const hours = Math.min(Math.max(Math.ceil(duration), 1), 12);
                                     bookingTotalAmount = servicePrices.birthday[hours] || servicePrices.birthday[4];
                                 } else if (duration === 0.5 && servicePriceHalfHour[booking.serviceType]) {
                                     bookingTotalAmount = servicePriceHalfHour[booking.serviceType] || 0;
                                 } else {
                                     const pricePerHour = servicePrices[booking.serviceType] || 0;
                                     bookingTotalAmount = pricePerHour * duration;
                                 }
                            }

                            const discountPercent = booking.discountPercent || 0;
                            const discountAmount = booking.discountAmount || 0;
                            let finalBookingAmount = bookingTotalAmount;
                            if (discountPercent > 0) {
                              finalBookingAmount = bookingTotalAmount * (1 - discountPercent / 100);
                            } else if (discountAmount > 0) {
                              finalBookingAmount = Math.max(0, bookingTotalAmount - discountAmount);
                            }

                            revenueByDay[dateStr] += finalBookingAmount; // –°—É–º–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
                       }
                   });

                   // 2. –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –Ω–µ–¥–µ–ª—è–º –∏ —Å—á–∏—Ç–∞–µ–º –∏—Ç–æ–≥–∏
                   const revenueByWeek = {}; // { 'YYYY-MM-DD_–ø–Ω': { days: [{date: '...', amount: N}, ...], total: T } }
                   const sortedDays = Object.keys(revenueByDay).sort();

                   sortedDays.forEach(dateStr => {
                       const amount = revenueByDay[dateStr];
                       if (amount <= 0) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–Ω–∏ –±–µ–∑ –≤—ã—Ä—É—á–∫–∏

                       const dateObj = new Date(dateStr + 'T00:00:00');
                       const weekRange = getWeekRange(dateObj); // –ü–æ–ª—É—á–∞–µ–º –ü–Ω –∏ –í—Å –Ω–µ–¥–µ–ª–∏
                       const mondayStr = formatDateSafe(weekRange.start); // –ö–ª—é—á - –¥–∞—Ç–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞

                       if (!revenueByWeek[mondayStr]) {
                           revenueByWeek[mondayStr] = { days: [], total: 0 };
                       }
                       revenueByWeek[mondayStr].days.push({ date: dateStr, amount: amount });
                       revenueByWeek[mondayStr].total += amount;
                   });

                   // 3. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                   const sortedWeeks = Object.keys(revenueByWeek).sort();

                   if (sortedWeeks.length > 0) {
                        sortedWeeks.forEach(mondayStr => {
                            const weekData = revenueByWeek[mondayStr];

                            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏
                            weekData.days.forEach(dayData => {
                                const detailItem = document.createElement('div');
                                detailItem.className = 'text-sm flex justify-between items-center text-green-800 py-0.5'; // –î–æ–±–∞–≤–ª–µ–Ω –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø
                                const detailDate = new Date(dayData.date + 'T00:00:00');
                                // –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã —Å –¥–Ω–µ–º –Ω–µ–¥–µ–ª–∏
                                const formattedDate = detailDate.toLocaleDateString('ru-RU', { day: '2-digit', month: 'short', weekday: 'short' });
                                detailItem.innerHTML = `
                                    <span>${formattedDate}</span> <!-- –£–±—Ä–∞–Ω–æ –¥–≤–æ–µ—Ç–æ—á–∏–µ -->
                                    <span class="font-medium">${dayData.amount.toLocaleString('ru-RU', { maximumFractionDigits: 0 })} ‚ÇΩ</span>
                                `;
                                detailsDiv.appendChild(detailItem);
                            });

                            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏ –∏—Ç–æ–≥ –Ω–µ–¥–µ–ª–∏
                            const hr = document.createElement('hr');
                            hr.className = 'border-t border-green-200 my-1.5'; // –ß—É—Ç—å —Ç–æ–ª—â–µ –∏ —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏
                            detailsDiv.appendChild(hr);

                            const weekTotalDiv = document.createElement('div');
                            weekTotalDiv.className = 'text-sm font-semibold text-right text-green-700 pr-1 mb-3'; // –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É
                            weekTotalDiv.innerHTML = `–ò—Ç–æ–≥–æ –∑–∞ –Ω–µ–¥–µ–ª—é: ${weekData.total.toLocaleString('ru-RU', { maximumFractionDigits: 0 })} ‚ÇΩ`;
                            detailsDiv.appendChild(weekTotalDiv);
                        });
                   } else {
                       detailsDiv.innerHTML = '<p class="text-xs text-gray-400 italic">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã—Ä—É—á–∫–µ –ø–æ –¥–Ω—è–º –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü.</p>';
                   }


                   detailsDiv.classList.remove('hidden');
                   revenueDetailsBtn.innerHTML = '<i class="fa-solid fa-chevron-up mr-1.5"></i> –°–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é';
               } else {
                   // –°–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã—Ä—É—á–∫–∏
                   detailsDiv.classList.add('hidden');
                   revenueDetailsBtn.innerHTML = '<i class="fa-solid fa-list mr-1.5"></i> –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é';
               }
           });
       }
    }

    // === –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ===
    function showLoginModal() {
      authContainer.classList.remove('hidden');
      document.getElementById('loginEmail').focus();
    }

    onAuthStateChanged(auth, (user) => {
      console.log('Auth state changed. User:', user); // DEBUG
      if (user) {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª
        isAdmin = true;
        console.log('isAdmin set to true'); // DEBUG
        logoutBtn.classList.remove('hidden');
        loginBtn.classList.add('hidden');
        addBookingBtn.classList.remove('hidden'); // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
        adminScheduleSection.classList.remove('hidden'); // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –≥—Ä–∞—Ñ–∏–∫–∞ –∞–¥–º–∏–Ω–æ–≤
        salarySection.classList.remove('hidden'); // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –ó–ü
        loadData(); // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–≤–∫–ª—é—á–∞—è –∞–¥–º–∏–Ω—Å–∫–∏–µ)
      } else {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª
        isAdmin = false;
        console.log('isAdmin set to false'); // DEBUG
        logoutBtn.classList.add('hidden');
        loginBtn.classList.remove('hidden');
        addBookingBtn.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
        adminScheduleSection.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é –≥—Ä–∞—Ñ–∏–∫–∞ –∞–¥–º–∏–Ω–æ–≤
        salarySection.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é –ó–ü

        // –û—á–∏—Å—Ç–∏—Ç—å –∞–¥–º–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        admins = [];
        adminAssignments = [];
        updateAdminSelects();
        renderAdminsCalendar(); // –û—á–∏—Å—Ç–∏—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∞–¥–º–∏–Ω–æ–≤
        calculateSalaries(); // –û—á–∏—Å—Ç–∏—Ç —Å–µ–∫—Ü–∏—é –ó–ü
        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –æ—Å—Ç–∞—é—Ç—Å—è –≤–∏–¥–∏–º—ã–º–∏, –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –≤ loadData
        loadData(); // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
      }
      // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏ —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å/—É–±—Ä–∞—Ç—å –∞–¥–º–∏–Ω—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏
      renderCalendar();
    renderBookingsList();
    });

    // === –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ===
    function setupEventListeners() {
      // --- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ---
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        try {
          await signInWithEmailAndPassword(auth, email, password);
          authContainer.classList.add('hidden'); // –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error);
          alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message); // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        }
      });
      loginBtn.addEventListener('click', showLoginModal);
      logoutBtn.addEventListener('click', () => {
        // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Å–ª—É—à–∞—Ç–µ–ª–µ–π –ü–ï–†–ï–î –≤—ã—Ö–æ–¥–æ–º
        if (unsubscribeAdmins) {
            unsubscribeAdmins();
            unsubscribeAdmins = null;
            console.log('Unsubscribing from admins before logout'); // DEBUG
        }
        if (unsubscribeAdminAssignments) {
            unsubscribeAdminAssignments();
            unsubscribeAdminAssignments = null;
            console.log('Unsubscribing from adminAssignments before logout'); // DEBUG
        }
        // –í—ã–ø–æ–ª–Ω—è–µ–º –≤—ã—Ö–æ–¥
        signOut(auth);
      });
      closeAuthBtn.addEventListener('click', () => authContainer.classList.add('hidden'));

      // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É—Å–ª—É–≥ –∏ —Å–∫–∏–¥–æ–∫ ---
      document.querySelectorAll('.service-tag').forEach(tag => {
        tag.addEventListener('click', () => {
          const service = tag.getAttribute('data-service');
          tag.classList.toggle('selected');
          
          if (tag.classList.contains('selected')) {
            selectedServices.add(service);
          } else {
            selectedServices.delete(service);
          }
          
          document.getElementById('selectedServices').value = Array.from(selectedServices).join(',');
          calculateTotal();
        });
      });

      const discountPercentInput = document.getElementById('discountPercent');
      const discountAmountInput = document.getElementById('discountAmount');

      discountPercentInput.addEventListener('input', () => {
        if (discountPercentInput.value) {
          discountAmountInput.value = '';
        }
        calculateTotal();
      });

      discountAmountInput.addEventListener('input', () => {
        if (discountAmountInput.value) {
          discountPercentInput.value = '';
        }
        calculateTotal();
      });

      // --- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∫–ª–∏–µ–Ω—Ç–æ–≤ ---
    prevMonthBtn.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
        selectedDate = null; // –°–±—Ä–æ—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ –º–µ—Å—è—Ü–∞
      renderCalendar();
    });
    nextMonthBtn.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      selectedDate = null;
      renderCalendar();
    });
      addBookingBtn.addEventListener('click', () => openBookingModal(selectedDate || new Date())); // –ü–µ—Ä–µ–¥–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è


      // --- –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤ ---
    prevMonthBookingsBtn.addEventListener('click', () => {
        console.log('Prev month bookings clicked. Old month:', bookingsViewMonth.toLocaleDateString()); // DEBUG
      bookingsViewMonth.setMonth(bookingsViewMonth.getMonth() - 1);
         console.log('New month:', bookingsViewMonth.toLocaleDateString()); // DEBUG
        renderBookingsList(); // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
    });
    nextMonthBookingsBtn.addEventListener('click', () => {
         console.log('Next month bookings clicked. Old month:', bookingsViewMonth.toLocaleDateString()); // DEBUG
      bookingsViewMonth.setMonth(bookingsViewMonth.getMonth() + 1);
        console.log('New month:', bookingsViewMonth.toLocaleDateString()); // DEBUG
        renderBookingsList(); // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
      });

      // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ ---
      bookingForm.addEventListener('submit', handleBookingFormSubmit);
      closeModalBtn.addEventListener('click', () => bookingModal.classList.add('hidden'));
      deleteBookingBtn.addEventListener('click', () => {
         const id = bookingIdInput.value;
         const booking = bookings.find(b => b.id === id);
         if (id && booking && confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –¥–ª—è "${booking.clientName}"?`)) {
             deleteBooking(id);
             bookingModal.classList.add('hidden'); // –ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
         }
      });

      // --- –ì—Ä–∞—Ñ–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ ---
      prevMonthAdminsBtn.addEventListener('click', () => {
        adminsViewMonth.setMonth(adminsViewMonth.getMonth() - 1);
        renderAdminsCalendar();
      });
      nextMonthAdminsBtn.addEventListener('click', () => {
        adminsViewMonth.setMonth(adminsViewMonth.getMonth() + 1);
        renderAdminsCalendar();
      });

      // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞ ---
      assignAdminForm.addEventListener('submit', handleAssignAdminFormSubmit);
      closeAssignModal.addEventListener('click', () => assignAdminModal.classList.add('hidden'));
      deleteAssignmentBtn.addEventListener('click', deleteAssignment); // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–º–æ—â–Ω–∏–∫–æ–≤ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
      mainAdminSelect.addEventListener('change', updateHelperAdminOptions);
       // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–æ–ª—è —á–∞—Å–æ–≤ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø–æ–º–æ—â–Ω–∏–∫–∞
      helperAdminSelect.addEventListener('change', () => {
          const isHelperSelected = helperAdminSelect.value !== "";
          toggleHelperHours(isHelperSelected);
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –≤—ã–±–æ—Ä–∞ –î–Ω—è –†–æ–∂–¥–µ–Ω–∏—è
          if (isHelperSelected) {
            birthdayBookingSection.classList.remove('hidden');
          } else {
            birthdayBookingSection.classList.add('hidden');
            birthdayBookingSelect.value = '';
            maxHelperHoursNote.classList.add('hidden');
          }
          
          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏–º, –Ω–µ –≤—ã–±—Ä–∞–Ω –ª–∏ —Ç–æ—Ç –∂–µ, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π
          if (mainAdminSelect.value && helperAdminSelect.value && mainAdminSelect.value === helperAdminSelect.value) {
               alert('–û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏ –ø–æ–º–æ—â–Ω–∏–∫ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ —á–µ–ª–æ–≤–µ–∫–æ–º.');
               helperAdminSelect.value = ""; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–º–æ—â–Ω–∏–∫–∞
               toggleHelperHours(false); // –°–∫—Ä—ã–≤–∞–µ–º —á–∞—Å—ã
               birthdayBookingSection.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –î–†
          }
      });


      // --- –†–∞—Å—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã ---
      prevMonthSalaryBtn.addEventListener('click', () => {
        console.log('Previous month clicked, current month:', salaryViewMonth);
        salaryViewMonth.setMonth(salaryViewMonth.getMonth() - 1);
        console.log('Month changed to:', salaryViewMonth);
        // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—ã—Ä—É—á–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞
        calculateRevenueStats();
        calculateSalaries();
        // –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –ó–ü –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞
      });
      nextMonthSalaryBtn.addEventListener('click', () => {
        console.log('Next month clicked, current month:', salaryViewMonth);
        salaryViewMonth.setMonth(salaryViewMonth.getMonth() + 1);
        console.log('Month changed to:', salaryViewMonth);
         // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—ã—Ä—É—á–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞
        calculateRevenueStats();
        calculateSalaries();
         // –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –ó–ü –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞
      });

       // --- –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω ---
       // –ö–ª–∏–∫ –≤–Ω–µ –æ–∫–Ω–∞
       [authContainer, bookingModal, assignAdminModal, dayDetailsModal, adminDayDetailsModal].forEach(modal => { // –î–æ–±–∞–≤–ª–µ–Ω–æ adminDayDetailsModal
           modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });
       });
       // –ö–ª–∞–≤–∏—à–∞ Esc
       document.addEventListener('keydown', function(e) {
           if (e.key === 'Escape') {
               if (!authContainer.classList.contains('hidden')) {
                   authContainer.classList.add('hidden');
               }
               if (!bookingModal.classList.contains('hidden')) {
        bookingModal.classList.add('hidden');
               }
               if (!assignAdminModal.classList.contains('hidden')) {
                   assignAdminModal.classList.add('hidden');
               }
               if (!dayDetailsModal.classList.contains('hidden')) { // –î–æ–±–∞–≤–ª–µ–Ω–æ
                   dayDetailsModal.classList.add('hidden');
               }
               if (!adminDayDetailsModal.classList.contains('hidden')) { // –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                   adminDayDetailsModal.classList.add('hidden');
               }
           }
       });

      const durationSelect = document.getElementById('duration'); // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
      durationSelect.addEventListener('input', calculateTotal); // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞

      // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –¥–Ω—è ---
      closeDayDetailsModalBtn.addEventListener('click', () => dayDetailsModal.classList.add('hidden'));
      
      // --- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ ---
      closeAdminDayDetailsModalBtn.addEventListener('click', () => adminDayDetailsModal.classList.add('hidden'));
    }

    // === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ===
    function getServiceLabel(serviceType) {
      // –û–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π —É—Å–ª—É–≥
      switch (serviceType) {
        case 'weekday_ps1': return 'PS5 (1 –¥–∂.)';
        case 'weekday_ps2': return 'PS5 (2 –¥–∂.)';
        case 'weekday_vr1': return 'VR (1) | –ë—É–¥–Ω–∏';
        case 'weekday_vr2': return 'VR (2) | –ë—É–¥–Ω–∏';
        case 'weekday_vr3': return 'VR (3) | –ë—É–¥–Ω–∏';
        case 'weekday_vr4': return 'VR (4) | –ë—É–¥–Ω–∏';
        case 'weekend_vr1': return 'VR (1) | –í—ã—Ö–æ–¥–Ω—ã–µ';
        case 'weekend_vr2': return 'VR (2) | –í—ã—Ö–æ–¥–Ω—ã–µ';
        case 'weekend_vr3': return 'VR (3) | –í—ã—Ö–æ–¥–Ω—ã–µ';
        case 'weekend_vr4': return 'VR (4) | –í—ã—Ö–æ–¥–Ω—ã–µ';
        case 'xbox_kinnect': return 'X-Box Kinnect';
        case 'xbox1': return 'X-Box (1 –¥–∂.)';
        case 'xbox2': return 'X-Box (2 –¥–∂.)';
        case 'xbox3': return 'X-Box (3 –¥–∂.)';
        case 'xbox4': return 'X-Box (4 –¥–∂.)';
        case 'karaoke': return '–ö–∞—Ä–∞–æ–∫–µ';
        case 'board_games': return '–ù–∞—Å—Ç. –∏–≥—Ä—ã';
        case 'birthday': return '–ê—Ä–µ–Ω–¥–∞ (–î–†)';
        case 'hostess': return '–í–µ–¥—É—â–∞—è (—Ñ–∏–∫—Å. —Å—Ç–æ–∏–º–æ—Å—Ç—å)';
        default: return '–ù–µ–∏–∑–≤. —É—Å–ª—É–≥–∞'; // –°–æ–∫—Ä–∞—â–µ–Ω–æ
      }
    }

    function formatPhoneNumber(phoneStr) {
        if (!phoneStr) return '';
        const digits = phoneStr.replace(/\D/g, '');
        // –û–∂–∏–¥–∞–µ–º —Ñ–æ—Ä–º–∞—Ç +7 (XXX) XXX-XX-XX (11 —Ü–∏—Ñ—Ä)
        if (digits.length === 11 && digits.startsWith('7')) {
             return `+7 (${digits.substring(1, 4)}) ${digits.substring(4, 7)}-${digits.substring(7, 9)}-${digits.substring(9, 11)}`;
        }
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å, –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –¥—Ä—É–≥–æ–π
        return phoneStr;
    }


    // === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ ===
    function calculateTotal() {
      const duration = parseFloat(document.getElementById('duration').value) || 0;
      let total = 0;

      // –°—É–º–º–∏—Ä—É–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥
      selectedServices.forEach(service => {
                   if (service === 'birthday') { 
          // –î–ª—è –∞—Ä–µ–Ω–¥—ã –≤—Å–µ–≥–æ (–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è) ‚Äî —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –ø–æ–ª—É—á–∞—Å–æ–≤—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
                     const fullHours = Math.floor(duration);
                     const hasHalfHour = duration % 1 !== 0;
                     let birthdayTotal = 0;

          // –°—É–º–º–∏—Ä—É–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ª–Ω—ã—Ö —á–∞—Å–æ–≤
          for (let hour = 1; hour <= fullHours; hour++) {
            const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
            birthdayTotal += hourPrice;
          }

          // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –ø–æ–ª—á–∞—Å–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
          if (hasHalfHour) {
            if (fullHours === 0) { // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ 0.5 —á–∞—Å–∞
               birthdayTotal += 2000; // –ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å 1.5—á? –ò–ª–∏ —Ü–µ–Ω–∞ –ø–µ—Ä–≤–æ–≥–æ —á–∞—Å–∞? –£—Ç–æ—á–Ω–∏—Ç—å, –ø–æ–∫–∞ –±–µ—Ä–µ–º 2000
            } else if (fullHours === 1) { // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 1.5 —á–∞—Å–∞
              birthdayTotal += 2000; // –û—Å–æ–±–∞—è —Ü–µ–Ω–∞ –∑–∞ +0.5 —á–∞—Å–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ
            } else { // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 2.5, 3.5, 4.5 –∏ —Ç.–¥.
              // –ë–µ—Ä–µ–º —Ü–µ–Ω—É 3-–≥–æ –∏–ª–∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —á–∞—Å–∞ (3000) –∏ –¥–µ–ª–∏–º –ø–æ–ø–æ–ª–∞–º
              const halfHourPrice = (servicePrices.birthday[3] || 3000) / 2;
              birthdayTotal += halfHourPrice; // 1500
            }
          }

          total += birthdayTotal;
        } else if (service === 'hostess') {
          // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
          total += servicePrices.hostess;
        } else {
          // –û–±—ã—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö —É—Å–ª—É–≥ (—Ü–µ–Ω–∞ * –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
          const price = servicePrices[service] || 0;
          total += price * duration;
        }
      });

      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É
      const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
      const discountAmount = parseFloat(document.getElementById('discountAmount').value) || 0;
      
      let finalAmount = total;
      if (discountPercent > 0) {
        finalAmount = total * (1 - discountPercent / 100);
      } else if (discountAmount > 0) {
        finalAmount = Math.max(0, total - discountAmount);
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      document.getElementById('totalAmount').value = `${total.toLocaleString('ru-RU')} ‚ÇΩ`;
      document.getElementById('finalAmount').value = `${finalAmount.toLocaleString('ru-RU')} ‚ÇΩ`;
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ===
    function init() {
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
      const now = new Date();
      currentDate = new Date(now.getFullYear(), now.getMonth(), 1);
      bookingsViewMonth = new Date(now.getFullYear(), now.getMonth(), 1);
      adminsViewMonth = new Date(now.getFullYear(), now.getMonth(), 1);
      salaryViewMonth = new Date(now.getFullYear(), now.getMonth(), 1);

      setupEventListeners(); // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
      // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ onAuthStateChanged
      // –ù–æ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å renderCalendar –∏ renderBookingsList –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—É—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
    renderCalendar();
    renderBookingsList();
      renderAdminsCalendar(); // –ü–æ–∫–∞–∂–µ—Ç –ø—É—Å—Ç–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∞–¥–º–∏–Ω–æ–≤ –∏–ª–∏ —Å–∫—Ä–æ–µ—Ç —Å–µ–∫—Ü–∏—é
      calculateSalaries(); // –ü–æ–∫–∞–∂–µ—Ç –ø—É—Å—Ç—É—é –ó–ü –∏–ª–∏ —Å–∫—Ä–æ–µ—Ç —Å–µ–∫—Ü–∏—é
      renderRevenueStats(0, 0, 0); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω—É–ª—è–º–∏
      renderWeeklyPayroll({}, null); // –ò–Ω–∏—Ü. –ø—É—Å—Ç—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
      calculateSalaries(); // –ü–æ–∫–∞–∑. –ø—É—Å—Ç–æ–π –º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç
      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ onAuthStateChanged
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    init();

    // === –†–∞—Å—á–µ—Ç –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –í—ã—Ä—É—á–∫–∏ ===
    function calculateRevenueStats() {
        const todayStr = formatDateSafe(new Date());
        const currentWeek = getWeekRange(new Date());
        const currentWeekStartStr = formatDateSafe(currentWeek.start);
        const currentWeekEndStr = formatDateSafe(currentWeek.end);
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const monthYearStr = `${salaryViewMonth.getFullYear()}-${(salaryViewMonth.getMonth() + 1).toString().padStart(2, '0')}`;

        let revenueToday = 0;
        let revenueCurrentWeek = { actual: 0, planned: 0 };
        let revenueSelectedMonth = { actual: 0, planned: 0 };

        bookings.forEach(booking => {
            if (typeof booking.bookingDate !== 'string') return;

            const duration = parseFloat(booking.duration) || 0;
            let bookingTotalAmount = 0; // –°—É–º–º–∞ –î–û —Å–∫–∏–¥–∫–∏

            // –†–∞—Å—á–µ—Ç —Å—É–º–º—ã –î–û —Å–∫–∏–¥–∫–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ calculateSalaries)
            if (booking.selectedServices && Array.isArray(booking.selectedServices)) {
                 booking.selectedServices.forEach(service => {
                     if (service === 'birthday') {
                         const fullHours = Math.floor(duration);
                         const hasHalfHour = duration % 1 !== 0;
                         let birthdayTotal = 0;
                     for (let hour = 1; hour <= fullHours; hour++) {
                       const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                       birthdayTotal += hourPrice;
                     }
                     if (hasHalfHour) {
                        if (fullHours === 0) { birthdayTotal += 2000; }
                        else if (fullHours === 1) { birthdayTotal += 2000; }
                        else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                     }
                     bookingTotalAmount += birthdayTotal;
                   } else if (service === 'hostess') {
                     // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                     bookingTotalAmount += servicePrices.hostess;
                   } else {
                     const price = servicePrices[service] || 0;
                     bookingTotalAmount += price * duration;
                   }
                 });
            } else if (booking.serviceType) { // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                 console.warn('Using legacy serviceType for revenue stats calculation (calculating pre-discount amount)', booking);
                 if (booking.serviceType === 'birthday') {
                     const hours = Math.min(Math.max(Math.ceil(duration), 1), 12);
                     bookingTotalAmount = servicePrices.birthday[hours] || servicePrices.birthday[4];
                 } else if (duration === 0.5 && servicePriceHalfHour[booking.serviceType]) {
                     bookingTotalAmount = servicePriceHalfHour[booking.serviceType] || 0;
                 } else {
                     const pricePerHour = servicePrices[booking.serviceType] || 0;
                     bookingTotalAmount = pricePerHour * duration;
                 }
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ü–û–°–õ–ï —Å–∫–∏–¥–∫–∏
            const discountPercent = booking.discountPercent || 0;
            const discountAmount = booking.discountAmount || 0;
            let finalBookingAmount = bookingTotalAmount; // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —ç—Ç–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            if (discountPercent > 0) {
              finalBookingAmount = bookingTotalAmount * (1 - discountPercent / 100);
            } else if (discountAmount > 0) {
              finalBookingAmount = Math.max(0, bookingTotalAmount - discountAmount);
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –ø–ª–∞–Ω–∏—Ä—É–µ–º–∞—è —ç—Ç–æ –≤—ã—Ä—É—á–∫–∞ –∏–ª–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è
            const bookingDate = new Date(booking.bookingDate + 'T00:00:00');
            const isPlanned = bookingDate > today;

            // –°—É–º–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—É—é –≤—ã—Ä—É—á–∫—É
            if (booking.bookingDate === todayStr) {
                revenueToday += finalBookingAmount;
            }
            if (booking.bookingDate >= currentWeekStartStr && booking.bookingDate <= currentWeekEndStr) {
                if (isPlanned) {
                    revenueCurrentWeek.planned += finalBookingAmount;
                } else {
                    revenueCurrentWeek.actual += finalBookingAmount;
                }
            }
            if (booking.bookingDate.startsWith(monthYearStr)) {
                if (isPlanned) {
                    revenueSelectedMonth.planned += finalBookingAmount;
                } else {
                    revenueSelectedMonth.actual += finalBookingAmount;
                }
            }
        });

        renderRevenueStats(revenueToday, revenueCurrentWeek, revenueSelectedMonth);
    }

    // === –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –í—ã—Ä—É—á–∫–∏ ===
    function renderRevenueStats(today, week, month) {
        const todayDate = new Date();
        const currentWeekRange = getWeekRange(todayDate);
        const selectedMonthStart = new Date(salaryViewMonth.getFullYear(), salaryViewMonth.getMonth(), 1);
        const selectedMonthEnd = new Date(salaryViewMonth.getFullYear(), salaryViewMonth.getMonth() + 1, 0);
        
        const dateOptions = { day: '2-digit', month: 'short' };
        const dateOptionsWeekday = { weekday: 'short', day: '2-digit', month: 'short' };

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã
        const todayStr = todayDate.toLocaleDateString('ru-RU', dateOptions);
        const weekStartStr = currentWeekRange.start.toLocaleDateString('ru-RU', dateOptionsWeekday);
        const weekEndStr = currentWeekRange.end.toLocaleDateString('ru-RU', dateOptionsWeekday);
        const monthStartStr = selectedMonthStart.toLocaleDateString('ru-RU', dateOptionsWeekday);
        const monthEndStr = selectedMonthEnd.toLocaleDateString('ru-RU', dateOptionsWeekday);

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É–º–º—ã –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
        const revenueTodayEl = document.getElementById('revenueToday');
        const revenueCurrentWeekEl = document.getElementById('revenueCurrentWeek');
        const revenueSelectedMonthEl = document.getElementById('revenueSelectedMonth');

        if (revenueTodayEl) revenueTodayEl.textContent = `${today.toLocaleString('ru-RU')} ‚ÇΩ`;
        if (revenueCurrentWeekEl) {
            const totalWeekRevenue = week.actual + week.planned;
            revenueCurrentWeekEl.innerHTML = `
                ${totalWeekRevenue.toLocaleString('ru-RU')} ‚ÇΩ
                ${week.planned > 0 ? `
                    <div class="text-xs text-blue-600 mt-1">
                        <span class="font-medium">–í–∫–ª—é—á–∞—è –ø–ª–∞–Ω–∏—Ä—É–µ–º—É—é: ${week.planned.toLocaleString('ru-RU')} ‚ÇΩ</span>
                    </div>
                ` : ''}
            `;
        }
        if (revenueSelectedMonthEl) {
            const totalMonthRevenue = month.actual + month.planned;
            revenueSelectedMonthEl.innerHTML = `
                ${totalMonthRevenue.toLocaleString('ru-RU')} ‚ÇΩ
                ${month.planned > 0 ? `
                    <div class="text-xs text-blue-600 mt-1">
                        <span class="font-medium">–í–∫–ª—é—á–∞—è –ø–ª–∞–Ω–∏—Ä—É–µ–º—É—é: ${month.planned.toLocaleString('ru-RU')} ‚ÇΩ</span>
                    </div>
                ` : ''}
            `;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞ —Å –¥–∞—Ç–æ–π/–ø–µ—Ä–∏–æ–¥–æ–º
        const upsertDateParagraph = (parentElement, dateString, elementId) => {
            if (!parentElement) return;
            let dateP = parentElement.querySelector('.stat-date'); // –ò—â–µ–º –ø–æ –∫–ª–∞—Å—Å—É
            if (!dateP) { // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º
                dateP = document.createElement('p');
                dateP.className = 'stat-date text-xs -mt-0.5 mb-1'; // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å
                dateP.style.color = 'rgb(16, 146, 175)';
                const targetElement = document.getElementById(elementId);
                if (targetElement) {
                    parentElement.insertBefore(dateP, targetElement); // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ —Å—É–º–º–æ–π
                }
            }
            dateP.textContent = dateString; // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
        };

        // –í—Å—Ç–∞–≤–ª—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—ã/–ø–µ—Ä–∏–æ–¥—ã
        upsertDateParagraph(revenueTodayEl?.closest('div'), todayStr, 'revenueToday');
        upsertDateParagraph(revenueCurrentWeekEl?.closest('div'), `—Å ${weekStartStr} –ø–æ ${weekEndStr}`, 'revenueCurrentWeek');
        upsertDateParagraph(revenueSelectedMonthEl?.closest('div'), `—Å ${monthStartStr} –ø–æ ${monthEndStr}`, 'revenueSelectedMonth');
    }


    // === –†–∞—Å—á–µ—Ç –ó–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ –¢–µ–∫—É—â—É—é –∏ –ü—Ä–æ—à–ª—É—é –ù–µ–¥–µ–ª—é ===
    function calculateWeeklyPayroll() {
        const today = new Date();
        const isMonday = today.getDay() === 1;
        const currentWeek = getWeekRange(today);
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
        const weekStartStr = formatDateSafe(currentWeek.start);
        const weekEndStr = formatDateSafe(currentWeek.end);

        // –ü–æ–ª—É—á–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–∏
        const previousWeek = {
            start: new Date(currentWeek.start),
            end: new Date(currentWeek.start)
        };
        previousWeek.start.setDate(previousWeek.start.getDate() - 7);
        previousWeek.end.setDate(previousWeek.end.getDate() - 1);
        const prevWeekStartStr = formatDateSafe(previousWeek.start);
        const prevWeekEndStr = formatDateSafe(previousWeek.end);

        // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ
        const weeklyPayrollData = {}; // { adminId: { name: 'Name', total: 0, previousWeekTotal: 0 } }

        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        admins.forEach(admin => {
            weeklyPayrollData[admin.id] = { 
                name: admin.name, 
                total: 0,
                previousWeekTotal: 0
            };
        });

        // 2. –§–∏–ª—å—Ç—Ä—É–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞ —Ç–µ–∫—É—â—É—é –∏ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª–∏
        const weekAssignments = adminAssignments.filter(a =>
            typeof a.date === 'string' && a.date >= weekStartStr && a.date <= weekEndStr
        );

        const prevWeekAssignments = isMonday ? adminAssignments.filter(a =>
            typeof a.date === 'string' && a.date >= prevWeekStartStr && a.date <= prevWeekEndStr
        ) : [];

        const weekBookingsByDate = {};
        const prevWeekBookingsByDate = {};
        
        bookings.forEach(booking => {
            if (typeof booking.bookingDate === 'string') {
                // –î–ª—è —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
                if (booking.bookingDate >= weekStartStr && booking.bookingDate <= weekEndStr) {
                    const dateStr = booking.bookingDate;
                    if (!weekBookingsByDate[dateStr]) {
                        weekBookingsByDate[dateStr] = [];
                    }
                    weekBookingsByDate[dateStr].push(booking);
                }
                
                // –î–ª—è –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
                if (isMonday && booking.bookingDate >= prevWeekStartStr && booking.bookingDate <= prevWeekEndStr) {
                const dateStr = booking.bookingDate;
                if (!prevWeekBookingsByDate[dateStr]) {
                    prevWeekBookingsByDate[dateStr] = [];
                }
                prevWeekBookingsByDate[dateStr].push(booking);
                }
             }
        });

         // 3. –†–∞—Å—á–µ—Ç –ó–ü –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é
         weekAssignments.forEach(assignment => {
            const dateStr = assignment.date;
            const dayBookings = weekBookingsByDate[dateStr] || [];
            let dayRevenue = 0; // –ò—Ç–æ–≥–æ–≤–∞—è –≤—ã—Ä—É—á–∫–∞ –¥–Ω—è –ü–û–°–õ–ï —Å–∫–∏–¥–æ–∫
            let birthdayRevenue = 0; // –í—ã—Ä—É—á–∫–∞ —Ç–æ–ª—å–∫–æ –æ—Ç –î–†
            let hostessRevenue = 0; // –í—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥–∏ –≤–µ–¥—É—â–µ–π
            let otherServicesRevenue = 0; // –í—ã—Ä—É—á–∫–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö —É—Å–ª—É–≥

            // –†–∞—Å—á–µ—Ç –≤—ã—Ä—É—á–∫–∏ –¥–Ω—è
            dayBookings.forEach(booking => {
                 let bookingTotalAmount = 0; // –°—É–º–º–∞ –¥–æ —Å–∫–∏–¥–∫–∏
                 const duration = parseFloat(booking.duration) || 0;

                 // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å–ª—É–≥–∞ "–ê—Ä–µ–Ω–¥–æ–π –î–†"
                 const isBirthdayService = 
                     (booking.selectedServices && Array.isArray(booking.selectedServices) && 
                      booking.selectedServices.includes('birthday')) || 
                     booking.serviceType === 'birthday';

                 // –ò—Å–ø–æ–ª—å–∑—É–µ–º selectedServices –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã –î–û —Å–∫–∏–¥–∫–∏
                 if (booking.selectedServices && Array.isArray(booking.selectedServices)) {
                     booking.selectedServices.forEach(service => {
                         if (service === 'birthday') {
                             // –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –î–†
                             const fullHours = Math.floor(duration);
                             const hasHalfHour = duration % 1 !== 0;
                             let birthdayTotal = 0;
                             for (let hour = 1; hour <= fullHours; hour++) {
                                 const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                                 birthdayTotal += hourPrice;
                             }
                             if (hasHalfHour) {
                                 if (fullHours === 0) { birthdayTotal += 2000; }
                                 else if (fullHours === 1) { birthdayTotal += 2000; }
                                 else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                             }
                             bookingTotalAmount += birthdayTotal;
                         } else if (service === 'hostess') {
                           // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                           bookingTotalAmount += servicePrices.hostess;
                           hostessRevenue += servicePrices.hostess;
                         } else {
                             const price = servicePrices[service] || 0;
                             bookingTotalAmount += price * duration;
                         }
                     });
                 } else if (booking.serviceType) { // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –ø–æ–ª–µ–º
                      // –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã –î–û —Å–∫–∏–¥–∫–∏ –ø–æ —Å—Ç–∞—Ä–æ–º—É –ø–æ–ª—é serviceType
                      // ... (–ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ bookingRevenue –ø–æ serviceType –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–π –∂–µ, –Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –≤ bookingTotalAmount) ...
                       console.warn('Using legacy serviceType for weekly payroll calculation (calculating pre-discount amount)', booking);
                       if (booking.serviceType === 'birthday') {
                           const hours = Math.min(Math.max(Math.ceil(duration), 1), 12);
                           bookingTotalAmount = servicePrices.birthday[hours] || servicePrices.birthday[4];
                       } else if (duration === 0.5 && servicePriceHalfHour[booking.serviceType]) {
                           bookingTotalAmount = servicePriceHalfHour[booking.serviceType] || 0;
                       } else {
                           const pricePerHour = servicePrices[booking.serviceType] || 0;
                           bookingTotalAmount = pricePerHour * duration;
                       }
                 }

                 // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–∫–∏
                 const discountPercent = booking.discountPercent || 0;
                 const discountAmount = booking.discountAmount || 0;
                 let finalBookingAmount = bookingTotalAmount; // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —ç—Ç–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                 if (discountPercent > 0) {
                   finalBookingAmount = bookingTotalAmount * (1 - discountPercent / 100);
                 } else if (discountAmount > 0) {
                   finalBookingAmount = Math.max(0, bookingTotalAmount - discountAmount);
                 }

                 dayRevenue += finalBookingAmount; // –î–æ–±–∞–≤–ª—è–µ–º –∫ –≤—ã—Ä—É—á–∫–µ –¥–Ω—è –ò–¢–û–ì–û–í–£–Æ —Å—É–º–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                 
                 // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã—Ä—É—á–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                 if (isBirthdayService) {
                     birthdayRevenue += finalBookingAmount;
              } else {
                     otherServicesRevenue += finalBookingAmount;
                 }
            });

            // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
            if (assignment.mainAdminId && weeklyPayrollData[assignment.mainAdminId]) {
                const basePay = 500;
                const bonusPercent = assignment.helperAdminId ? 0.08 : 0.15;
                let bonus;
                
                if (birthdayRevenue > 0) {
                    // –ï—Å–ª–∏ –±—ã–ª –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º –±–æ–Ω—É—Å –æ—Ç (–≤—ã—Ä—É—á–∫–∏ –î–† –º–∏–Ω—É—Å –≤–µ–¥—É—â–∞—è) + –≤—ã—Ä—É—á–∫–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö —É—Å–ª—É–≥
                    const birthdayBonusRevenue = birthdayRevenue - hostessRevenue;
                    bonus = (birthdayBonusRevenue + otherServicesRevenue) * bonusPercent;
                } else {
                    // –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –î–Ω—è –†–æ–∂–¥–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º –±–æ–Ω—É—Å –æ—Ç –≤—Å–µ–π –≤—ã—Ä—É—á–∫–∏ –∑–∞ –¥–µ–Ω—å
                    bonus = dayRevenue * bonusPercent;
                }
                
                const total = basePay + bonus;
                weeklyPayrollData[assignment.mainAdminId].total += total;
            }

            // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–º–æ—â–Ω–∏–∫—É
            if (assignment.helperAdminId && weeklyPayrollData[assignment.helperAdminId] && assignment.helperHours) {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –ø–æ–º–æ—â–Ω–∏–∫–∞
                let actualHelperHours = 0;
                
                (dayBookings || []).forEach(booking => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å–ª—É–≥–∞ "–ê—Ä–µ–Ω–¥–æ–π –î–†"
                    const isBirthdayService = 
                        (booking.selectedServices && Array.isArray(booking.selectedServices) && 
                         booking.selectedServices.includes('birthday')) || 
                        booking.serviceType === 'birthday';
                    
                    if (isBirthdayService) {
                        // –°—á–∏—Ç–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –ø–æ–º–æ—â–Ω–∏–∫–∞
                        const duration = parseFloat(booking.duration) || 0;
                        actualHelperHours += duration;
                    }
                });
                
                actualHelperHours = Math.round(actualHelperHours);
                const hours = actualHelperHours > 0 ? actualHelperHours : parseInt(assignment.helperHours);
                const basePay = hours * 150;
                const bonusPercent = 0.07;
                const bonusRevenue = birthdayRevenue - hostessRevenue;
                const bonus = bonusRevenue * bonusPercent;
                weeklyPayrollData[assignment.helperAdminId].total += basePay + bonus;
            }
         });
                        
         // 4. –†–∞—Å—á–µ—Ç –ó–ü –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é (–µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
         if (isMonday) {
             prevWeekAssignments.forEach(assignment => {
                 const dateStr = assignment.date;
                 const dayBookings = prevWeekBookingsByDate[dateStr] || [];
                 let dayRevenue = 0;
                 let birthdayRevenue = 0;
                 let hostessRevenue = 0;
                 let otherServicesRevenue = 0;

                 // –†–∞—Å—á–µ—Ç –≤—ã—Ä—É—á–∫–∏ –¥–Ω—è
                 dayBookings.forEach(booking => {
                        let bookingTotalAmount = 0;
                     const duration = parseFloat(booking.duration) || 0;
                     const isBirthdayService = 
                         (booking.selectedServices && Array.isArray(booking.selectedServices) && 
                          booking.selectedServices.includes('birthday')) || 
                         booking.serviceType === 'birthday';

                     if (booking.selectedServices && Array.isArray(booking.selectedServices)) {
                         booking.selectedServices.forEach(service => {
                             if (service === 'birthday') {
                            const fullHours = Math.floor(duration);
                            const hasHalfHour = duration % 1 !== 0;
                            let birthdayTotal = 0;
                            for (let hour = 1; hour <= fullHours; hour++) {
                                const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                                birthdayTotal += hourPrice;
                            }
                            if (hasHalfHour) {
                                if (fullHours === 0) { birthdayTotal += 2000; }
                                else if (fullHours === 1) { birthdayTotal += 2000; }
                                else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                            }
                                 bookingTotalAmount += birthdayTotal;
                             } else if (service === 'hostess') {
                                 bookingTotalAmount += servicePrices.hostess;
                                 hostessRevenue += servicePrices.hostess;
                             } else {
                                 const price = servicePrices[service] || 0;
                                 bookingTotalAmount += price * duration;
                             }
                         });
                     } else if (booking.serviceType) {
                         if (booking.serviceType === 'birthday') {
                            const hours = Math.min(Math.max(Math.ceil(duration), 1), 12);
                            bookingTotalAmount = servicePrices.birthday[hours] || servicePrices.birthday[4];
                         } else if (duration === 0.5 && servicePriceHalfHour[booking.serviceType]) {
                             bookingTotalAmount = servicePriceHalfHour[booking.serviceType] || 0;
                         } else {
                             const pricePerHour = servicePrices[booking.serviceType] || 0;
                             bookingTotalAmount = pricePerHour * duration;
                         }
                        }
                        
                     // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫–∏
                        const discountPercent = booking.discountPercent || 0;
                        const discountAmount = booking.discountAmount || 0;
                        let finalBookingAmount = bookingTotalAmount;
                        if (discountPercent > 0) {
                            finalBookingAmount = bookingTotalAmount * (1 - discountPercent / 100);
                        } else if (discountAmount > 0) {
                            finalBookingAmount = Math.max(0, bookingTotalAmount - discountAmount);
                        }
                        
                     dayRevenue += finalBookingAmount;
                     if (isBirthdayService) {
                        birthdayRevenue += finalBookingAmount;
                     } else {
                         otherServicesRevenue += finalBookingAmount;
                     }
                 });
                
                 // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é
                 if (assignment.mainAdminId && weeklyPayrollData[assignment.mainAdminId]) {
                     const basePay = 500;
                     const bonusPercent = assignment.helperAdminId ? 0.08 : 0.15;
                     let bonus;
                     
                     if (birthdayRevenue > 0) {
                         const birthdayBonusRevenue = birthdayRevenue - hostessRevenue;
                         bonus = (birthdayBonusRevenue + otherServicesRevenue) * bonusPercent;
                     } else {
                         bonus = dayRevenue * bonusPercent;
                     }
                     
                     weeklyPayrollData[assignment.mainAdminId].previousWeekTotal += basePay + bonus;
                 }

                 // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–º–æ—â–Ω–∏–∫—É –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é
                 if (assignment.helperAdminId && weeklyPayrollData[assignment.helperAdminId] && assignment.helperHours) {
                     let actualHelperHours = 0;
                     dayBookings.forEach(booking => {
                         const isBirthdayService = 
                             (booking.selectedServices && Array.isArray(booking.selectedServices) && 
                              booking.selectedServices.includes('birthday')) || 
                             booking.serviceType === 'birthday';
                         
                         if (isBirthdayService) {
                             const duration = parseFloat(booking.duration) || 0;
                             actualHelperHours += duration;
                         }
                     });
                     
                     actualHelperHours = Math.round(actualHelperHours);
                     const hours = actualHelperHours > 0 ? actualHelperHours : parseInt(assignment.helperHours);
                     const basePay = hours * 150;
                     const bonusPercent = 0.07;
                     const bonusRevenue = birthdayRevenue - hostessRevenue;
                     const bonus = bonusRevenue * bonusPercent;
                     weeklyPayrollData[assignment.helperAdminId].previousWeekTotal += basePay + bonus;
            }
         });
         }

        renderWeeklyPayroll(weeklyPayrollData, currentWeek);
    }


    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
    function getNextMonday(date) {
        const nextMonday = new Date(date);
        nextMonday.setDate(nextMonday.getDate() + (8 - nextMonday.getDay()) % 7);
        return nextMonday;
    }

    // === –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ó–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ –¢–µ–∫—É—â—É—é –ù–µ–¥–µ–ª—é ===
    function renderWeeklyPayroll(payrollData, weekRange) {
        console.log('renderWeeklyPayroll called with data:', payrollData);
        console.log('weekRange:', weekRange);
        
        const today = new Date();
        const isMonday = today.getDay() === 1;
        const todayPayrollBlock = document.getElementById('todayPayrollBlock');
        const todayPayrollResults = document.getElementById('todayPayrollResults');
        const todayPayrollPeriod = document.getElementById('todayPayrollPeriod');
        weeklyPayrollResultsEl.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞

        if (!weekRange) {
             weeklyPayrollPeriodEl.textContent = '–†–∞—Å—á–µ—Ç –ø–µ—Ä–∏–æ–¥–∞...';
             weeklyPayrollResultsEl.innerHTML = '<p class="italic text-yellow-600">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
        return;
      }

        const nextMonday = getNextMonday(weekRange.end);
        const dateOptions = { 
            day: '2-digit', 
            month: 'long'
        };
        const weekOptions = { 
            day: '2-digit', 
            month: 'short' 
        };

        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –¥–∞—Ç–æ–π —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
        const weeklyPayrollTitleEl = document.getElementById('weeklyPayrollTitle');
        weeklyPayrollTitleEl.textContent = `–ö –≤—ã–ø–ª–∞—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, ${nextMonday.toLocaleDateString('ru-RU', dateOptions)} (–∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é):`;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–∏–æ–¥
        weeklyPayrollPeriodEl.textContent = `(—Å ${weekRange.start.toLocaleDateString('ru-RU', weekOptions)} –ø–æ ${weekRange.end.toLocaleDateString('ru-RU', weekOptions)})`;

        // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –≤—ã–ø–ª–∞—Ç–∞–º–∏ –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é
        if (isMonday) {
            const previousWeek = {
                start: new Date(weekRange.start),
                end: new Date(weekRange.start)
            };
            previousWeek.start.setDate(previousWeek.start.getDate() - 7);
            previousWeek.end.setDate(previousWeek.end.getDate() - 1);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –≤—ã–ø–ª–∞—Ç–∞–º–∏ –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é
            todayPayrollBlock.classList.remove('hidden');
            todayPayrollPeriod.textContent = `(—Å ${previousWeek.start.toLocaleDateString('ru-RU', weekOptions)} –ø–æ ${previousWeek.end.toLocaleDateString('ru-RU', weekOptions)})`;
            
            // –û—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é
            todayPayrollResults.innerHTML = '';
            let hasTodayData = false;

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ payrollData –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é
            admins.forEach(admin => {
                const data = payrollData[admin.id];
                if (!data || data.previousWeekTotal <= 0) return;

                hasTodayData = true;
                const adminBlock = document.createElement('div');
                adminBlock.className = 'mb-4';
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–º–µ–Ω–µ–º –∞–¥–º–∏–Ω–∞ –∏ –æ–±—â–µ–π —Å—É–º–º–æ–π –∑–∞ –Ω–µ–¥–µ–ª—é
                adminBlock.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium">${admin.name}:</span>
                        <span class="font-semibold text-green-800">${data.previousWeekTotal.toLocaleString('ru-RU')} ‚ÇΩ</span>
                    </div>
                `;
                
                todayPayrollResults.appendChild(adminBlock);
            });

            if (!hasTodayData) {
                todayPayrollResults.innerHTML = '<p class="italic text-green-600">–ù–µ—Ç –≤—ã–ø–ª–∞—Ç –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é</p>';
            }
        } else {
            todayPayrollBlock.classList.add('hidden');
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é
        let hasData = false;
        admins.forEach(admin => {
            const data = payrollData[admin.id];
            if (data && data.total > 0) {
                hasData = true;
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center';
                div.innerHTML = `
                    <span>${data.name}:</span>
                    <span class="font-semibold text-yellow-800">${data.total.toLocaleString('ru-RU', { maximumFractionDigits: 0 })} ‚ÇΩ</span>
                `;
                weeklyPayrollResultsEl.appendChild(div);
            }
        });

        if (!hasData) {
            weeklyPayrollResultsEl.innerHTML = '<p class="italic text-yellow-600">–ù–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é.</p>';
        }
    }

    // === –õ–æ–≥–∏–∫–∞ –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –û–∫–Ω–∞ –î–µ—Ç–∞–ª–µ–π –î–Ω—è ===
    function showDayDetailsModal(dayBookings, date) {
        const dateStr = date.toLocaleDateString('ru-RU', { day: '2-digit', month: 'long', year: 'numeric', weekday: 'long' });
        dayDetailsTitle.textContent = `–ó–∞–ø–∏—Å–∏ –Ω–∞ ${dateStr}`;
        dayDetailsContent.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

        if (dayBookings.length === 0) {
            dayDetailsContent.innerHTML = '<p class="text-center text-gray-500 italic">–ù–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π.</p>';
        } else {
            dayBookings.forEach(b => {
                const bookingCard = document.createElement('div');
                bookingCard.className = 'border border-gray-200 rounded-xl p-4 shadow-sm';

                // –§–æ—Ä–º–∏—Ä—É–µ–º –±–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∏–µ–Ω—Ç–µ
                let clientHTML = `<div class="font-semibold text-lg mb-1">${b.clientName}</div>`;
                if (b.clientPhone) {
                    let cleanPhone = b.clientPhone.replace(/\D/g, '');
                    if (cleanPhone.startsWith('7') || cleanPhone.startsWith('8')) {
                        cleanPhone = cleanPhone.substring(1);
                    }
                    const formattedPhone = formatPhoneNumber(b.clientPhone);
                    clientHTML += `<div class="text-sm mb-2"><a href="tel:+7${cleanPhone}" class="text-blue-600 hover:text-blue-800 hover:underline">${formattedPhone}</a></div>`;
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º –±–ª–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const timeHTML = `<div class="text-sm text-gray-700 mb-2"><span class="font-medium">–í—Ä–µ–º—è:</span> ${b.startTime} (${b.duration} —á)</div>`;

                // –§–æ—Ä–º–∏—Ä—É–µ–º –±–ª–æ–∫ —É—Å–ª—É–≥
                 let serviceLabels = '–ù–µ —É–∫–∞–∑–∞–Ω—ã';
                 if (b.selectedServices && Array.isArray(b.selectedServices) && b.selectedServices.length > 0) {
                     serviceLabels = b.selectedServices.map(serviceKey => getServiceLabel(serviceKey)).join(', ');
                 } else if (b.serviceType) { // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
                     serviceLabels = getServiceLabel(b.serviceType);
                 }
                const servicesHTML = `<div class="text-sm text-gray-700 mb-2"><span class="font-medium">–£—Å–ª—É–≥–∏:</span> ${serviceLabels}</div>`;

                // --- –î–æ–±–∞–≤–ª—è–µ–º –§–∏–Ω–∞–Ω—Å–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é ---
                let financialHTML = '';
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É –¥–æ —Å–∫–∏–¥–∫–∏
                let totalAmount = 0;
                const duration = parseFloat(b.duration) || 0;
                if (b.selectedServices && Array.isArray(b.selectedServices)) {
                     b.selectedServices.forEach(service => {
                       if (service === 'birthday') {
                         const fullHours = Math.floor(duration);
                         const hasHalfHour = duration % 1 !== 0;
                         let birthdayTotal = 0;
                         for (let hour = 1; hour <= fullHours; hour++) {
                           const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                           birthdayTotal += hourPrice;
                         }
                         if (hasHalfHour) {
                            if (fullHours === 0) { birthdayTotal += 2000; }
                            else if (fullHours === 1) { birthdayTotal += 2000; }
                            else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                         }
                         totalAmount += birthdayTotal;
                       } else if (service === 'hostess') {
                         // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                         totalAmount += servicePrices.hostess;
                       } else {
                         const price = servicePrices[service] || 0;
                         totalAmount += price * duration;
                       }
                     });
                }

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–∫–∏
                const discountPercent = b.discountPercent || 0;
                const discountAmount = b.discountAmount || 0;
                let finalAmount = totalAmount;
                let discountText = '–ù–µ—Ç';
                if (discountPercent > 0) {
                  finalAmount = totalAmount * (1 - discountPercent / 100);
                  discountText = `${discountPercent}%`;
                } else if (discountAmount > 0) {
                  finalAmount = Math.max(0, totalAmount - discountAmount);
                  discountText = `${discountAmount.toLocaleString('ru-RU')} ‚ÇΩ`;
                }

                financialHTML = `
                  <div class="grid grid-cols-3 gap-x-4 text-sm mt-3 pt-3 border-t border-gray-100">
                    <div><span class="font-medium">–°—É–º–º–∞:</span> ${totalAmount.toLocaleString('ru-RU')} ‚ÇΩ</div>
                    <div><span class="font-medium">–°–∫–∏–¥–∫–∞:</span> ${discountText}</div>
                    <div><span class="font-medium">–ò—Ç–æ–≥–æ–≤–∞—è:</span> ${finalAmount.toLocaleString('ru-RU', { maximumFractionDigits: 0 })} ‚ÇΩ</div>
                  </div>
                  <div class="text-xs text-gray-600 space-y-1 mt-1">
                    <div><span class="font-medium">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞:</span> ${b.prepayment && b.prepayment.amount ? `${b.prepayment.amount.toLocaleString('ru-RU')} ‚ÇΩ (${b.prepayment.method === 'cash' ? '–Ω–∞–ª' : '–ø–µ—Ä–µ–≤–æ–¥'})${b.prepayment.date ? ' –æ—Ç ' + new Date(b.prepayment.date).toLocaleDateString('ru-RU', {day: '2-digit', month: 'short'}) : ''}` : '-'}</div>
                    <div><span class="font-medium">–î–æ–ø–ª–∞—Ç–∞ –Ω–∞–ª:</span> ${b.finalPaymentCash && b.finalPaymentCash.amount ? `${b.finalPaymentCash.amount.toLocaleString('ru-RU')} ‚ÇΩ${b.finalPaymentCash.date ? ' –æ—Ç ' + new Date(b.finalPaymentCash.date).toLocaleDateString('ru-RU', {day: '2-digit', month: 'short'}) : ''}` : '-'}</div>
                    <div><span class="font-medium">–î–æ–ø–ª–∞—Ç–∞ –ø–µ—Ä:</span> ${b.finalPaymentTransfer && b.finalPaymentTransfer.amount ? `${b.finalPaymentTransfer.amount.toLocaleString('ru-RU')} ‚ÇΩ${b.finalPaymentTransfer.date ? ' –æ—Ç ' + new Date(b.finalPaymentTransfer.date).toLocaleDateString('ru-RU', {day: '2-digit', month: 'short'}) : ''}` : '-'}</div>
                  </div>
                `;
                // --- –ö–æ–Ω–µ—Ü –§–∏–Ω–∞–Ω—Å–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ ---

                // –§–æ—Ä–º–∏—Ä—É–µ–º –±–ª–æ–∫ –ø—Ä–∏–º–µ—á–∞–Ω–∏–π
                let notesHTML = '';
                if (b.notes) {
                    notesHTML = `<div class="text-sm text-gray-500 italic whitespace-pre-wrap break-words border-t border-gray-100 pt-2 mt-2"><span class="font-medium text-gray-700 not-italic">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</span> ${b.notes}</div>`;
                }

                // –ù–∞—Ö–æ–¥–∏–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –û–î–ò–ù –†–ê–ó
                const assignmentDateStr = formatDateSafe(date);
                const assignment = adminAssignments.find(a => a.date === assignmentDateStr);
                let assignmentHTML = '';
                if (assignment) {
                    const mainAdmin = admins.find(a => a.id === assignment.mainAdminId);
                    const helperAdmin = assignment.helperAdminId ? admins.find(a => a.id === assignment.helperAdminId) : null;
                    assignmentHTML = '<div class="text-xs text-gray-500 mt-1">–°–º–µ–Ω–∞: ';
                    if (mainAdmin) assignmentHTML += `üëë ${mainAdmin.name}`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å–ª—É–≥–∞ "–ê—Ä–µ–Ω–¥–æ–π –î–†" - —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∏—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–º–æ—â–Ω–∏–∫–∞
                    const isBirthdayService = 
                        (b.selectedServices && Array.isArray(b.selectedServices) && 
                         b.selectedServices.includes('birthday')) || 
                        b.serviceType === 'birthday';
                    
                    if (helperAdmin && isBirthdayService) {
                        assignmentHTML += ` / üõ†Ô∏è ${helperAdmin.name}${assignment.helperHours ? ' (' + assignment.helperHours + '—á)' : ''}`;
                    }
                    
                    assignmentHTML += '</div>';
                }

                // –°–æ–±–∏—Ä–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
                bookingCard.innerHTML = clientHTML + timeHTML + servicesHTML + financialHTML + assignmentHTML + notesHTML;

                // --- –î–æ–±–∞–≤–ª—è–µ–º –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) ---
                if (isAdmin) {
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'flex items-center space-x-3 mt-3 pt-3 border-t border-gray-100';

                    const editBtn = document.createElement('button');
                    editBtn.type = 'button';
                    editBtn.className = 'text-blue-600 hover:text-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-400 rounded p-1';
                    editBtn.innerHTML = '<i class="fa-solid fa-edit fa-fw mr-1"></i> –†–µ–¥–∞–∫—Ç.';
                    editBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        dayDetailsModal.classList.add('hidden'); // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –æ–∫–Ω–æ
                        openEditModal(b.id); // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                     });

                    const deleteBtn = document.createElement('button');
                    deleteBtn.type = 'button';
                    deleteBtn.className = 'text-red-600 hover:text-red-800 focus:outline-none focus:ring-2 focus:ring-red-400 rounded p-1';
                    deleteBtn.innerHTML = '<i class="fa-solid fa-trash-alt fa-fw mr-1"></i> –£–¥–∞–ª–∏—Ç—å';
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –¥–ª—è "${b.clientName}"?`)) {
                            dayDetailsModal.classList.add('hidden'); // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –æ–∫–Ω–æ
                            deleteBooking(b.id);
                        }
                    });

                    actionsDiv.appendChild(editBtn);
                    actionsDiv.appendChild(deleteBtn);
                    bookingCard.appendChild(actionsDiv);
                }
                // --- –ö–æ–Ω–µ—Ü –ö–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π ---

                dayDetailsContent.appendChild(bookingCard);
            });
        }

        dayDetailsModal.classList.remove('hidden');
    }

    // === –õ–æ–≥–∏–∫–∞ –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –û–∫–Ω–∞ –î–µ—Ç–∞–ª–µ–π –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ ===
    function showAdminDayDetailsModal(date, dateStr, assignment) {
      const formattedDate = date.toLocaleDateString('ru-RU', { day: '2-digit', month: 'long', year: 'numeric', weekday: 'long' });
      adminDayDetailsTitle.textContent = `–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–º–µ–Ω–µ –Ω–∞ ${formattedDate}`;
      adminDayDetailsContent.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

      // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞—Ö
      const mainAdmin = assignment.mainAdminId ? admins.find(a => a.id === assignment.mainAdminId) : null;
      const helperAdmin = assignment.helperAdminId ? admins.find(a => a.id === assignment.helperAdminId) : null;

      // –ü–æ–ª—É—á–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã
      const dayBookings = bookings.filter(b => b.bookingDate === dateStr)
                                .sort((a, b) => a.startTime.localeCompare(b.startTime));

      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Ä—É—á–∫—É –¥–Ω—è
      let dayRevenue = 0;
      let birthdayRevenue = 0;
      let hostessRevenue = 0;
      let otherServicesRevenue = 0;

      dayBookings.forEach(booking => {
        let bookingTotalAmount = 0;
        const duration = parseFloat(booking.duration) || 0;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–ø–∏—Å—å —É—Å–ª—É–≥–æ–π "–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è"
        const isBirthdayService = 
          (booking.selectedServices && Array.isArray(booking.selectedServices) && 
           booking.selectedServices.includes('birthday')) || 
          booking.serviceType === 'birthday';
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –µ—Å—Ç—å –ª–∏ —É—Å–ª—É–≥–∞ –≤–µ–¥—É—â–µ–π
        const hasHostess = 
          booking.selectedServices && Array.isArray(booking.selectedServices) && 
          booking.selectedServices.includes('hostess');
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É –¥–æ —Å–∫–∏–¥–∫–∏
        if (booking.selectedServices && Array.isArray(booking.selectedServices)) {
          booking.selectedServices.forEach(service => {
            if (service === 'birthday') {
              const fullHours = Math.floor(duration);
              const hasHalfHour = duration % 1 !== 0;
              let birthdayTotal = 0;
              for (let hour = 1; hour <= fullHours; hour++) {
                const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                birthdayTotal += hourPrice;
              }
              if (hasHalfHour) {
                if (fullHours === 0) { birthdayTotal += 2000; }
                else if (fullHours === 1) { birthdayTotal += 2000; }
                else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
              }
              bookingTotalAmount += birthdayTotal;
            } else if (service === 'hostess') {
              // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
              bookingTotalAmount += servicePrices.hostess;
              hostessRevenue += servicePrices.hostess;
            } else {
              const price = servicePrices[service] || 0;
              bookingTotalAmount += price * duration;
            }
          });
        } else if (booking.serviceType) {
          if (booking.serviceType === 'birthday') {
            const hours = Math.min(Math.max(Math.ceil(duration), 1), 12);
            bookingTotalAmount = servicePrices.birthday[hours] || servicePrices.birthday[4];
          } else if (duration === 0.5 && servicePriceHalfHour[booking.serviceType]) {
            bookingTotalAmount = servicePriceHalfHour[booking.serviceType] || 0;
          } else {
            const pricePerHour = servicePrices[booking.serviceType] || 0;
            bookingTotalAmount = pricePerHour * duration;
          }
        }
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É
        const discountPercent = booking.discountPercent || 0;
        const discountAmount = booking.discountAmount || 0;
        let finalBookingAmount = bookingTotalAmount;
        
        if (discountPercent > 0) {
          finalBookingAmount = bookingTotalAmount * (1 - discountPercent / 100);
        } else if (discountAmount > 0) {
          finalBookingAmount = Math.max(0, bookingTotalAmount - discountAmount);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—â—É—é –≤—ã—Ä—É—á–∫—É
        dayRevenue += finalBookingAmount;
        
        // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã—Ä—É—á–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        if (isBirthdayService) {
          birthdayRevenue += finalBookingAmount;
        } else {
          otherServicesRevenue += finalBookingAmount;
        }
      });

      // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞—Ö
      const adminInfoCard = document.createElement('div');
      adminInfoCard.className = 'bg-white rounded-xl p-5 border border-gray-200 shadow-sm';
      
      let adminInfoHTML = '<div class="space-y-4">';
      
      // –û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      if (mainAdmin) {
        adminInfoHTML += `
          <div>
            <h4 class="font-semibold text-lg text-blue-800 mb-2">üëë –û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h4>
            <p class="text-lg font-medium">${mainAdmin.name}</p>
            <div class="mt-2 space-y-1">
              <div class="flex justify-between">
                <span>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞:</span>
                <span class="font-medium">500 ‚ÇΩ</span>
              </div>
        `;
        
        // –†–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        const bonusPercent = helperAdmin ? 8 : 15;
        let bonusRevenue;
        let bonusDescription;
        
        if (birthdayRevenue > 0) {
          // –ï—Å–ª–∏ –±—ã–ª –î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º –±–æ–Ω—É—Å –æ—Ç (–≤—ã—Ä—É—á–∫–∏ –î–† –º–∏–Ω—É—Å –≤–µ–¥—É—â–∞—è) + –≤—ã—Ä—É—á–∫–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö —É—Å–ª—É–≥
          const birthdayBonusRevenue = birthdayRevenue - hostessRevenue;
          const bonus = ((birthdayBonusRevenue + otherServicesRevenue) * bonusPercent / 100).toFixed(0);
          const totalSalary = (500 + parseFloat(bonus)).toFixed(0);
          
          adminInfoHTML += `
              <div class="flex justify-between">
                <span>–ë–æ–Ω—É—Å (${bonusPercent}% –æ—Ç –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏):</span>
                <span class="font-medium">${parseInt(bonus).toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              <div class="flex justify-between text-xs text-gray-600">
                <span>–í—ã—Ä—É—á–∫–∞ –∑–∞ –î–†:</span>
                <span>${birthdayRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              ${hostessRevenue > 0 ? `
              <div class="flex justify-between text-xs text-gray-600">
                <span>–°—Ç–æ–∏–º–æ—Å—Ç—å –≤–µ–¥—É—â–µ–π:</span>
                <span>-${hostessRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              ` : ''}
              <div class="flex justify-between text-xs text-gray-600">
                <span>–í—ã—Ä—É—á–∫–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö —É—Å–ª—É–≥:</span>
                <span>${otherServicesRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              <div class="flex justify-between text-xs text-gray-600">
                <span>–í—ã—Ä—É—á–∫–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –±–æ–Ω—É—Å–∞:</span>
                <span>${(birthdayBonusRevenue + otherServicesRevenue).toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              <div class="flex justify-between border-t border-gray-200 pt-1 mt-1">
                <span class="font-medium">–ò—Ç–æ–≥–æ –∑–∞ –¥–µ–Ω—å:</span>
                <span class="font-semibold text-blue-700">${parseInt(totalSalary).toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
            </div>
          </div>
          `;
        } else {
          // –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –î–Ω—è –†–æ–∂–¥–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º –±–æ–Ω—É—Å –æ—Ç –≤—Å–µ–π –≤—ã—Ä—É—á–∫–∏ –∑–∞ –¥–µ–Ω—å
        const bonus = (dayRevenue * bonusPercent / 100).toFixed(0);
        const totalSalary = (500 + parseFloat(bonus)).toFixed(0);
        
        adminInfoHTML += `
              <div class="flex justify-between">
                <span>–ë–æ–Ω—É—Å (${bonusPercent}% –æ—Ç –≤—ã—Ä—É—á–∫–∏):</span>
                <span class="font-medium">${parseInt(bonus).toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              <div class="flex justify-between text-xs text-gray-600">
                <span>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å:</span>
                <span>${dayRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              <div class="flex justify-between border-t border-gray-200 pt-1 mt-1">
                <span class="font-medium">–ò—Ç–æ–≥–æ –∑–∞ –¥–µ–Ω—å:</span>
                <span class="font-semibold text-blue-700">${parseInt(totalSalary).toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
            </div>
          </div>
        `;
        }
      } else {
        adminInfoHTML += `
          <div>
            <h4 class="font-semibold text-lg text-red-500 mb-2">‚ùó –û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</h4>
          </div>
        `;
      }
      
      // –ü–æ–º–æ—â–Ω–∏–∫
      if (helperAdmin && assignment.helperHours) {
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –ø–æ–º–æ—â–Ω–∏–∫–∞ –ø–æ –∑–∞–ø–∏—Å—è–º –ê—Ä–µ–Ω–¥—ã –î–†
        let actualHelperHours = 0;
        dayBookings.forEach(booking => {
          const isBirthdayService = 
            (booking.selectedServices && Array.isArray(booking.selectedServices) && 
             booking.selectedServices.includes('birthday')) || 
            booking.serviceType === 'birthday';
          
          if (isBirthdayService) {
            const duration = parseFloat(booking.duration) || 0;
            actualHelperHours += duration;
          }
        });
        actualHelperHours = Math.round(actualHelperHours);
        
        const assignedHours = parseInt(assignment.helperHours) || 0;
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã
        const hours = actualHelperHours > 0 ? actualHelperHours : assignedHours;
        const basePay = hours * 150;
        const bonusPercent = 7;
        // –í—ã—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–µ–¥—É—â–µ–π –∏–∑ –≤—ã—Ä—É—á–∫–∏ –î–† –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –±–æ–Ω—É—Å–∞
        const bonusRevenue = birthdayRevenue - hostessRevenue;
        const bonus = (bonusRevenue * bonusPercent / 100).toFixed(0);
        const totalHelperSalary = (basePay + parseFloat(bonus)).toFixed(0);
        
        let hoursWarning = '';
        if (actualHelperHours > 0 && actualHelperHours !== assignedHours) {
          hoursWarning = `<div class="text-xs p-1 bg-yellow-100 rounded text-yellow-800 mt-1 mb-2">
            –í–Ω–∏–º–∞–Ω–∏–µ: –Ω–∞–∑–Ω–∞—á–µ–Ω–æ ${assignedHours} —á, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ ${actualHelperHours} —á –ø–æ –∑–∞–ø–∏—Å—è–º –î–†
          </div>`;
        }
        
        adminInfoHTML += `
          <div class="border-t border-gray-200 pt-4 mt-2">
            <h4 class="font-semibold text-lg text-indigo-800 mb-2">üõ†Ô∏è –ü–æ–º–æ—â–Ω–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h4>
            <p class="text-lg font-medium">${helperAdmin.name} (${hours} —á)</p>
            ${hoursWarning}
            <div class="mt-2 space-y-1">
              <div class="flex justify-between">
                <span>–ü–æ—á–∞—Å–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞ (150 ‚ÇΩ/—á):</span>
                <span class="font-medium">${basePay.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              <div class="flex justify-between">
                <span>–ë–æ–Ω—É—Å (7% –æ—Ç –≤—ã—Ä—É—á–∫–∏ –î–† –º–∏–Ω—É—Å –≤–µ–¥—É—â–∞—è):</span>
                <span class="font-medium">${parseInt(bonus).toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              <div class="flex justify-between text-xs text-gray-600">
                <span>–í—ã—Ä—É—á–∫–∞ –∑–∞ –î–†:</span>
                <span>${birthdayRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              ${hostessRevenue > 0 ? `
              <div class="flex justify-between text-xs text-gray-600">
                <span>–°—Ç–æ–∏–º–æ—Å—Ç—å –≤–µ–¥—É—â–µ–π:</span>
                <span>-${hostessRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              <div class="flex justify-between text-xs text-gray-600">
                <span>–í—ã—Ä—É—á–∫–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –±–æ–Ω—É—Å–∞:</span>
                <span>${bonusRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
              ` : ''}
              <div class="flex justify-between border-t border-gray-200 pt-1 mt-1">
                <span class="font-medium">–ò—Ç–æ–≥–æ –∑–∞ –¥–µ–Ω—å:</span>
                <span class="font-semibold text-indigo-700">${totalHelperSalary.toLocaleString('ru-RU')} ‚ÇΩ</span>
              </div>
            </div>
          </div>
        `;
      }
      
      adminInfoHTML += '</div>';
      adminInfoCard.innerHTML = adminInfoHTML;
      
      // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–ø–∏—Å—è—Ö
      const bookingsCard = document.createElement('div');
      bookingsCard.className = 'bg-white rounded-xl p-5 border border-gray-200 shadow-sm mt-4';
      
      let bookingsHTML = '<h4 class="font-semibold text-lg text-gray-800 mb-3">–ó–∞–ø–∏—Å–∏ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å</h4>';
      
      if (dayBookings.length > 0) {
        bookingsHTML += '<div class="space-y-3">';
        
        dayBookings.forEach(booking => {
          const services = booking.selectedServices && Array.isArray(booking.selectedServices) && booking.selectedServices.length > 0 
            ? booking.selectedServices.map(s => getServiceLabel(s)).join(', ') 
            : getServiceLabel(booking.serviceType);
            
          const discountPercent = booking.discountPercent || 0;
          const discountAmount = booking.discountAmount || 0;
          let finalAmount = 0;
          
          // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
          if (booking.selectedServices && Array.isArray(booking.selectedServices)) {
            const duration = parseFloat(booking.duration) || 0;
            let total = 0;
            
            booking.selectedServices.forEach(service => {
              if (service === 'birthday') {
                const fullHours = Math.floor(duration);
                const hasHalfHour = duration % 1 !== 0;
                let birthdayTotal = 0;
                for (let hour = 1; hour <= fullHours; hour++) {
                  const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
                  birthdayTotal += hourPrice;
                }
                if (hasHalfHour) {
                  if (fullHours === 0) { birthdayTotal += 2000; }
                  else if (fullHours === 1) { birthdayTotal += 2000; }
                  else { birthdayTotal += (servicePrices.birthday[3] || 3000) / 2; }
                }
                total += birthdayTotal;
              } else if (service === 'hostess') {
                // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ "–í–µ–¥—É—â–∞—è" –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                total += servicePrices.hostess;
              } else {
                const price = servicePrices[service] || 0;
                total += price * duration;
              }
            });
            
            if (discountPercent > 0) {
              finalAmount = total * (1 - discountPercent / 100);
            } else if (discountAmount > 0) {
              finalAmount = Math.max(0, total - discountAmount);
            } else {
              finalAmount = total;
            }
          }
          
          const isBirthdayService = 
            (booking.selectedServices && Array.isArray(booking.selectedServices) && 
            booking.selectedServices.includes('birthday')) || 
            booking.serviceType === 'birthday';
            
          // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∑–∞–ø–∏—Å–∏
          bookingsHTML += `
            <div class="p-3 ${isBirthdayService ? 'bg-pink-50 border-pink-200' : 'bg-gray-50 border-gray-200'} border rounded-lg">
              <div class="flex justify-between mb-1">
                <span class="font-medium">${booking.clientName}</span>
                <span>${booking.startTime} (${booking.duration}—á)</span>
              </div>
              <div class="text-sm text-gray-700">
                <div>–£—Å–ª—É–≥–∏: ${services}</div>
                <div>–°—É–º–º–∞: ${finalAmount.toLocaleString('ru-RU')} ‚ÇΩ</div>
              </div>
            </div>
          `;
        });
        
        bookingsHTML += '</div>';
      } else {
        bookingsHTML += '<p class="text-gray-500 italic">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å</p>';
      }
      
      bookingsCard.innerHTML = bookingsHTML;
      
      // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
      const financeCard = document.createElement('div');
      financeCard.className = 'bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-5 border border-green-200 shadow-sm mt-4';
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –ø–æ–º–æ—â–Ω–∏–∫–∞ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å–≤–æ–¥–∫–∏
      let actualHelperHours = 0;
      if (helperAdmin) {
        dayBookings.forEach(booking => {
          const isBirthdayService = 
            (booking.selectedServices && Array.isArray(booking.selectedServices) && 
            booking.selectedServices.includes('birthday')) || 
            booking.serviceType === 'birthday';
          
          if (isBirthdayService) {
            actualHelperHours += parseFloat(booking.duration) || 0;
          }
        });
        actualHelperHours = Math.round(actualHelperHours);
      }
      
      const financeHTML = `
        <h4 class="font-semibold text-lg text-green-800 mb-3">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞</h4>
        <div class="space-y-2">
          <div class="flex justify-between">
            <span>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å:</span>
            <span class="font-semibold text-green-700">${dayRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
          </div>
          <div class="flex justify-between">
            <span>–í—ã—Ä—É—á–∫–∞ –∑–∞ "–ê—Ä–µ–Ω–¥—É –î–†":</span>
            <span class="font-semibold text-green-700">${birthdayRevenue.toLocaleString('ru-RU')} ‚ÇΩ</span>
          </div>
          <div class="flex justify-between">
            <span>–ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π:</span>
            <span class="font-semibold">${dayBookings.length}</span>
          </div>
          <div class="flex justify-between border-t border-green-200 pt-2 mt-1">
            <span class="font-medium">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞:</span>
            <span class="font-bold text-green-800 text-lg">
              ${(
                // –ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ: —Å—Ç–∞–≤–∫–∞ + –±–æ–Ω—É—Å
                (mainAdmin ? 500 + (
                  // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º –æ—Ç (–≤—ã—Ä—É—á–∫–∞ –î–† - –≤–µ–¥—É—â–∞—è + –¥—Ä—É–≥–∏–µ —É—Å–ª—É–≥–∏)
                  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è, —Å—á–∏—Ç–∞–µ–º –æ—Ç –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏
                  (birthdayRevenue > 0 ? 
                    ((birthdayRevenue - (hostessRevenue || 0) + (otherServicesRevenue || 0)) * (helperAdmin ? 0.08 : 0.15)) :
                    (dayRevenue * (helperAdmin ? 0.08 : 0.15))
                  )
                ) : 0) +
                // –ó–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞: –ø–æ—á–∞—Å–æ–≤–∞—è + –±–æ–Ω—É—Å –æ—Ç –î–†
                (helperAdmin && actualHelperHours > 0 ? 
                  (actualHelperHours * 150) + ((birthdayRevenue - (hostessRevenue || 0)) * 0.07) : 0)
              ).toFixed(0).toLocaleString('ru-RU')} ‚ÇΩ
            </span>
          </div>
        </div>
      `;
      
      financeCard.innerHTML = financeHTML;
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π
      const actionButtons = document.createElement('div');
      actionButtons.className = 'flex space-x-4 mt-5';
      
      // –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
      const editAssignmentBtn = document.createElement('button');
      editAssignmentBtn.type = 'button';
      editAssignmentBtn.className = 'flex-1 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white py-3 rounded-xl font-medium transition focus:ring-2 focus:ring-blue-300 focus:outline-none';
      editAssignmentBtn.innerHTML = '<i class="fa-solid fa-edit mr-2"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ';
      editAssignmentBtn.addEventListener('click', () => {
        adminDayDetailsModal.classList.add('hidden'); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π
        openAssignModal(date, dateStr); // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
      });
      
      // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
      const addBookingBtn = document.createElement('button');
      addBookingBtn.type = 'button';
      addBookingBtn.className = 'flex-1 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white py-3 rounded-xl font-medium transition focus:ring-2 focus:ring-green-300 focus:outline-none';
      addBookingBtn.innerHTML = '<i class="fa-solid fa-plus mr-2"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å';
      addBookingBtn.addEventListener('click', () => {
        adminDayDetailsModal.classList.add('hidden'); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π
        openBookingModal(date); // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
      });
      
      actionButtons.appendChild(editAssignmentBtn);
      actionButtons.appendChild(addBookingBtn);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      adminDayDetailsContent.appendChild(adminInfoCard);
      adminDayDetailsContent.appendChild(bookingsCard);
      adminDayDetailsContent.appendChild(financeCard);
      adminDayDetailsContent.appendChild(actionButtons);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      adminDayDetailsModal.classList.remove('hidden');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
      document.getElementById('closeAdminDayDetailsModal').onclick = function() {
        adminDayDetailsModal.classList.add('hidden');
      };
    }

    // === –õ–æ–≥–∏–∫–∞ –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –û–∫–Ω–∞ –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –ê–¥–º–∏–Ω–∞ ===
    // ... existing code ...

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞
    helperAdminSelect.addEventListener('change', function() {
      const helperAdminId = this.value;
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ —á–∞—Å–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞
      toggleHelperHours(helperAdminId !== "");

      // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø–æ–º–æ—â–Ω–∏–∫, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–∞—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø–∏—Å–µ–π "–ê—Ä–µ–Ω–¥–∞ –î–†"
      if (helperAdminId) {
        const dateStr = assignDateInput.value;
        const dayBookings = bookings.filter(b => b.bookingDate === dateStr);
        const birthdayRentalHours = calculateBirthdayRentalHours(dayBookings);

        if (birthdayRentalHours > 0) {
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —á–∞—Å—ã –ø–æ–º–æ—â–Ω–∏–∫–∞
          helperHoursInput.value = birthdayRentalHours;
        } else {
          // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π "–ê—Ä–µ–Ω–¥–∞ –î–†", –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          alert('–í–Ω–∏–º–∞–Ω–∏–µ! –ù–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π "–ê—Ä–µ–Ω–¥–∞ (–î–†)".\n–ü–æ–º–æ—â–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –Ω–∞–∑–Ω–∞—á–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Å–ª—É–≥–∏ "–ê—Ä–µ–Ω–¥–∞ (–î–†)".');
          helperHoursInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ —á–∞—Å–æ–≤
        }
      }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –î–Ω—è –†–æ–∂–¥–µ–Ω–∏—è
    birthdayBookingSelect.addEventListener('change', function() {
      const selectedOption = this.options[this.selectedIndex];
      
      if (this.value && selectedOption) {
        // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –î–†
        const duration = parseFloat(selectedOption.dataset.duration) || 0;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —á–∞—Å–∞—Ö
        maxHelperHoursSpan.textContent = duration;
        maxHelperHoursNote.classList.remove('hidden');
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —á–∞—Å–æ–≤
        helperHoursInput.max = duration;
        
        // –ï—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º
        if (parseFloat(helperHoursInput.value) > duration) {
          helperHoursInput.value = duration;
        }
      } else {
        maxHelperHoursNote.classList.add('hidden');
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
    document.addEventListener('DOMContentLoaded', function() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ VK API –∑–∞–≥—Ä—É–∂–µ–Ω
      if (typeof VK !== 'undefined' && VK.Widgets) {
        VK.Widgets.Group("vk_groups", {
          mode: 4, 
          wide: 1, 
          height: 600, 
          color1: "FFFFFF", 
          color2: "363636", 
          color3: "b457a6"
        }, 227237589);
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
      const shareModal = document.getElementById('shareModal');
      if (shareModal) {
        console.log('Share modal found and ready');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
        const closeShareModalBtn = document.getElementById('closeShareModal');
        if (closeShareModalBtn) {
          closeShareModalBtn.addEventListener('click', function() {
            window.closeShareModal();
          });
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        shareModal.addEventListener('click', function(event) {
          if (event.target === shareModal) {
            window.closeShareModal();
          }
        });
        
              } else {
          console.error('Share modal not found!');
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è
        const shareButtons = document.querySelectorAll('.share-button');
        console.log('Found share buttons:', shareButtons.length);
        shareButtons.forEach((btn, index) => {
          console.log(`Share button ${index}:`, btn, 'Visible:', btn.offsetWidth > 0 && btn.offsetHeight > 0);
        });
    });

    
    // === –£—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) ===
let expenses = [];
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é unsubscribeExpenses, –æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é –≤—ã—à–µ

function showExpensesSection() {
  try {
    const sections = document.querySelectorAll('section');
    const expensesSection = document.getElementById('expensesSection');
    
    if (!expensesSection) {
      console.error('–°–µ–∫—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
      return;
    }
    
    sections.forEach(section => section.classList.add('hidden'));
    expensesSection.classList.remove('hidden');
    window.setupExpensesListener(); // –í–º–µ—Å—Ç–æ loadExpenses –≤—ã–∑—ã–≤–∞–µ–º setupExpensesListener
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å–µ–∫—Ü–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤:', error);
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª—É—à–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤
function setupExpensesListener() {
  try {
    console.log('setupExpensesListener –≤—ã–∑–≤–∞–Ω–∞');
    // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    if (unsubscribeExpenses) {
      unsubscribeExpenses();
      unsubscribeExpenses = null;
    }

    const expensesCollection = collection(db, 'expenses');
    const categoryFilter = document.getElementById('categoryFilter');
    
    let q = query(expensesCollection, orderBy('date', 'desc'));
    if (categoryFilter && categoryFilter.value) {
      q = query(expensesCollection, 
        where('category', '==', categoryFilter.value), 
        orderBy('date', 'desc')
      );
    }
    
    console.log('–°–æ–∑–¥–∞–Ω –∑–∞–ø—Ä–æ—Å –∫ Firestore –¥–ª—è expenses');
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å
    unsubscribeExpenses = onSnapshot(q, (snapshot) => {
      console.log('onSnapshot —Å—Ä–∞–±–æ—Ç–∞–ª, –ø–æ–ª—É—á–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:', snapshot.docs.length);
      expenses = snapshot.docs.map(doc => ({ 
        id: doc.id, 
        ...doc.data(),
        date: doc.data().date instanceof Date ? doc.data().date : new Date(doc.data().date)
      }));
      
      console.log('–ú–∞—Å—Å–∏–≤ expenses –æ–±–Ω–æ–≤–ª–µ–Ω:', expenses);
      renderExpenses();
      updateStatistics();
    }, (error) => {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤:', error);
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–ª—É—à–∞—Ç–µ–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤:', error);
  }
}
window.setupExpensesListener = setupExpensesListener;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤
function initExpensesHandlers() {
  const categoryFilter = document.getElementById('categoryFilter');
  const addExpenseBtn = document.getElementById('addExpenseBtn');
  
  if (categoryFilter) {
    categoryFilter.addEventListener('change', setupExpensesListener);
  }
  
  if (addExpenseBtn) {
    addExpenseBtn.addEventListener('click', () => {
      const modal = document.getElementById('addExpenseModal');
      const dateInput = document.querySelector('#addExpenseForm [name="date"]');
      
      if (modal && dateInput) {
        modal.classList.remove('hidden');
        document.getElementById('addExpenseForm').reset();
        dateInput.valueAsDate = new Date();
      }
    });
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
  initExpensesHandlers();
});

function renderExpenses() {
  console.log('renderExpenses –≤—ã–∑–≤–∞–Ω–∞, expenses:', expenses);
  const expensesList = document.getElementById('expensesList');
  if (!expensesList) {
    console.error('–≠–ª–µ–º–µ–Ω—Ç expensesList –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM!');
    return;
  }
  
  console.log('–û—á–∏—â–∞–µ–º expensesList');
  expensesList.innerHTML = '';
  
  const categoryColors = {
    utilities: 'bg-blue-100 text-blue-800',
    consumables: 'bg-green-100 text-green-800',
    equipment: 'bg-purple-100 text-purple-800',
    food: 'bg-yellow-100 text-yellow-800',
    other: 'bg-gray-100 text-gray-800'
  };
  
  const categoryNames = {
    utilities: '–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',
    consumables: '–†–∞—Å—Ö–æ–¥–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã',
    equipment: '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ',
    food: '–ü—Ä–æ–¥—É–∫—Ç—ã',
    other: '–ü—Ä–æ—á–µ–µ'
  };
  
  console.log('–ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ–±–æ—Ä expenses –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫:', expenses.length);
  expenses.forEach(expense => {
    console.log('–°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è —Ä–∞—Å—Ö–æ–¥–∞:', expense);
    const card = document.createElement('div');
    card.className = 'expense-card bg-white border rounded-lg p-4 flex justify-between items-center mb-3 hover:shadow-md transition-shadow';
    
    const date = expense.date instanceof Date ? expense.date : new Date(expense.date);
    
    card.innerHTML = `
      <div class="flex-1">
        <div class="flex items-center mb-2">
          <span class="category-badge ${categoryColors[expense.category] || 'bg-gray-100 text-gray-800'} px-2 py-1 rounded-full text-sm font-medium">
            ${categoryNames[expense.category] || expense.category}
          </span>
          <span class="text-gray-500 text-sm ml-2">${date.toLocaleDateString('ru-RU')}</span>
        </div>
        <p class="text-gray-800">${expense.description}</p>
      </div>
      <div class="flex items-center">
        <span class="text-lg font-semibold mr-4">${expense.amount.toLocaleString('ru-RU')} ‚ÇΩ</span>
        <button
          data-id="${expense.id}"
          class="delete-expense-btn text-red-600 hover:text-red-800 transition-colors p-2 rounded-full hover:bg-red-50"
        >
          <i class="fa-solid fa-trash"></i>
        </button>
      </div>
    `;
    expensesList.appendChild(card);
    console.log('–ö–∞—Ä—Ç–æ—á–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ DOM');
  });
  console.log('–í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω—ã');
}

function updateStatistics() {
  try {
    const monthlyExpensesEl = document.getElementById('monthlyExpenses');
    const totalExpensesEl = document.getElementById('totalExpenses');
    
    if (!monthlyExpensesEl || !totalExpensesEl) return;
    
    const now = new Date();
    const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
    
    const monthlyExpenses = expenses
      .filter(e => e.date >= firstDayOfMonth)
      .reduce((sum, e) => sum + e.amount, 0);
    
    monthlyExpensesEl.textContent = `${monthlyExpenses.toLocaleString('ru-RU')} ‚ÇΩ`;
    totalExpensesEl.textContent = expenses.length.toString();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
  }
}

window.deleteExpense = async function(id) {
  try {
    if (!id) throw new Error('ID —Ä–∞—Å—Ö–æ–¥–∞ –Ω–µ —É–∫–∞–∑–∞–Ω');
    
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞—Å—Ö–æ–¥?')) {
      await deleteDoc(doc(db, 'expenses', id));
      window.setupExpensesListener(); // –í–º–µ—Å—Ç–æ loadExpenses –≤—ã–∑—ã–≤–∞–µ–º setupExpensesListener
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞:', error);
    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
  }
}

// –î–æ–±–∞–≤–ª—è–µ–º –ø—É–Ω–∫—Ç –º–µ–Ω—é "–†–∞—Å—Ö–æ–¥—ã" —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
function addExpensesNavLink() {
  try {
    const navLinks = document.querySelector('.nav-links');
    if (!navLinks || document.getElementById('expensesNavLink')) return;
    
    const expensesLink = document.createElement('a');
    expensesLink.href = '#';
    expensesLink.id = 'expensesNavLink';
    expensesLink.className = 'nav-link';
    expensesLink.innerHTML = '<i class="fa-solid fa-receipt mr-2"></i>–†–∞—Å—Ö–æ–¥—ã';
    expensesLink.onclick = showExpensesSection;
    navLinks.appendChild(expensesLink);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–∞—Å—Ö–æ–¥—ã:', error);
  }
}

// === –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ===
window.showBookingsSection = function() {
  document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
  document.querySelector('section:first-of-type').classList.remove('hidden');
  document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
  document.querySelector('.nav-link[onclick*="showBookingsSection"]').classList.add('active');
  return false;
}

window.showAdminScheduleSection = function() {
  document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
  document.getElementById('adminScheduleSection').classList.remove('hidden');
  document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
  document.querySelector('.nav-link[onclick*="showAdminScheduleSection"]').classList.add('active');
  return false;
}

window.showSalarySection = function() {
  document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
  document.getElementById('salarySection').classList.remove('hidden');
  document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
  document.querySelector('.nav-link[onclick*="showSalarySection"]').classList.add('active');
  return false;
}

window.showExpensesSection = function() {
  document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
  document.getElementById('expensesSection').classList.remove('hidden');
  document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
  const expensesLink = document.getElementById('expensesNavLink');
  if (expensesLink) {
    expensesLink.classList.add('active');
  }
  window.setupExpensesListener();
  return false;
}

window.showServicesSection = function() {
  document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
  document.getElementById('servicesSection').classList.remove('hidden');
  document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
  document.querySelector('.nav-link[onclick*="showServicesSection"]').classList.add('active');
  return false;
}

window.showWidgetsSection = function() {
  document.querySelectorAll('section').forEach(section => section.classList.add('hidden'));
  document.getElementById('widgetsSection').classList.remove('hidden');
  document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
  document.querySelector('.nav-link[onclick*="showWidgetsSection"]').classList.add('active');
  initWidgets();
  return false;
}

// === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤ ===
function initWidgets() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
  if (typeof VK !== 'undefined' && VK.Widgets) {
    VK.Widgets.Group("vk_groups", {
      mode: 4,
      wide: 1,
      height: 600,
      color1: "FFFFFF",
      color2: "363636",
      color3: "b457a6"
    }, 227237589);
  }
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–ø–∫–æ–π –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
let lastScrollTop = 0;
window.addEventListener('scroll', () => {
  const header = document.getElementById('mainHeader');
  const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
  
  if (window.innerWidth <= 768) { // –¢–æ–ª—å–∫–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    if (currentScroll > lastScrollTop && currentScroll > 50) {
      // –°–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
      header.classList.add('header-scrolled');
    } else {
      // –°–∫—Ä–æ–ª–ª –≤–≤–µ—Ä—Ö
      header.classList.remove('header-scrolled');
    }
    lastScrollTop = currentScroll;
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
onAuthStateChanged(auth, async (user) => {
  if (user && user.email) {
    try {
      isAdmin = true;
      
      document.getElementById('logoutBtn').classList.remove('hidden');
      document.getElementById('loginBtn').classList.add('hidden');
      
      const expensesLink = document.getElementById('expensesNavLink');
      if (expensesLink) {
        expensesLink.style.display = '';
        expensesLink.classList.remove('disabled');
      }
      
      document.getElementById('adminScheduleSection').classList.remove('hidden');
      document.getElementById('salarySection').classList.remove('hidden');
      document.getElementById('expensesSection').classList.remove('hidden');
      
      initExpensesHandlers();
      window.setupExpensesListener(); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
    }
  } else {
    isAdmin = false;
    if (unsubscribeExpenses) { // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç —Å–ª—É—à–∞—Ç–µ–ª—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
      unsubscribeExpenses();
      unsubscribeExpenses = null;
    }
    document.getElementById('logoutBtn').classList.add('hidden');
    document.getElementById('loginBtn').classList.remove('hidden');
    
    // –°–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–∞—Å—Ö–æ–¥—ã –∏ —Å–µ–∫—Ü–∏—é —Ä–∞—Å—Ö–æ–¥–æ–≤
    const expensesLink = document.getElementById('expensesNavLink');
    if (expensesLink) {
      expensesLink.style.display = 'none';
      expensesLink.classList.add('disabled');
    }
    document.getElementById('expensesSection').classList.add('hidden');
    
    // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏
    document.getElementById('adminScheduleSection').classList.add('hidden');
    document.getElementById('salarySection').classList.add('hidden');
  }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
  showBookingsSection();
});

  </script>
</body>
</html>
