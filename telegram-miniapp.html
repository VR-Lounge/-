<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>VR Lounge - –ó–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ Telegram</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      background: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
    }
    
    .service-tag {
      border: 2px solid #e5e7eb;
      border-radius: 1rem;
      padding: 0.75rem;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      width: 100%;
    }
    
    .service-tag.selected {
      border-color: #3b82f6;
      background: #eff6ff;
    }
    
    .service-tag.selected .service-tag-line1 span {
      color: #1e40af !important;
      font-weight: 600;
    }
    
    .service-tag-line1 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: #111827;
    }
    
    .service-tag-price {
      font-size: 0.875rem;
      color: #6b7280;
    }
    
    /* –í–∏–¥–∏–º—ã–π –∫—É—Ä—Å–æ—Ä –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞ */
    input[type="text"],
    input[type="tel"],
    input[type="number"],
    textarea {
      caret-color: #3b82f6;
    }
    
    /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –ø–æ–ª—è—Ö –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ */
    input[type="date"],
    input[type="time"] {
      text-align: left !important;
      padding-left: 1rem !important;
      padding-right: 1rem !important;
    }
    
    /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤ select */
    select {
      text-align: left !important;
      padding-left: 1rem !important;
      padding-right: 1rem !important;
    }
    
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator {
      opacity: 1;
      cursor: pointer;
    }
    
    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    .nav-btn {
      color: #6b7280;
      transition: all 0.2s;
    }
    
    .nav-btn.active {
      color: #3b82f6;
    }
    
    .section {
      display: none;
    }
    
    .section.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="min-h-screen bg-gray-50 pb-24" id="app">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="bg-blue-600 text-white p-4 sticky top-0 z-10 shadow-md">
      <h1 class="text-xl font-bold text-center" id="pageTitle">üìù –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞</h1>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è (–≤–Ω–∏–∑—É) -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-20 shadow-lg">
      <div class="flex justify-around items-center py-2">
        <button onclick="showSection('booking')" class="nav-btn flex flex-col items-center px-2 py-1 text-xs" data-section="booking">
          <i class="fas fa-calendar-alt text-lg mb-1"></i>
          <span>–ó–∞–ø–∏—Å–∏</span>
        </button>
        <button onclick="showSection('schedule')" class="nav-btn flex flex-col items-center px-2 py-1 text-xs" data-section="schedule">
          <i class="fas fa-user-clock text-lg mb-1"></i>
          <span>–ì—Ä–∞—Ñ–∏–∫</span>
        </button>
        <button onclick="showSection('finance')" class="nav-btn flex flex-col items-center px-2 py-1 text-xs" data-section="finance">
          <i class="fas fa-money-bill-wave text-lg mb-1"></i>
          <span>–§–∏–Ω–∞–Ω—Å—ã</span>
        </button>
        <button onclick="showSection('clients')" class="nav-btn flex flex-col items-center px-2 py-1 text-xs" data-section="clients">
          <i class="fas fa-users text-lg mb-1"></i>
          <span>–ö–ª–∏–µ–Ω—Ç—ã</span>
        </button>
        <button onclick="showSection('services')" class="nav-btn flex flex-col items-center px-2 py-1 text-xs" data-section="services">
          <i class="fas fa-list-alt text-lg mb-1"></i>
          <span>–£—Å–ª—É–≥–∏</span>
        </button>
      </div>
    </nav>

    <!-- –†–∞–∑–¥–µ–ª: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ -->
    <section id="section-booking" class="section active">
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º –∏ —Ñ–æ—Ä–º–æ–π -->
      <div class="flex border-b border-gray-200 bg-white sticky top-14 z-10">
        <button onclick="showBookingView('calendar')" id="btn-calendar" class="flex-1 py-3 text-center font-semibold border-b-2 border-blue-600 text-blue-600">
          üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å
        </button>
        <button onclick="showBookingView('form')" id="btn-form" class="flex-1 py-3 text-center font-semibold text-gray-600">
          ‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
        </button>
      </div>

      <!-- –í–∏–¥: –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–ø–∏—Å–µ–π -->
      <div id="booking-calendar-view" class="p-4">
        <div class="flex items-center justify-between mb-4">
          <button onclick="changeBookingMonth(-1)" class="p-2 text-gray-600">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h3 class="text-lg font-semibold" id="bookingMonthTitle">–ù–æ—è–±—Ä—å 2025</h3>
          <button onclick="changeBookingMonth(1)" class="p-2 text-gray-600">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        
        <!-- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ -->
        <div class="grid grid-cols-7 gap-1 mb-2">
          <div class="text-center text-xs font-semibold text-gray-600 py-1">–ü–Ω</div>
          <div class="text-center text-xs font-semibold text-gray-600 py-1">–í—Ç</div>
          <div class="text-center text-xs font-semibold text-gray-600 py-1">–°—Ä</div>
          <div class="text-center text-xs font-semibold text-gray-600 py-1">–ß—Ç</div>
          <div class="text-center text-xs font-semibold text-gray-600 py-1">–ü—Ç</div>
          <div class="text-center text-xs font-semibold text-purple-600 py-1">–°–±</div>
          <div class="text-center text-xs font-semibold text-purple-600 py-1">–í—Å</div>
        </div>
        
        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
        <div id="bookingsCalendar" class="grid grid-cols-7 gap-1">
          <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>

      <!-- –í–∏–¥: –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
      <div id="booking-form-view" class="hidden">
      <!-- –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
      <form id="bookingForm" class="p-4 space-y-4 max-w-lg mx-auto">
      <!-- –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ -->
      <div>
        <label for="clientName" class="block text-gray-900 font-semibold mb-2">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
        <input type="text" id="clientName" name="clientName" required 
          class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none" 
          placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞" />
      </div>

      <!-- –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
      <div>
        <label for="clientPhone" class="block text-gray-900 font-semibold mb-2">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
        <input type="tel" id="clientPhone" name="clientPhone" required 
          class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none" 
          placeholder="+7 (XXX) XXX-XX-XX" />
      </div>

      <!-- –î–∞—Ç–∞ -->
      <div>
        <label for="bookingDate" class="block text-gray-900 font-semibold mb-2">–î–∞—Ç–∞</label>
        <input type="date" id="bookingDate" name="bookingDate" required 
          class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left focus:ring-2 focus:ring-blue-500 focus:outline-none" />
      </div>

      <!-- –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ -->
      <div>
        <label for="startTime" class="block text-gray-900 font-semibold mb-2">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
        <input type="time" id="startTime" name="startTime" required 
          class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left focus:ring-2 focus:ring-blue-500 focus:outline-none" />
      </div>

      <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
      <div>
        <label for="duration" class="block text-gray-900 font-semibold mb-2">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)</label>
        <select id="duration" name="duration" required 
          class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left focus:ring-2 focus:ring-blue-500 focus:outline-none">
          <option value="0.5">0.5</option>
          <option value="1" selected>1</option>
          <option value="1.5">1.5</option>
          <option value="2">2</option>
          <option value="2.5">2.5</option>
          <option value="3">3</option>
          <option value="3.5">3.5</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
        </select>
      </div>

      <!-- –£—Å–ª—É–≥–∏ -->
      <div>
        <label class="block text-gray-900 font-semibold mb-2">–£—Å–ª—É–≥–∏</label>
        <div id="servicesContainer" class="space-y-2">
          <!-- –£—Å–ª—É–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>

      <!-- –°—É–º–º–∞ -->
      <div>
        <label class="block text-gray-900 font-semibold mb-2">–°—É–º–º–∞</label>
        <input type="text" id="totalAmount" readonly 
          class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 bg-gray-50" 
          value="0 ‚ÇΩ">
      </div>

      <!-- –°–∫–∏–¥–∫–∞ -->
      <div>
        <label class="block text-gray-900 font-semibold mb-2">–°–∫–∏–¥–∫–∞</label>
        <div class="flex items-center space-x-2">
          <input type="number" id="discountPercent" min="0" max="100" 
            class="w-1/2 rounded-2xl border border-gray-300 px-4 py-3 text-gray-900" 
            placeholder="%">
          <span class="text-gray-500">–∏–ª–∏</span>
          <input type="number" id="discountAmount" min="0" 
            class="w-1/2 rounded-2xl border border-gray-300 px-4 py-3 text-gray-900" 
            placeholder="‚ÇΩ">
        </div>
      </div>

      <!-- –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ -->
      <div class="grid grid-cols-3 gap-2">
        <div class="flex-1">
          <label class="block text-gray-900 font-semibold mb-2 text-sm">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (‚ÇΩ)</label>
          <input type="number" id="prepayAmount" min="0" 
            class="w-full rounded-2xl border border-gray-300 px-3 py-2 text-gray-900 text-sm text-left" 
            placeholder="0">
        </div>
        <div class="flex-1">
          <label class="block text-gray-900 font-semibold mb-2 text-sm">–ú–µ—Ç–æ–¥</label>
          <select id="prepayMethod" 
            class="w-full rounded-2xl border border-gray-300 px-3 py-2 text-gray-900 text-sm text-left">
            <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ</option>
            <option value="transfer">–ü–µ—Ä–µ–≤–æ–¥</option>
          </select>
        </div>
        <div class="flex-1">
          <label class="block text-gray-900 font-semibold mb-2 text-sm">–î–∞—Ç–∞</label>
          <input type="date" id="prepayDate" 
            class="w-full rounded-2xl border border-gray-300 px-3 py-2 text-gray-900 text-sm text-left">
        </div>
      </div>

      <!-- –î–æ–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ -->
      <div>
        <label class="block text-gray-900 font-semibold mb-2">–î–æ–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ (‚ÇΩ)</label>
        <div class="grid grid-cols-2 gap-2">
          <input type="number" id="finalPayAmountCash" min="0" 
            class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left" 
            placeholder="0">
          <input type="date" id="finalPayDateCash" 
            class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left">
        </div>
      </div>

      <!-- –î–æ–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º -->
      <div>
        <label class="block text-gray-900 font-semibold mb-2">–î–æ–ø–ª–∞—Ç–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–º (‚ÇΩ)</label>
        <div class="grid grid-cols-2 gap-2">
          <input type="number" id="finalPayAmountTransfer" min="0" 
            class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left" 
            placeholder="0">
          <input type="date" id="finalPayDateTransfer" 
            class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left">
        </div>
      </div>

      <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å -->
      <div>
        <label class="block text-gray-900 font-semibold mb-2">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
        <input type="text" id="finalAmount" readonly 
          class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 bg-gray-50 font-semibold" 
          value="0 ‚ÇΩ">
      </div>

      <!-- –ü—Ä–∏–º–µ—á–∞–Ω–∏—è -->
      <div>
        <label for="notes" class="block text-gray-900 font-semibold mb-2">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
        <textarea id="notes" name="notes" rows="3" 
          placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è" 
          class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none"></textarea>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
      <button type="submit" 
        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-semibold transition shadow-lg">
        ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å
      </button>
    </form>
    </div>
    </section>

    <!-- –†–∞–∑–¥–µ–ª: –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
    <section id="section-clients" class="section hidden">
      <div class="p-4">
        <h2 class="text-xl font-bold mb-4">üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
        <div class="mb-4">
          <input type="text" id="clientSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É..." 
            class="w-full rounded-2xl border border-gray-300 px-4 py-3 text-gray-900 text-left">
        </div>
        <div id="clientsList" class="space-y-2">
          <div class="text-center text-gray-500 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤...</div>
        </div>
      </div>
    </section>

    <!-- –†–∞–∑–¥–µ–ª: –§–∏–Ω–∞–Ω—Å—ã -->
    <section id="section-finance" class="section hidden">
      <div class="p-4">
        <h2 class="text-xl font-bold mb-4">üí∞ –§–∏–Ω–∞–Ω—Å—ã</h2>
        <div class="bg-white rounded-2xl p-4 mb-4">
          <div class="text-sm text-gray-600 mb-2">–í—ã—Ä—É—á–∫–∞ —Å–µ–≥–æ–¥–Ω—è</div>
          <div class="text-2xl font-bold text-green-600" id="revenueToday">0 ‚ÇΩ</div>
        </div>
        <div class="bg-white rounded-2xl p-4 mb-4">
          <div class="text-sm text-gray-600 mb-2">–í—ã—Ä—É—á–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é</div>
          <div class="text-2xl font-bold text-green-600" id="revenueWeek">0 ‚ÇΩ</div>
        </div>
        <div class="bg-white rounded-2xl p-4">
          <div class="text-sm text-gray-600 mb-2">–í—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü</div>
          <div class="text-2xl font-bold text-green-600" id="revenueMonth">0 ‚ÇΩ</div>
        </div>
      </div>
    </section>

    <!-- –†–∞–∑–¥–µ–ª: –ì—Ä–∞—Ñ–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
    <section id="section-schedule" class="section hidden">
      <div class="p-4">
        <h2 class="text-xl font-bold mb-4">üìÖ –ì—Ä–∞—Ñ–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</h2>
        <div id="scheduleCalendar" class="bg-white rounded-2xl p-4">
          <div class="text-center text-gray-500 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞...</div>
        </div>
      </div>
    </section>

    <!-- –†–∞–∑–¥–µ–ª: –£—Å–ª—É–≥–∏ -->
    <section id="section-services" class="section hidden">
      <div class="p-4">
        <h2 class="text-xl font-bold mb-4">üìã –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥</h2>
        <div class="bg-white rounded-2xl p-4 mb-4">
          <h3 class="font-semibold mb-2">–ë—É–¥–Ω–∏–µ –¥–Ω–∏</h3>
          <div class="text-sm space-y-1" id="weekdayServices"></div>
        </div>
        <div class="bg-white rounded-2xl p-4">
          <h3 class="font-semibold mb-2">–í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏</h3>
          <div class="text-sm space-y-1" id="weekendServices"></div>
        </div>
      </div>
    </section>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ -->
    <div id="message" class="fixed top-20 left-4 right-4 bg-green-500 text-white p-4 rounded-2xl shadow-lg hidden z-50">
      <p id="messageText"></p>
    </div>
  </div>

  <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è onclick –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ -->
  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    window.bookingsViewMonth = new Date();
    window.bookings = [];
    window.db = null; // –ë—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase
    
    // –ó–∞–≥–ª—É—à–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π - –±—É–¥—É—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è
    window.showSection = function(sectionName) {
      console.log('showSection called, waiting for module to load...');
    };
    
    window.showBookingView = function(view) {
      console.log('showBookingView called, waiting for module to load...');
    };
    
    window.changeBookingMonth = function(delta) {
      console.log('changeBookingMonth called, waiting for module to load...');
    };
  </script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
      getFirestore, collection, addDoc, query, where, getDocs, updateDoc, doc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBaq_faWwfE_TXn4Xh_2U3GYSAsUzGJ1bk",
      authDomain: "vr-lounge33.firebaseapp.com",
      projectId: "vr-lounge33",
      storageBucket: "vr-lounge33.appspot.com",
      messagingSenderId: "825655988090",
      appId: "1:825655988090:web:76d8e0554b8601f8bd10c3"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.db = db; // –î–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ

    // Telegram Web App API
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
    const user = tg.initDataUnsafe?.user;
    const userId = user?.id?.toString();
    const username = user?.username ? `@${user.username}` : null;
    const firstName = user?.first_name || '';

    console.log('Telegram User:', user);

    // –¶–µ–Ω—ã —É—Å–ª—É–≥ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å CRM)
    const servicePrices = {
      weekday_ps1: 150,
      weekday_ps2: 300,
      weekday_vr1: 500,
      weekday_vr2: 1000,
      weekday_vr3: 1500,
      weekday_vr4: 2000,
      weekend_vr1: 750,
      weekend_vr2: 1500,
      weekend_vr3: 2250,
      weekend_vr4: 3000,
      xbox_kinnect: 500,
      xbox1: 250,
      xbox2: 500,
      xbox3: 750,
      xbox4: 1000,
      karaoke: 1000,
      board_games: 500,
      hostess: 2000,
      birthday: {
        1: 4000, 2: 3500, 3: 3000, 4: 3000, 5: 3000,
        6: 3000, 7: 3000, 8: 3000, 9: 3000, 10: 3000,
        11: 3000, 12: 3000
      }
    };

    // –ù–∞–∑–≤–∞–Ω–∏—è —É—Å–ª—É–≥
    const serviceLabels = {
      weekday_ps1: 'PS5 (1 –¥–∂–æ–π—Å—Ç–∏–∫)',
      weekday_ps2: 'PS5 (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞)',
      weekday_vr1: 'VR –æ—á–∫–∏ (1 —à—Ç.) | –ë—É–¥–Ω–∏',
      weekday_vr2: 'VR –æ—á–∫–∏ (2 —à—Ç.) | –ë—É–¥–Ω–∏',
      weekday_vr3: 'VR –æ—á–∫–∏ (3 —à—Ç.) | –ë—É–¥–Ω–∏',
      weekday_vr4: 'VR –æ—á–∫–∏ (4 —à—Ç.) | –ë—É–¥–Ω–∏',
      weekend_vr1: 'VR –æ—á–∫–∏ (1 —à—Ç.) | –í—ã—Ö–æ–¥–Ω—ã–µ',
      weekend_vr2: 'VR –æ—á–∫–∏ (2 —à—Ç.) | –í—ã—Ö–æ–¥–Ω—ã–µ',
      weekend_vr3: 'VR –æ—á–∫–∏ (3 —à—Ç.) | –í—ã—Ö–æ–¥–Ω—ã–µ',
      weekend_vr4: 'VR –æ—á–∫–∏ (4 —à—Ç.) | –í—ã—Ö–æ–¥–Ω—ã–µ',
      xbox_kinnect: 'X-Box Kinnect (–¥–æ 8 —á–µ–ª.)',
      xbox1: 'X-Box (1 –¥–∂–æ–π—Å—Ç–∏–∫)',
      xbox2: 'X-Box (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞)',
      xbox3: 'X-Box (3 –¥–∂–æ–π—Å—Ç–∏–∫–∞)',
      xbox4: 'X-Box (4 –¥–∂–æ–π—Å—Ç–∏–∫–∞)',
      karaoke: '–ö–∞—Ä–∞–æ–∫–µ',
      board_games: '–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã',
      hostess: '–í–µ–¥—É—â–∞—è',
      birthday: '–ê—Ä–µ–Ω–¥–∞ –≤—Å–µ–≥–æ (–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è)'
    };

    // –ò–∫–æ–Ω–∫–∏ —É—Å–ª—É–≥
    const serviceIcons = {
      weekday_ps1: 'fa-gamepad',
      weekday_ps2: 'fa-gamepad',
      weekday_vr1: 'fa-vr-cardboard',
      weekday_vr2: 'fa-vr-cardboard',
      weekday_vr3: 'fa-vr-cardboard',
      weekday_vr4: 'fa-vr-cardboard',
      weekend_vr1: 'fa-vr-cardboard',
      weekend_vr2: 'fa-vr-cardboard',
      weekend_vr3: 'fa-vr-cardboard',
      weekend_vr4: 'fa-vr-cardboard',
      xbox_kinnect: 'fa-child',
      xbox1: 'fa-gamepad',
      xbox2: 'fa-gamepad',
      xbox3: 'fa-gamepad',
      xbox4: 'fa-gamepad',
      karaoke: 'fa-microphone',
      board_games: 'fa-dice-d6',
      hostess: 'fa-user-tie',
      birthday: 'fa-birthday-cake'
    };

    // –¶–≤–µ—Ç–∞ –∏–∫–æ–Ω–æ–∫
    const serviceColors = {
      weekday_ps1: 'text-indigo-600',
      weekday_ps2: 'text-indigo-600',
      weekday_vr1: 'text-blue-600',
      weekday_vr2: 'text-blue-600',
      weekday_vr3: 'text-blue-600',
      weekday_vr4: 'text-blue-600',
      weekend_vr1: 'text-blue-600',
      weekend_vr2: 'text-blue-600',
      weekend_vr3: 'text-blue-600',
      weekend_vr4: 'text-blue-600',
      xbox_kinnect: 'text-orange-600',
      xbox1: 'text-green-600',
      xbox2: 'text-green-600',
      xbox3: 'text-green-600',
      xbox4: 'text-green-600',
      karaoke: 'text-pink-600',
      board_games: 'text-purple-600',
      hostess: 'text-pink-600',
      birthday: 'text-red-600'
    };

    // –í—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
    const selectedServices = new Set();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –¥–Ω—è (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã –∏–ª–∏ –æ–±—ä–µ–∫—Ç Date)
    function isWeekend(dateInput) {
      const date = typeof dateInput === 'string' ? new Date(dateInput) : dateInput;
      const day = date.getDay();
      return day === 0 || day === 6;
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    function formatPhone(phone) {
      const digits = phone.replace(/\D/g, '');
      if (digits.startsWith('8')) {
        return '7' + digits.substring(1);
      }
      if (!digits.startsWith('7')) {
        return '7' + digits;
      }
      return digits;
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function formatPhoneDisplay(phoneDigits) {
      if (phoneDigits.length < 11) return phoneDigits;
      return `+7 (${phoneDigits.substring(1, 4)}) ${phoneDigits.substring(4, 7)}-${phoneDigits.substring(7, 9)}-${phoneDigits.substring(9, 11)}`;
    }

    // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    function calculateTotal() {
      const duration = parseFloat(document.getElementById('duration').value) || 0;
      const bookingDate = document.getElementById('bookingDate').value;
      const isWeekendDay = isWeekend(bookingDate);
      
      let total = 0;

      selectedServices.forEach(service => {
        if (service === 'birthday') {
          const fullHours = Math.floor(duration);
          const hasHalfHour = duration % 1 !== 0;
          let birthdayTotal = 0;
          for (let hour = 1; hour <= fullHours; hour++) {
            const hourPrice = servicePrices.birthday[hour] || servicePrices.birthday[4] || 3000;
            birthdayTotal += hourPrice;
          }
          if (hasHalfHour) {
            if (fullHours === 0) birthdayTotal += 2000;
            else if (fullHours === 1) birthdayTotal += 2000;
            else birthdayTotal += (servicePrices.birthday[3] || 3000) / 2;
          }
          total += birthdayTotal;
        } else if (service === 'hostess') {
          total += servicePrices.hostess;
        } else {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—É–¥–Ω–∏–π –∏–ª–∏ –≤—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å –¥–ª—è VR —É—Å–ª—É–≥
          let serviceKey = service;
          if (service.includes('vr') && isWeekendDay && !service.includes('weekend')) {
            serviceKey = service.replace('weekday', 'weekend');
          } else if (service.includes('vr') && !isWeekendDay && !service.includes('weekday')) {
            serviceKey = service.replace('weekend', 'weekday');
          }
          const price = servicePrices[serviceKey] || servicePrices[service] || 0;
          total += price * duration;
        }
      });

      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫–∏
      const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
      const discountAmount = parseFloat(document.getElementById('discountAmount').value) || 0;
      
      if (discountPercent > 0) {
        total = total * (1 - discountPercent / 100);
      } else if (discountAmount > 0) {
        total = Math.max(0, total - discountAmount);
      }

      return Math.round(total);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    function updateTotal() {
      const total = calculateTotal();
      document.getElementById('totalAmount').value = total.toLocaleString('ru-RU') + ' ‚ÇΩ';
      
      const prepayAmount = parseFloat(document.getElementById('prepayAmount').value) || 0;
      const finalPayCash = parseFloat(document.getElementById('finalPayAmountCash').value) || 0;
      const finalPayTransfer = parseFloat(document.getElementById('finalPayAmountTransfer').value) || 0;
      
      const finalTotal = total - prepayAmount - finalPayCash - finalPayTransfer;
      document.getElementById('finalAmount').value = finalTotal.toLocaleString('ru-RU') + ' ‚ÇΩ';
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —É—Å–ª—É–≥
    function renderServices() {
      const container = document.getElementById('servicesContainer');
      const bookingDate = document.getElementById('bookingDate').value;
      const isWeekendDay = isWeekend(bookingDate);

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å–ª—É–≥–∏
      const availableServices = isWeekendDay
        ? ['weekend_vr1', 'weekend_vr2', 'weekend_vr3', 'weekend_vr4', 'weekday_ps1', 'weekday_ps2', 'xbox_kinnect', 'xbox1', 'xbox2', 'xbox3', 'xbox4', 'karaoke', 'board_games', 'hostess', 'birthday']
        : ['weekday_vr1', 'weekday_vr2', 'weekday_vr3', 'weekday_vr4', 'weekday_ps1', 'weekday_ps2', 'xbox_kinnect', 'xbox1', 'xbox2', 'xbox3', 'xbox4', 'karaoke', 'board_games', 'hostess', 'birthday'];

      container.innerHTML = '';

      availableServices.forEach(service => {
        const isSelected = selectedServices.has(service);
        const label = serviceLabels[service] || service;
        const icon = serviceIcons[service] || 'fa-circle';
        const color = serviceColors[service] || 'text-gray-600';
        const price = servicePrices[service] || (service === 'birthday' ? '–æ—Ç 3000' : '0');

        const button = document.createElement('button');
        button.type = 'button';
        button.className = `service-tag ${isSelected ? 'selected' : ''}`;
        button.dataset.service = service;
        
        button.innerHTML = `
          <div class="service-tag-line1">
            <i class="fas ${icon} ${color}"></i>
            <span>${label}</span>
          </div>
          <div class="service-tag-price">${service === 'hostess' ? '2000 ‚ÇΩ' : service === 'birthday' ? '–æ—Ç 3000 ‚ÇΩ/—á–∞—Å' : price + ' ‚ÇΩ/—á–∞—Å'}</div>
        `;

        button.addEventListener('click', () => {
          if (selectedServices.has(service)) {
            selectedServices.delete(service);
          } else {
            selectedServices.add(service);
          }
          button.classList.toggle('selected');
          updateTotal();
        });

        container.appendChild(button);
      });
    }

    // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
    function showMessage(text, isError = false) {
      const messageEl = document.getElementById('message');
      const messageTextEl = document.getElementById('messageText');
      messageTextEl.textContent = text;
      messageEl.className = `fixed top-20 left-4 right-4 p-4 rounded-2xl shadow-lg z-50 ${isError ? 'bg-red-500' : 'bg-green-500'} text-white`;
      messageEl.classList.remove('hidden');
      
      setTimeout(() => {
        messageEl.classList.add('hidden');
      }, 3000);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    function initForm() {
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–µ–≥–æ–¥–Ω—è)
      const today = new Date();
      const dateStr = today.toISOString().split('T')[0];
      document.getElementById('bookingDate').value = dateStr;

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 1 —á–∞—Å)
      const nextHour = new Date(today.getTime() + 60 * 60 * 1000);
      const timeStr = nextHour.toTimeString().slice(0, 5);
      document.getElementById('startTime').value = timeStr;

      // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram, –∑–∞–ø–æ–ª–Ω—è–µ–º –∏–º—è
      if (firstName) {
        document.getElementById('clientName').value = firstName;
      }

      // –†–µ–Ω–¥–µ—Ä–∏–º —É—Å–ª—É–≥–∏
      renderServices();

      // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
      document.getElementById('bookingDate').addEventListener('change', () => {
        renderServices();
        updateTotal();
      });

      document.getElementById('duration').addEventListener('change', updateTotal);
      document.getElementById('discountPercent').addEventListener('input', updateTotal);
      document.getElementById('discountAmount').addEventListener('input', updateTotal);
      document.getElementById('prepayAmount').addEventListener('input', updateTotal);
      document.getElementById('finalPayAmountCash').addEventListener('input', updateTotal);
      document.getElementById('finalPayAmountTransfer').addEventListener('input', updateTotal);

      // –ú–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      const phoneInput = document.getElementById('clientPhone');
      phoneInput.value = '+7 (';
      phoneInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        if (value.startsWith('8')) {
          value = '7' + value.substring(1);
        }
        if (!value.startsWith('7')) {
          value = '7' + value;
        }
        if (value.length > 11) value = value.substring(0, 11);
        
        if (value.length >= 1) {
          let formatted = '+7 (';
          if (value.length > 1) formatted += value.substring(1, 4);
          if (value.length >= 4) formatted += ') ' + value.substring(4, 7);
          if (value.length >= 7) formatted += '-' + value.substring(7, 9);
          if (value.length >= 9) formatted += '-' + value.substring(9, 11);
          e.target.value = formatted;
        } else {
          e.target.value = '+7 (';
        }
      });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    document.getElementById('bookingForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const clientName = document.getElementById('clientName').value.trim();
      const clientPhone = document.getElementById('clientPhone').value.trim();
      const bookingDate = document.getElementById('bookingDate').value;
      const startTime = document.getElementById('startTime').value;
      const duration = parseFloat(document.getElementById('duration').value);
      const notes = document.getElementById('notes').value.trim();

      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!clientName) {
        showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞', true);
        return;
      }

      if (selectedServices.size === 0) {
        showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —É—Å–ª—É–≥—É', true);
        return;
      }

      // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      const phoneDigits = formatPhone(clientPhone);
      if (phoneDigits.length < 11) {
        showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', true);
        return;
      }

      const formattedPhone = formatPhoneDisplay(phoneDigits);

      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      const bookingData = {
        clientName: clientName,
        clientPhone: formattedPhone,
        bookingDate: bookingDate,
        startTime: startTime,
        duration: duration,
        selectedServices: Array.from(selectedServices),
        notes: notes,
        discountPercent: parseFloat(document.getElementById('discountPercent').value) || 0,
        discountAmount: parseFloat(document.getElementById('discountAmount').value) || 0,
        prepayment: {
          amount: parseFloat(document.getElementById('prepayAmount').value) || 0,
          method: document.getElementById('prepayMethod').value || 'cash',
          date: document.getElementById('prepayDate').value || ''
        },
        finalPaymentCash: {
          amount: parseFloat(document.getElementById('finalPayAmountCash').value) || 0,
          date: document.getElementById('finalPayDateCash').value || ''
        },
        finalPaymentTransfer: {
          amount: parseFloat(document.getElementById('finalPayAmountTransfer').value) || 0,
          date: document.getElementById('finalPayDateTransfer').value || '',
          notes: '–ü–µ—Ä–µ–≤–æ–¥'
        },
        createdAt: new Date()
      };

      try {
        // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', bookingData);
        console.log('–í—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏:', Array.from(selectedServices));
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
        await addDoc(collection(db, 'bookings'), bookingData);
        console.log('‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ bookings');

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞
        console.log('–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É:', phoneDigits);
        const clientsQuery = query(
          collection(db, 'clients'),
          where('phoneDigits', '==', phoneDigits)
        );
        const clientsSnapshot = await getDocs(clientsQuery);
        console.log('–ù–∞–π–¥–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤:', clientsSnapshot.size);

        if (!clientsSnapshot.empty) {
          // –ö–ª–∏–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          const clientDoc = clientsSnapshot.docs[0];
          const clientData = clientDoc.data();
          
          await updateDoc(clientDoc.ref, {
            lastBookingDate: bookingDate,
            totalBookings: (clientData.totalBookings || 0) + 1,
            totalSpent: (clientData.totalSpent || 0) + calculateTotal(),
            telegramId: userId || clientData.telegramId,
            telegramUsername: username || clientData.telegramUsername
          });
        } else {
          // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
          await addDoc(collection(db, 'clients'), {
            clientName: clientName,
            clientPhone: formattedPhone,
            phoneDigits: phoneDigits,
            telegramId: userId,
            telegramUsername: username,
            createdAt: new Date(),
            lastBookingDate: bookingDate,
            totalBookings: 1,
            totalSpent: calculateTotal(),
            isActive: true
          });
        }

        showMessage('‚úÖ –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º Mini App —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
          tg.close();
        }, 2000);

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
        console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', {
          code: error.code,
          message: error.message,
          stack: error.stack
        });
        
        // –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        let errorMessage = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏. ';
        if (error.code === 'permission-denied') {
          errorMessage += '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore –≤ Firebase Console.';
        } else if (error.code === 'unavailable') {
          errorMessage += '–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Firebase. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.';
        } else {
          errorMessage += `–ö–æ–¥ –æ—à–∏–±–∫–∏: ${error.code || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12).`;
        }
        
        showMessage(errorMessage, true);
      }
    });

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è) - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–≥–ª—É—à–∫—É
    window.showSection = function(sectionName) {
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
        section.classList.add('hidden');
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
      const sectionEl = document.getElementById(`section-${sectionName}`);
      if (sectionEl) {
        sectionEl.classList.add('active');
        sectionEl.classList.remove('hidden');
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      const activeBtn = document.querySelector(`.nav-btn[data-section="${sectionName}"]`);
      if (activeBtn) {
        activeBtn.classList.add('active');
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
      const titles = {
        'booking': 'üìù –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞',
        'clients': 'üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤',
        'finance': 'üí∞ –§–∏–Ω–∞–Ω—Å—ã',
        'schedule': 'üìÖ –ì—Ä–∞—Ñ–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤',
        'services': 'üìã –£—Å–ª—É–≥–∏'
      };
      const titleEl = document.getElementById('pageTitle');
      if (titleEl && titles[sectionName]) {
        titleEl.textContent = titles[sectionName];
      }
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∞
      loadSectionData(sectionName);
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–∞
    async function loadSectionData(sectionName) {
      if (sectionName === 'clients') {
        await loadClients();
      } else if (sectionName === 'finance') {
        await loadFinance();
      } else if (sectionName === 'schedule') {
        await loadSchedule();
      } else if (sectionName === 'services') {
        loadServices();
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
    async function loadClients() {
      const clientsList = document.getElementById('clientsList');
      if (!clientsList) return;
      
      try {
        clientsList.innerHTML = '<div class="text-center text-gray-500 py-8">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
        const clientsSnapshot = await getDocs(collection(db, 'clients'));
        const clients = clientsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        if (clients.length === 0) {
          clientsList.innerHTML = '<div class="text-center text-gray-500 py-8">–ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
          return;
        }
        
        clientsList.innerHTML = '';
        clients.forEach(client => {
          const clientCard = document.createElement('div');
          clientCard.className = 'bg-white rounded-2xl p-4 mb-2';
          clientCard.innerHTML = `
            <div class="font-semibold text-gray-900">${client.clientName || '-'}</div>
            <div class="text-sm text-gray-600 mt-1">${client.clientPhone || '-'}</div>
            <div class="text-xs text-gray-500 mt-2">
              –ó–∞–ø–∏—Å–µ–π: ${client.totalBookings || 0} | 
              –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: ${(client.totalSpent || 0).toLocaleString('ru-RU')} ‚ÇΩ
            </div>
          `;
          clientsList.appendChild(clientCard);
        });
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:', error);
        clientsList.innerHTML = '<div class="text-center text-red-500 py-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤
    async function loadFinance() {
      try {
        const bookingsSnapshot = await getDocs(collection(db, 'bookings'));
        const bookings = bookingsSnapshot.docs.map(doc => doc.data());
        
        const today = new Date().toISOString().split('T')[0];
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        const monthAgo = new Date();
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        
        let revenueToday = 0;
        let revenueWeek = 0;
        let revenueMonth = 0;
        
        bookings.forEach(booking => {
          // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
          const bookingDate = booking.bookingDate;
          const date = new Date(bookingDate);
          
          if (bookingDate === today) {
            revenueToday += booking.totalAmount || 0;
          }
          if (date >= weekAgo) {
            revenueWeek += booking.totalAmount || 0;
          }
          if (date >= monthAgo) {
            revenueMonth += booking.totalAmount || 0;
          }
        });
        
        document.getElementById('revenueToday').textContent = revenueToday.toLocaleString('ru-RU') + ' ‚ÇΩ';
        document.getElementById('revenueWeek').textContent = revenueWeek.toLocaleString('ru-RU') + ' ‚ÇΩ';
        document.getElementById('revenueMonth').textContent = revenueMonth.toLocaleString('ru-RU') + ' ‚ÇΩ';
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤:', error);
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞
    async function loadSchedule() {
      const scheduleCalendar = document.getElementById('scheduleCalendar');
      if (!scheduleCalendar) return;
      
      try {
        scheduleCalendar.innerHTML = '<div class="text-center text-gray-500 py-8">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞...</div>';
        const assignmentsSnapshot = await getDocs(collection(db, 'adminAssignments'));
        const assignments = assignmentsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        if (assignments.length === 0) {
          scheduleCalendar.innerHTML = '<div class="text-center text-gray-500 py-8">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–π –Ω–µ—Ç</div>';
          return;
        }
        
        scheduleCalendar.innerHTML = '';
        assignments.forEach(assignment => {
          const assignmentCard = document.createElement('div');
          assignmentCard.className = 'bg-gray-50 rounded-xl p-3 mb-2';
          assignmentCard.innerHTML = `
            <div class="font-semibold text-gray-900">${assignment.date || '-'}</div>
            <div class="text-sm text-gray-600 mt-1">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω</div>
          `;
          scheduleCalendar.appendChild(assignmentCard);
        });
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
        scheduleCalendar.innerHTML = '<div class="text-center text-red-500 py-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥
    function loadServices() {
      const weekdayServices = document.getElementById('weekdayServices');
      const weekendServices = document.getElementById('weekendServices');
      
      if (weekdayServices) {
        weekdayServices.innerHTML = `
          <div>PS5 (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 150 ‚ÇΩ/—á–∞—Å</div>
          <div>PS5 (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 300 ‚ÇΩ/—á–∞—Å</div>
          <div>VR –æ—á–∫–∏ (1 —à—Ç.) ‚Äî 500 ‚ÇΩ/—á–∞—Å</div>
          <div>VR –æ—á–∫–∏ (2 —à—Ç.) ‚Äî 1000 ‚ÇΩ/—á–∞—Å</div>
          <div>VR –æ—á–∫–∏ (3 —à—Ç.) ‚Äî 1500 ‚ÇΩ/—á–∞—Å</div>
          <div>VR –æ—á–∫–∏ (4 —à—Ç.) ‚Äî 2000 ‚ÇΩ/—á–∞—Å</div>
          <div>X-Box Kinnect ‚Äî 500 ‚ÇΩ/—á–∞—Å</div>
          <div>X-Box (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 250 ‚ÇΩ/—á–∞—Å</div>
          <div>X-Box (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 500 ‚ÇΩ/—á–∞—Å</div>
          <div>–ö–∞—Ä–∞–æ–∫–µ ‚Äî 1000 ‚ÇΩ/—á–∞—Å</div>
          <div>–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã ‚Äî 500 ‚ÇΩ/—á–∞—Å</div>
        `;
      }
      
      if (weekendServices) {
        weekendServices.innerHTML = `
          <div>VR –æ—á–∫–∏ (1 —à—Ç.) ‚Äî 750 ‚ÇΩ/—á–∞—Å</div>
          <div>VR –æ—á–∫–∏ (2 —à—Ç.) ‚Äî 1500 ‚ÇΩ/—á–∞—Å</div>
          <div>VR –æ—á–∫–∏ (3 —à—Ç.) ‚Äî 2250 ‚ÇΩ/—á–∞—Å</div>
          <div>VR –æ—á–∫–∏ (4 —à—Ç.) ‚Äî 3000 ‚ÇΩ/—á–∞—Å</div>
          <div>PS5 (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 150 ‚ÇΩ/—á–∞—Å</div>
          <div>PS5 (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 300 ‚ÇΩ/—á–∞—Å</div>
          <div>X-Box Kinnect ‚Äî 500 ‚ÇΩ/—á–∞—Å</div>
          <div>X-Box (1 –¥–∂–æ–π—Å—Ç–∏–∫) ‚Äî 250 ‚ÇΩ/—á–∞—Å</div>
          <div>X-Box (2 –¥–∂–æ–π—Å—Ç–∏–∫–∞) ‚Äî 500 ‚ÇΩ/—á–∞—Å</div>
          <div>–ö–∞—Ä–∞–æ–∫–µ ‚Äî 1000 ‚ÇΩ/—á–∞—Å</div>
          <div>–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã ‚Äî 500 ‚ÇΩ/—á–∞—Å</div>
        `;
      }
    }
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º –∏ —Ñ–æ—Ä–º–æ–π (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è) - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–≥–ª—É—à–∫—É
    window.showBookingView = function(view) {
      const calendarView = document.getElementById('booking-calendar-view');
      const formView = document.getElementById('booking-form-view');
      const btnCalendar = document.getElementById('btn-calendar');
      const btnForm = document.getElementById('btn-form');
      
      if (view === 'calendar') {
        calendarView.classList.remove('hidden');
        formView.classList.add('hidden');
        btnCalendar.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
        btnCalendar.classList.remove('text-gray-600');
        btnForm.classList.remove('border-b-2', 'border-blue-600', 'text-blue-600');
        btnForm.classList.add('text-gray-600');
        if (window.renderBookingsCalendar) {
          window.renderBookingsCalendar();
        } else {
          setTimeout(() => {
            if (window.renderBookingsCalendar) {
              window.renderBookingsCalendar();
            }
          }, 500);
        }
      } else {
        calendarView.classList.add('hidden');
        formView.classList.remove('hidden');
        btnForm.classList.add('border-b-2', 'border-blue-600', 'text-blue-600');
        btnForm.classList.remove('text-gray-600');
        btnCalendar.classList.remove('border-b-2', 'border-blue-600', 'text-blue-600');
        btnCalendar.classList.add('text-gray-600');
      }
    }
    
    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –∑–∞–ø–∏—Å–µ–π (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è) - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–≥–ª—É—à–∫—É
    window.changeBookingMonth = function(delta) {
      window.bookingsViewMonth.setMonth(window.bookingsViewMonth.getMonth() + delta);
      if (window.renderBookingsCalendar) {
        window.renderBookingsCalendar();
      } else {
        console.error('renderBookingsCalendar –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
      }
    }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    function formatDateSafe(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
    
    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –∑–∞–ø–∏—Å–µ–π
    async function renderBookingsCalendar() {
      const calendarEl = document.getElementById('bookingsCalendar');
      const monthTitleEl = document.getElementById('bookingMonthTitle');
      
      if (!calendarEl) {
        console.error('–≠–ª–µ–º–µ–Ω—Ç bookingsCalendar –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Å—è—Ü–∞
      if (monthTitleEl) {
        monthTitleEl.textContent = window.bookingsViewMonth.toLocaleDateString('ru-RU', {
          month: 'long',
          year: 'numeric'
        });
      }
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–ø–∏—Å–∏
      try {
        const firestoreDb = db || window.db;
        if (!firestoreDb) {
          console.error('Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          calendarEl.innerHTML = '<div class="text-center text-red-500 py-8">–û—à–∏–±–∫–∞: Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
          return;
        }
        const bookingsSnapshot = await getDocs(collection(firestoreDb, 'bookings'));
        window.bookings = bookingsSnapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));
        console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π:', window.bookings.length);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–µ–π:', error);
        window.bookings = [];
        calendarEl.innerHTML = '<div class="text-center text-red-500 py-8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–µ–π</div>';
        return;
      }
      
      const year = window.bookingsViewMonth.getFullYear();
      const month = window.bookingsViewMonth.getMonth();
      
      // –ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
      const firstDay = new Date(year, month, 1);
      let startDayOfWeek = firstDay.getDay();
      startDayOfWeek = startDayOfWeek === 0 ? 6 : startDayOfWeek - 1; // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 0
      
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      calendarEl.innerHTML = '';
      
      // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –≤ –Ω–∞—á–∞–ª–µ
      for (let i = 0; i < startDayOfWeek; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'h-16 bg-gray-50 rounded-lg';
        calendarEl.appendChild(emptyCell);
      }
      
      // –Ø—á–µ–π–∫–∏ –¥–Ω–µ–π
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dateStr = formatDateSafe(date);
        
        const dayCell = document.createElement('div');
        dayCell.className = 'h-16 border border-gray-300 rounded-lg p-1 flex flex-col cursor-pointer hover:bg-blue-50 transition relative';
        
        if (isWeekend(date)) {
          dayCell.classList.add('bg-blue-50');
        }
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è
        const today = new Date();
        if (formatDateSafe(date) === formatDateSafe(today)) {
          dayCell.classList.add('ring-2', 'ring-blue-600');
        }
        
        // –ù–æ–º–µ—Ä –¥–Ω—è
        const dayNumber = document.createElement('div');
        dayNumber.textContent = day;
        dayNumber.className = 'text-xs font-semibold text-gray-900';
        dayCell.appendChild(dayNumber);
        
        // –ó–∞–ø–∏—Å–∏ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å
        const dayBookings = window.bookings.filter(b => b.bookingDate === dateStr)
          .sort((a, b) => a.startTime.localeCompare(b.startTime));
        
        if (dayBookings.length > 0) {
          const bookingsList = document.createElement('div');
          bookingsList.className = 'flex-1 overflow-hidden mt-0.5';
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ 2 –∑–∞–ø–∏—Å–µ–π
          const displayBookings = dayBookings.slice(0, 2);
          displayBookings.forEach(booking => {
            const bookingItem = document.createElement('div');
            bookingItem.className = 'text-[10px] bg-blue-100 text-blue-800 rounded px-1 py-0.5 mb-0.5 truncate';
            bookingItem.textContent = `${booking.startTime} ${booking.clientName || ''}`;
            bookingsList.appendChild(bookingItem);
          });
          
          dayCell.appendChild(bookingsList);
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
          if (dayBookings.length > 2) {
            const more = document.createElement('div');
            more.className = 'absolute bottom-0.5 right-0.5 text-[9px] bg-gray-800 text-white rounded-full px-1';
            more.textContent = `+${dayBookings.length - 2}`;
            dayCell.appendChild(more);
          }
        }
        
        // –ö–ª–∏–∫ –Ω–∞ –¥–µ–Ω—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
        dayCell.addEventListener('click', () => {
          if (dayBookings.length > 0) {
            showDayBookings(dayBookings, date);
          }
        });
        
        calendarEl.appendChild(dayCell);
      }
    }
    
    // –ü–æ–∫–∞–∑ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –¥–µ–Ω—å
    function showDayBookings(dayBookings, date) {
      const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
      let message = `üìÖ –ó–∞–ø–∏—Å–∏ –Ω–∞ ${dateStr}:\n\n`;
      
      dayBookings.forEach((booking, index) => {
        message += `${index + 1}. ${booking.startTime} - ${booking.clientName || '–ë–µ–∑ –∏–º–µ–Ω–∏'}\n`;
        message += `   –¢–µ–ª–µ—Ñ–æ–Ω: ${booking.clientPhone || '-'}\n`;
        message += `   –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${booking.duration || 0} —á\n`;
        if (booking.notes) {
          message += `   –ü—Ä–∏–º–µ—á–∞–Ω–∏—è: ${booking.notes}\n`;
        }
        message += '\n';
      });
      
      showMessage(message, false);
    }
    
    // –î–µ–ª–∞–µ–º renderBookingsCalendar –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ (–ü–û–°–õ–ï –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏)
    window.renderBookingsCalendar = renderBookingsCalendar;
    
    function initializeApp() {
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–¥–µ–ª –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
      const urlParams = new URLSearchParams(window.location.search);
      const section = urlParams.get('section') || 'booking';
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      if (typeof initForm === 'function') {
        initForm();
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ª
      if (window.showSection) {
        window.showSection(section);
      }
      
      // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –≤ —Ä–∞–∑–¥–µ–ª–µ –∑–∞–ø–∏—Å–µ–π
      if (section === 'booking' && window.showBookingView) {
        setTimeout(() => {
          window.showBookingView('calendar');
        }, 200);
      }
      
      // –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
      const clientSearch = document.getElementById('clientSearch');
      if (clientSearch) {
        clientSearch.addEventListener('input', async () => {
          if (typeof loadClients === 'function') {
            await loadClients();
          }
        });
      }
    }
    
    // –í—ã–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏, —á—Ç–æ–±—ã –º–æ–¥—É–ª—å —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
    setTimeout(() => {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeApp);
      } else {
        initializeApp();
      }
    }, 100);
  </script>
</body>
</html>

